<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/MiscFeatures</title><revhistory><revision><revnumber>8</revnumber><date>2008-11-27 22:20:46</date><authorinitials>AmosJeffries</authorinitials><revremark>export custom error details to its own feature page</revremark></revision><revision><revnumber>7</revnumber><date>2008-10-10 01:24:12</date><authorinitials>AmosJeffries</authorinitials><revremark>extract DelayPools into its own feature description page.</revremark></revision><revision><revnumber>6</revnumber><date>2008-05-18 19:38:56</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>5</revnumber><date>2007-10-24 00:03:41</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>4</revnumber><date>2007-07-11 11:47:39</date><authorinitials>Henrik Nordstr√∂m</authorinitials></revision><revision><revnumber>3</revnumber><date>2006-03-03 09:26:47</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>2</revnumber><date>2006-02-25 00:20:32</date><authorinitials>nat.measurement-factory.com</authorinitials></revision><revision><revnumber>1</revnumber><date>2006-01-26 10:00:43</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>What are the new features in squid 2.X?</title><itemizedlist><listitem><para>persistent connections. </para></listitem><listitem><para>Lower VM usage; in-transit objects are not held fully in memory. </para></listitem><listitem><para>Totally independent swap directories. </para></listitem><listitem><para>Customizable error texts. </para></listitem><listitem><para>FTP supported internally; no more ftpget. </para></listitem><listitem><para>Asynchronous disk operations (optional, requires pthreads library). </para></listitem><listitem><para>Internal icons for FTP and gopher directories. </para></listitem><listitem><para>snprintf() used everywhere instead of sprintf(). </para></listitem><listitem><para>SNMP </para></listitem><listitem><para>URN support </para></listitem><listitem><para>Routing requests based on AS numbers. </para></listitem><listitem><para><ulink url="https://wiki.squid-cache.org/SquidFaq/MiscFeatures/SquidFaq/CacheDigests#">../CacheDigests</ulink> </para></listitem><listitem><para>...and many more! </para></listitem></itemizedlist></section><section><title>How do I configure 'ssl_proxy' now?</title><para>By default, Squid connects directly to origin servers for SSL requests. But if you must force SSL requests through a parent, first tell Squid it can not go direct for SSL: </para><screen><![CDATA[acl SSL method CONNECT
never_direct allow SSL]]></screen><para>With this in place, Squid <emphasis>should</emphasis> pick one of your parents to use for SSL requests.  If you want it to pick a particular parent, you must use the <emphasis>cache_peer_access</emphasis> configuration: </para><screen><![CDATA[cache_peer parent1 parent 3128 3130
cache_peer parent2 parent 3128 3130
cache_peer_access parent2 allow !SSL]]></screen><para>The above lines tell Squid to NOT use <emphasis>parent2</emphasis> for SSL, so it should always use <emphasis>parent1</emphasis>. </para></section><section><title>Adding a new cache disk</title><para>Simply add your new <emphasis>cache_dir</emphasis> line to <emphasis>squid.conf</emphasis>, then run <emphasis>squid -z</emphasis> again.  Squid will create swap directories on the new disk and leave the existing ones in place. </para></section><section><title>How do I configure proxy authentication?</title><para>Authentication is handled via external processes. Arjan's <ulink url="http://www.devet.org/squid/proxy_auth/">proxy auth page</ulink> describes how to set it up.  Some simple instructions are given below as well. </para><itemizedlist><listitem><para>We assume you have configured an ACL entry with proxy_auth, for example: </para></listitem></itemizedlist><screen><![CDATA[acl foo proxy_auth REQUIRED
http_access allow foo]]></screen><itemizedlist><listitem><para>You will need to compile and install an external authenticator program.  Most people will want to use <emphasis>ncsa_auth</emphasis>.  The source for this program is included in the source distribution, in the <emphasis>helpers/basic_auth/NCSA</emphasis> directory. </para></listitem></itemizedlist><screen><![CDATA[% cd helpers/basic_auth/NCSA
% make
% make install]]></screen><para>You should now have an <emphasis>ncsa_auth</emphasis> program in the &lt;prefix&gt;/libexec/ directory where the helpers for <emphasis>squid</emphasis> lives (usually /usr/local/squid/libexec unless overridden by configure flags). You can also select with the --enable-basic-auth-helpers=... option which helpers should be installed by default when you install Squid. </para><itemizedlist><listitem><para>You may need to create a password file.  If you have been using proxy authentication before, you probably already have such a file.  You can get Apache's htpasswd program.  Pick a pathname for your password file.  We will assume you will want to put it in the same directory as your squid.conf. </para></listitem><listitem><para>Configure the external authenticator in <emphasis>squid.conf</emphasis>.  For <emphasis>ncsa_auth</emphasis> you need to give the pathname to the executable and the password file as an argument.  For example: </para></listitem></itemizedlist><screen><![CDATA[        auth_param basic program /usr/local/squid/libexec/ncsa_auth /usr/local/squid/etc/passwd]]></screen><para>After all that, you should be able to start up Squid.  If we left something out, or haven't been clear enough, please let us know ( <ulink url="mailto:squid-faq@squid-cache.org">squid-faq@squid-cache.org</ulink> ). </para></section><section><title>Why does proxy-auth reject all users after upgrading from Squid-2.1 or earlier?</title><para>The ACL for proxy-authentication has changed from: </para><screen><![CDATA[acl foo proxy_auth timeout]]></screen><para>to: </para><screen><![CDATA[acl foo proxy_auth username]]></screen><para>Please update your ACL appropriately - a username of <emphasis>REQUIRED</emphasis> will permit all valid usernames.  The timeout is now specified with the configuration option: </para><screen><![CDATA[auth_param basic credentialsttl timeout]]></screen></section><section><title>My squid.conf from version 1.1 doesn't work!</title><para>Yes, a number of configuration directives have been renamed. Here are some of them: </para><para>cache_host:: This is now called <emphasis>cache_peer</emphasis>.  The old term does not really describe what you are configuring, but the new name tells you that you are configuring a peer for your cache. </para><para>cache_host_domain:: Renamed to <emphasis>cache_peer_domain</emphasis> </para><para>local_ip, local_domain:: The functaionality provided by these directives is now implemented as access control lists.  You will use the <emphasis>always_direct</emphasis> and <emphasis>never_direct</emphasis> options.  The new <emphasis>squid.conf</emphasis> file has some examples. </para><para>cache_stoplist:: This directive also has been reimplemented with access control lists.  You will use the <emphasis>cache</emphasis> option since <ulink url="https://wiki.squid-cache.org/SquidFaq/MiscFeatures/Squid-2.6#">Squid-2.6</ulink>.  For example: </para><screen><![CDATA[        acl Uncachable url_regex cgi ?
        cache deny Uncachable]]></screen><para>cache_swap:: This option used to specify the cache disk size.  Now you specify the disk size on each <emphasis>cache_dir</emphasis> line. </para><para>cache_host_acl:: This option has been renamed to <emphasis>cache_peer_access</emphasis> <emphasis role="strong">and</emphasis> the syntax has changed.  Now this option is a true access control list, and you must include an <emphasis>allow</emphasis> or <emphasis>deny</emphasis> keyword.  For example: </para><screen><![CDATA[acl that-AS dst_as 1241
cache_peer_access thatcache.thatdomain.net allow that-AS
cache_peer_access thatcache.thatdomain.net deny all]]></screen><para>This example sends requests to your peer <emphasis>thatcache.thatdomain.net</emphasis> only for origin servers in Autonomous System Number 1241. </para><para>units:: In Squid-1.1 many of the configuration options had implied units associated with them.  For example, the <emphasis>connect_timeout</emphasis> value may have been in seconds, but the <emphasis>read_timeout</emphasis> value had to be given in minutes.  With Squid-2, these directives take units after the numbers, and you will get a warning if you leave off the units.  For example, you should now write: </para><screen><![CDATA[connect_timeout 120 seconds
read_timeout 15 minutes]]></screen><!--rule (<hr>) is not applicable to DocBook--><itemizedlist><listitem override="none"><para>Back to the <ulink url="https://wiki.squid-cache.org/SquidFaq/MiscFeatures/SquidFaq#">SquidFaq</ulink> </para></listitem></itemizedlist></section></article>