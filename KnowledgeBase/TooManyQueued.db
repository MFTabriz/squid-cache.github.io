<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>KnowledgeBase/TooManyQueued</title><revhistory><revision><revnumber>3</revnumber><date>2011-11-22 23:55:28</date><authorinitials>AmosJeffries</authorinitials><revremark>Renamed from 'KnowledgBase/TooManyQueued'.</revremark></revision><revision><revnumber>2</revnumber><date>2011-11-22 22:21:37</date><authorinitials>AmosJeffries</authorinitials><revremark>categorize</revremark></revision><revision><revnumber>1</revnumber><date>2011-06-29 00:53:51</date><authorinitials>AmosJeffries</authorinitials><revremark>create from squid-users info</revremark></revision></revhistory></articleinfo><section><title>Too Many Queued Requests</title><para><emphasis role="strong">Synopsis</emphasis> </para><para>Squid crashes and maybe restarts immediately. Logging complains about too many queued requests. </para><para><emphasis role="strong">Symptoms</emphasis> </para><itemizedlist><listitem><para>FATAL: Too many queued ntlmauthenticator requests </para></listitem><listitem><para>FATAL: Too many queued negotiateauthenticator requests </para></listitem><listitem><para>FATAL: Too many queued basicauthenticator requests </para></listitem><listitem><para>FATAL: Too many queued digestauthenticator requests </para></listitem><listitem><para>FATAL: Too many queued redirector requests </para></listitem></itemizedlist><para><emphasis role="strong">Explanation</emphasis> </para><para>Squid uses helper processes to perform certain actions such as authentication checks. The number of each helper is configurable by the proxy admin. As can be expected these helpers have a limit to how many actions they can process each second. Most of them handle only one client request at a time. </para><para>This message is displayed once there are <emphasis role="strong">more</emphasis> simultaneous client requests waiting to be handled than helpers available to process the load. If you configure N helpers, this warning appears when 2N+1 clients are waiting for replies. Depending on the squid version the factor may be 2 or 5 queued per helper. </para><para>This warning is most often seen with NTLM authenticators. Due to the nature of NTLM it locks one helper for the relatively long NTLM handshake period. This radically reduces the number of concurrent client requests that can be sent through Squid. Winbind places a maximum capacity somewhere around 256 simultaneous NTLM handshakes. Higher client connection rates require some skills organising fast handshakes and managing multiple DC. Negotiate can handle many more handshakes, but also has an annoyingly low capacity. </para><para><emphasis role="strong">Workaround</emphasis> </para><itemizedlist><listitem><para>concurrency - certain helper types are able to be made concurrent. These are basic auth, external ACL, URL re-write and redirect helpers. Annoyingly these are the helpers where this problem occurs least anyway. Raising concurrency is better than children, up to a point. There is a <ulink url="https://wiki.squid-cache.org/KnowledgeBase/TooManyQueued/Features/HelperMultiplexer#">helper multiplexer</ulink> available to easily add support to any existing helper. </para></listitem><listitem><para>NTLM / Negotiate - if you hit this your only choice is to raise the number of helpers used. The protocols for these helpers do not support concurrency. </para></listitem><listitem><para><ulink url="https://wiki.squid-cache.org/KnowledgeBase/TooManyQueued/Squid-3.2#">Squid-3.2</ulink> and later have a <emphasis>dynamic helper</emphasis> feature which allows administrators to configure minimum and maximum helper numbers. Squid will attempt to run the minimum, but if traffic load requires more helpers they will be started. Up until the maximum is reached. If traffic exceeds the maximum helper this message may start appearing again. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/KnowledgeBase/TooManyQueued/CategoryKnowledgeBase#">CategoryKnowledgeBase</ulink> <ulink url="https://wiki.squid-cache.org/KnowledgeBase/TooManyQueued/CategoryErrorMessages#">CategoryErrorMessages</ulink> </para></section></article>