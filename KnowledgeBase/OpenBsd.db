<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>KnowledgeBase/OpenBsd</title><revhistory><revision><revnumber>10</revnumber><date>2021-08-17 09:09:49</date><authorinitials>StuartHenderson</authorinitials></revision><revision><revnumber>9</revnumber><date>2021-08-17 09:08:37</date><authorinitials>StuartHenderson</authorinitials><revremark>fix heads</revremark></revision><revision><revnumber>8</revnumber><date>2021-08-17 09:06:32</date><authorinitials>StuartHenderson</authorinitials><revremark>update OpenBSD notes</revremark></revision><revision><revnumber>7</revnumber><date>2013-06-03 11:04:39</date><authorinitials>StuartHenderson</authorinitials></revision><revision><revnumber>6</revnumber><date>2013-04-09 17:29:48</date><authorinitials>StuartHenderson</authorinitials><revremark>info about nat lookup with modern OpenBSD</revremark></revision><revision><revnumber>5</revnumber><date>2013-04-09 17:21:14</date><authorinitials>StuartHenderson</authorinitials><revremark>modern OpenBSD has squid 3.2</revremark></revision><revision><revnumber>4</revnumber><date>2012-03-21 05:06:12</date><authorinitials>AmosJeffries</authorinitials><revremark>mention broken ioctl() for the last few 4.x series</revremark></revision><revision><revnumber>3</revnumber><date>2011-05-17 00:19:03</date><authorinitials>AmosJeffries</authorinitials><revremark>update to distribution info template layout. link to FAQ</revremark></revision><revision><revnumber>2</revnumber><date>2010-10-13 14:19:11</date><authorinitials>FrancescoChemolli</authorinitials><revremark>fixed title</revremark></revision><revision><revnumber>1</revnumber><date>2010-10-13 14:18:10</date><authorinitials>FrancescoChemolli</authorinitials></revision></revhistory></articleinfo><section><title>Squid on OpenBSD</title><section><title>Pre-Built Binary Packages</title><para>Squid is available in <ulink url="https://www.openbsd.org">OpenBSD</ulink> packages. </para><screen><![CDATA[# pkg_add squid
quirks-4.33 signed on 2021-08-16T13:29:25Z
Ambiguous: choose package for squid
a       0: <None>
        1: squid-4.16p0
        2: squid-4.16p0-krb5
Your choice: 1
squid-4.16p0: ok
The following new rcscripts were installed: /etc/rc.d/squid
See rcctl(8) for details.
New and changed readme(s):
        /usr/local/share/doc/pkg-readmes/squid]]></screen><para>Some optional parts are packaged separately and can also be installed with pkg_add: squid-ntlm, squid-ldap. </para><para>If using Squid as an <ulink url="https://wiki.squid-cache.org/KnowledgeBase/OpenBsd/InterceptionProxy#">InterceptionProxy</ulink>, note that the packages are built using --enable-ipfw-transparent which is the preferred method on OpenBSD. Use this with &quot;divert-to&quot; rules in PF. More information is available in the <ulink url="http://www.openbsd.org/cgi-bin/cvsweb/ports/www/squid/pkg/README-main?content-type=text%2Fplain">package's README file</ulink>. </para></section><section><title>Building from ports</title><para>If you need to add patches or modify the build, follow the <ulink url="https://www.openbsd.org/faq/ports/ports.html">ports FAQ</ulink> to checkout the ports tree, then the following will build Squid from ports, create a package and install it: </para><screen><![CDATA[cd /usr/ports/www/squid
make clean=all
make         # can be omitted; install depends on this anyway
make package # can be omitted; install depends on this anyway
make install]]></screen><para>Compiler flags can be given on the make command line. Debug builds can be done by passing flags in the DEBUG variable; setting this also disables strippping. e.g. </para><screen><![CDATA[make CXXFLAGS="-O3"
make DEBUG="-O0 -g"]]></screen><para>The standard compiler on most CPU architectures is clang, a few still use GCC. If you need to test building from ports using GCC on a clang-based architecture, change the COMPILER line in the ports Makefile to &quot;COMPILER=ports-gcc&quot;. gdb in the base OS is an outdated GPLv2 version and doesn't cope well with modern compilers; install a newer version from ports with &quot;pkg_add gdb&quot; and use the &quot;egdb&quot; binary. lldb is also available though at the time of writing is still at an early stage of use in OpenBSD. </para></section><section><title>Compiling outside ports</title><para>To build squid for standard use, no particular method should be needed. See <ulink url="https://wiki.squid-cache.org/KnowledgeBase/OpenBsd/SquidFaq/CompilingSquid#">SquidFaq/CompilingSquid</ulink> for detailed instructions. </para><para>The following may be outdated: If you plan to do development on squid, some caution is needed: apparently something in the mix of sources and libraries trips a bug in gcc when building parts of the test-suite with optimizations. Building with optimizations explicitly turned off will allow to compile fine. In other words you'll need to: </para><screen><![CDATA[CFLAGS='-O0 -Wall -g' CXXFLAGS="$CFLAGS" ./test-builds.sh]]></screen><para>The old --enable-pf-transparent method is still available but is not recommended. If you do use this for some reason, note that the userid running Squid requires *write* access against /dev/pf to invoke the ioctl() to do a NAT lookup. For this method, use &quot;rdr-to&quot; PF rules to pass the traffic to squid.  </para><para><ulink url="https://wiki.squid-cache.org/KnowledgeBase/OpenBsd/CategoryKnowledgeBase#">CategoryKnowledgeBase</ulink> <ulink url="https://wiki.squid-cache.org/KnowledgeBase/OpenBsd/SquidFaq/BinaryPackages#">SquidFaq/BinaryPackages</ulink> </para></section></section></article>