<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ManagerCgiTool</title><revhistory><revision><revnumber>7</revnumber><date>2020-03-24 11:37:52</date><authorinitials>AmosJeffries</authorinitials><revremark>fix typo in markup.</revremark></revision><revision><revnumber>6</revnumber><date>2019-06-29 13:38:03</date><authorinitials>AmosJeffries</authorinitials><revremark>mention that a CGI module is needed.</revremark></revision><revision><revnumber>5</revnumber><date>2015-04-22 10:10:12</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>4</revnumber><date>2015-04-22 10:09:05</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>3</revnumber><date>2012-02-01 00:01:40</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>2</revnumber><date>2012-01-31 23:35:36</date><authorinitials>AmosJeffries</authorinitials><revremark>standalone tool not a feature of squid main</revremark></revision><revision><revnumber>1</revnumber><date>2012-01-31 23:33:40</date><authorinitials>AmosJeffries</authorinitials><revremark>split off from CacheManager main page</revremark></revision></revhistory></articleinfo><section><title>Squid Manager CGI Tool</title><para>This tool is a CGI utility for online browsing of the Squid manager reports. It can be configured to interface with multiple proxies so provides a convenient way to manage proxies and view statistics without logging into each server. </para><section><title>Cache manager CGI tool configuration</title><para>That depends on which web server you're using.  Below you will find instructions for configuring the CERN and Apache servers to permit <emphasis>cachemgr.cgi</emphasis> usage. </para><para>After you edit the server configuration files, you will probably need to either restart your web server or or send it a SIGHUP signal to tell it to re-read its configuration files. </para><para>When you're done configuring your web server, you'll connect to the cache manager with a web browser, using a URL such as: </para><para><emphasis><ulink url="http://www.example.com/cgi-bin/cachemgr.cgi"/></emphasis> </para><section><title>for CERN httpd 3.0</title><para>First, you should ensure that only specified workstations can access the cache manager.  That is done in your CERN <emphasis>httpd.conf</emphasis>, not in <emphasis>squid.conf</emphasis>. </para><screen><![CDATA[Protection MGR-PROT {
         Mask    @(workstation.example.com)
}]]></screen><para>Wildcards are acceptable, IP addresses are acceptable, and others can be added with a comma-separated list of IP addresses. There are many more ways of protection.  Your server documentation has details. </para><para>You also need to add: </para><screen><![CDATA[Protect         /Squid/*        MGR-PROT
Exec            /Squid/cgi-bin/*.cgi    /usr/local/squid/bin/*.cgi]]></screen><para>This marks the script as executable to those in MGR-PROT. </para></section><section><title>for Apache 1.x</title><para>First, make sure the cgi-bin directory you're using is listed with a Script<emphasis role="strong"/>Alias in your Apache <emphasis>httpd.conf</emphasis> file like this: </para><screen><![CDATA[ScriptAlias /Squid/cgi-bin/ /usr/local/squid/cgi-bin/]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-error.png" width="16"/></imageobject><textobject><phrase>{X}</phrase></textobject></inlinemediaobject> <emphasis role="strong">SECURITY NOTE:</emphasis> It's probably a <emphasis role="strong">bad</emphasis> idea to ScriptAlias the entire <emphasis>/usr/local/squid/bin/</emphasis> directory where all the Squid executables live. </para></listitem></itemizedlist><para>Next, you should ensure that only specified workstations can access the cache manager.  That is done in your Apache <emphasis>httpd.conf</emphasis>, not in <emphasis>squid.conf</emphasis>.  At the bottom of <emphasis>httpd.conf</emphasis> file, insert: </para><screen><![CDATA[<Location /Squid/cgi-bin/cachemgr.cgi>
order allow,deny
allow from workstation.example.com
</Location>]]></screen><para>You can have more than one allow line, and you can allow domains or networks. </para><para>Alternately, <emphasis>cachemgr.cgi</emphasis> can be password-protected.  You'd add the following to <emphasis>httpd.conf</emphasis>: </para><screen><![CDATA[<Location /Squid/cgi-bin/cachemgr.cgi>
AuthUserFile /path/to/password/file
AuthGroupFile /dev/null
AuthName User/Password Required
AuthType Basic
require user cachemanager
</Location>]]></screen><para>Consult the Apache documentation for information on using <emphasis>htpasswd</emphasis> to set a password for this &quot;user.&quot; </para></section><section><title>for Apache 2.x</title><para>First, make sure the cgi-bin directory you're using is listed with a Script<emphasis role="strong"/>Alias in your Apache config. </para><para>Then, make sure a CGI module is enabled in your Apache settings. <emphasis role="strong">cgid</emphasis> or <emphasis role="strong">fastcgi</emphasis> are usually bundled with Apache but disabled by default. </para><para>In the Apache config there is a sub-directory <emphasis>/etc/apache2/conf.d</emphasis> for application specific settings (unrelated to any specific site). Create a file <emphasis>conf.d/squid</emphasis> containing this: </para><screen><![CDATA[ScriptAlias /Squid/cgi-bin/cachemgr.cgi /usr/local/squid/cgi-bin/cachemgr.cgi
]]><![CDATA[
<Location /Squid/cgi-bin/cachemgr.cgi>
order allow,deny
allow from workstation.example.com
</Location>]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-error.png" width="16"/></imageobject><textobject><phrase>{X}</phrase></textobject></inlinemediaobject> <emphasis role="strong">SECURITY NOTE:</emphasis>  It's possible but a <emphasis role="strong">bad</emphasis> idea to ScriptAlias the entire <emphasis>/usr/local/squid/bin/</emphasis> directory where all the Squid executables live. </para></listitem></itemizedlist><para>You should ensure that only specified workstations can access the cache manager.  That is done in your Apache <emphasis>conf.d/squid</emphasis> &lt;Location&gt; settings, not in <emphasis>squid.conf</emphasis>. </para><para>You can have more than one allow line, and you can allow domains or networks. </para><para>Alternately, <emphasis>cachemgr.cgi</emphasis> can be password-protected.  You'd add the following to <emphasis>conf.d/squid</emphasis>: </para><screen><![CDATA[<Location /Squid/cgi-bin/cachemgr.cgi>
AuthUserFile /path/to/password/file
AuthGroupFile /dev/null
AuthName User/Password Required
AuthType Basic
require user cachemanager
</Location>]]></screen><para>Consult the Apache 2.0 documentation for information on using <emphasis>htpasswd</emphasis> to set a password for this &quot;user.&quot; </para><para>To further protect the cache-manager on public systems you should consider creating a whole new &lt;VirtualHost&gt; segment in the Apache configuration for the squid manager. This is done by creating a file in the Apache configuration sub-directory <emphasis>.../apache2/sites-enabled/</emphasis> usually with the domain name of the new site, see the Apache 2.0 documentation for further details for your system. </para></section><section><title>Roxen 2.0 and later</title><para>by <ulink url="https://wiki.squid-cache.org/ManagerCgiTool/FrancescoChemolli#">FrancescoChemolli</ulink> </para><para>Notice: this is <emphasis role="strong">not</emphasis> how things would get best done with Roxen, but this what you need to do go adhere to the example. Also, knowledge of basic Roxen configuration is required. </para><para>This is what's required to start up a fresh Virtual Server, only serving the cache manager. If you already have some Virtual Server you wish to use to host the Cache Manager, just add a new CGI support module to it. </para><para>Create a new virtual server, and set it to host <ulink url="http://www.example.com/"/>. Add to it at least the following modules: </para><itemizedlist><listitem><para>Content Types </para></listitem><listitem><para>CGI scripting support </para></listitem></itemizedlist><para>In the <emphasis>CGI scripting support</emphasis> module, section <emphasis>Settings</emphasis>, change the following settings: </para><itemizedlist><listitem><para>CGI-bin path: set to /Squid/cgi-bin/ </para></listitem><listitem><para>Handle *.cgi: set to <emphasis>no</emphasis> </para></listitem><listitem><para>Run user scripts as owner: set to <emphasis>no</emphasis> </para></listitem><listitem><para>Search path: set to the directory containing the cachemgr.cgi file </para></listitem></itemizedlist><para>In section <emphasis>Security</emphasis>, set <emphasis>Patterns</emphasis> to: </para><screen><![CDATA[allow ip=192.0.2.1]]></screen><para>where 192.0.2.1 is the IP address for workstation.example.com </para><para>Save the configuration, and you're done. </para></section></section></section></article>