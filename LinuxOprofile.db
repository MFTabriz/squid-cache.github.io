<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>LinuxOprofile</title><revhistory><revision><revnumber>6</revnumber><date>2008-05-18 19:38:55</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>5</revnumber><date>2008-02-19 00:28:59</date><authorinitials>AmosJeffries</authorinitials><revremark>more typos.</revremark></revision><revision><revnumber>4</revnumber><date>2008-02-19 00:26:26</date><authorinitials>AmosJeffries</authorinitials><revremark>fix typo and add catch-22 warning.</revremark></revision><revision><revnumber>3</revnumber><date>2008-02-19 00:16:05</date><authorinitials>AmosJeffries</authorinitials><revremark>bold the title</revremark></revision><revision><revnumber>2</revnumber><date>2007-12-17 11:35:51</date><authorinitials>AmosJeffries</authorinitials><revremark>Fix Typos.</revremark></revision></revhistory></articleinfo><section><title>How to profile Squid using oprofile on Linux</title><para>Setup oprofile </para><screen><![CDATA[  opcontrol --shutdown
  opcontrol --reset
  opcontrol --vmlinux=/path/to/vmlinux (or --no-vmlinux if you don't have the kernel vmlinux image)
  opcontrol --separate=lib,thread
or maybe (if you want kernel time mixed with the application)
  opcontrol --separate=lib,thread,kernel
  opcontrol --image=/path/to/sbin/squid
  opcontrol --start-daemon]]></screen><para>NP: /path/to/sbin/squid MUST be the actual binary. A symlink will result in no-symbols-found errors later. </para><para>Start Squid and give it the workload you want to profile. Then tell oprofile to collect the desired data </para><screen><![CDATA[  opcontrol --start
]]><![CDATA[
[let it run for a while]
]]><![CDATA[
  opcontrol --stop]]></screen><para>opreport in various ways to dig out the details </para><screen><![CDATA[ opreport --symbols
 opreport -d
 etc... man opreport for details]]></screen><para>Save the trace for future analysis. The saved dir is self-contained, traces, binaries, libraries etc... and can be moved to another machine for further analysis. </para><screen><![CDATA[  oparchive -o /path/to/some/archive/dir]]></screen><para>Clear the oprofile session </para><screen><![CDATA[  opcontrol --reset]]></screen></section></article>