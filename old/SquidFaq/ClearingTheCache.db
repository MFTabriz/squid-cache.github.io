<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/ClearingTheCache</title><revhistory><revision><revnumber>8</revnumber><date>2011-04-19 23:21:24</date><authorinitials>AmosJeffries</authorinitials><revremark>add COSS as an exception to problem.</revremark></revision><revision><revnumber>7</revnumber><date>2009-03-23 11:42:35</date><authorinitials>AmosJeffries</authorinitials><revremark>note from Mark Nottingham about issues on big caches.</revremark></revision><revision><revnumber>6</revnumber><date>2008-08-20 07:55:01</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Altered wiki layout to match FAQ standards - for index etc.</revremark></revision><revision><revnumber>5</revnumber><date>2008-08-20 05:41:31</date><authorinitials>AmosJeffries</authorinitials><revremark>bugger. revert all changes to this page.</revremark></revision><revision><revnumber>4</revnumber><date>2008-08-20 05:26:42</date><authorinitials>AmosJeffries</authorinitials><revremark>created from squid-users</revremark></revision><revision><revnumber>3</revnumber><date>2008-05-18 19:38:56</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>2</revnumber><date>2008-02-22 10:39:22</date><authorinitials>AmosJeffries</authorinitials><revremark>Edge case: when cache-dir is root of a partition we must not remove lost+found</revremark></revision><revision><revnumber>1</revnumber><date>2008-01-07 11:16:34</date><authorinitials>AmosJeffries</authorinitials></revision></revhistory></articleinfo><section><title>Pruning the Cache Down</title><para>Clearing the cache can be necessary under some unusual circumstances. Usually if the estimated size of the cache was calculated incorrectly and needs adjusting. </para><para>To fix simple cases such as the above where the cache just needs to have a portion of the total removed Altering squid.conf and reconfiguring squid is sufficient. Squid will handle the changes automatically and starts to purge the cache down to size again within 10 minutes of the configure. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> NP: on particularly large caches the prune has been known to take a long time and/or a lot of CPU. </para></listitem></itemizedlist><para>old squid.conf </para><screen><![CDATA[cache_dir ufs /squid/cache 1000 255 255]]></screen><para>new squid.conf </para><screen><![CDATA[cache_dir ufs /squid/cache 100 255 255]]></screen><para>and reconfigure ... </para><screen><![CDATA[squid -k reconfigure]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> <emphasis role="strong">reconfigure</emphasis> does not work on COSS directory changes. Use the tricks below and a full restart instead. This is due to COSS using partition/disk level mapping instead of 'normal' human accessible files and directories. </para></listitem></itemizedlist></section><section><title>Changing the Cache Levels</title><para>Altering the cache_dir L1 and L2 sizes has not been tested with the above altering. It is still recommended to manually delete the cache directory and rebuild after altering the configuration. </para><screen><![CDATA[squid -k shutdown
rm -r /squid/cache/*
squid -z
squid]]></screen><para>If your cache directory and state files are at the root level of a partition there are a few system objects you need to be careful with. To get around these you may need to change the <emphasis>rm -r </emphasis> to a safer list of specific squid files: </para><screen><![CDATA[rm -rf /squid/cache/[0-9]*
rm -f /squid/cache/swap*
rm -f /squid/cache/netdb*
rm -f /squid/cache/*.log]]></screen><para>If you wish to try the pruning method with a level change and let us know the results then please do. We would like this page to cover all known resizing requirements and options. </para><!--rule (<hr>) is not applicable to DocBook--><para> Back to the <ulink url="https://wiki.squid-cache.org/SquidFaq/ClearingTheCache/SquidFaq#">SquidFaq</ulink> </para></section></article>