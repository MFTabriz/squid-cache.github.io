<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/ConfiguringBrowsers</title><revhistory><revision><revnumber>19</revnumber><date>2012-07-04 00:07:14</date><authorinitials>AmosJeffries</authorinitials><revremark>mention peering problems in 3.2+ with intercept</revremark></revision><revision><revnumber>18</revnumber><date>2011-08-03 12:57:40</date><authorinitials>AmosJeffries</authorinitials><revremark>tweak section title for simple links</revremark></revision><revision><revnumber>17</revnumber><date>2011-05-24 00:36:41</date><authorinitials>AmosJeffries</authorinitials><revremark>add section on recommended configuration layering.</revremark></revision><revision><revnumber>16</revnumber><date>2010-10-10 22:43:54</date><authorinitials>AmosJeffries</authorinitials><revremark>link to community site with lots of useful details about PAC.</revremark></revision><revision><revnumber>15</revnumber><date>2009-10-14 03:51:16</date><authorinitials>AmosJeffries</authorinitials><revremark>use example.com, 192.0.2.*, update FTP auth description.</revremark></revision><revision><revnumber>14</revnumber><date>2008-11-01 04:00:20</date><authorinitials>AmosJeffries</authorinitials><revremark>menu levels fix.</revremark></revision><revision><revnumber>13</revnumber><date>2008-05-18 19:39:01</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>12</revnumber><date>2006-08-25 09:46:39</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>11</revnumber><date>2006-06-04 07:11:54</date><authorinitials>ReubenFarrelly</authorinitials><revremark>Rearrange order of page to be more logical</revremark></revision><revision><revnumber>10</revnumber><date>2006-06-04 07:09:09</date><authorinitials>ReubenFarrelly</authorinitials></revision><revision><revnumber>9</revnumber><date>2006-06-04 06:59:02</date><authorinitials>ReubenFarrelly</authorinitials></revision><revision><revnumber>8</revnumber><date>2006-06-04 06:55:12</date><authorinitials>ReubenFarrelly</authorinitials><revremark>Oops, relocated block of text..</revremark></revision><revision><revnumber>7</revnumber><date>2006-06-04 06:53:58</date><authorinitials>ReubenFarrelly</authorinitials><revremark>Add Firefox and Thunderbird instructions</revremark></revision><revision><revnumber>6</revnumber><date>2006-03-03 09:20:30</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>5</revnumber><date>2006-02-07 22:40:31</date><authorinitials>kinkie</authorinitials><revremark>Changed samples from inline to inlined attachment</revremark></revision><revision><revnumber>4</revnumber><date>2006-01-30 00:03:26</date><authorinitials>kinkie</authorinitials><revremark>Minor fixes to markup, added link to index.</revremark></revision><revision><revnumber>3</revnumber><date>2006-01-24 20:26:55</date><authorinitials>kinkie</authorinitials><revremark>Fixed syntax highlighting in javascript code</revremark></revision><revision><revnumber>2</revnumber><date>2006-01-24 20:26:10</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>1</revnumber><date>2006-01-24 19:05:16</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>Communication between browsers and Squid</title><para>Most web browsers available today support proxying and are easily configured to use a Squid server as a proxy.  Some browsers support advanced features such as lists of domains or URL patterns that shouldn't be fetched through the proxy, or JavaScript automatic proxy configuration. </para><para>There are three ways to configure browsers to use Squid.  The first method involves manually configuring the proxy in each browser.  Alternatively, a proxy.pac file can be manually entered into each browser so that it will download the proxy settings (partial auto configuration), and lastly all modern browsers can also and indeed are configured by default to fully automatically configure themselves if the network is configured to support this. </para></section><section><title>Recommended network configuration</title><para>For best use of the proxy we recommend a multiple-layers approach. The following are the layers we recommend, in order of preference. </para><para>We are aware that many networks only implement layer 3 and 4 of this design due to administrators familiarity with NAT, confusion about the benefits, and historic problems with the upper two layers. </para><orderedlist numeration="arabic"><listitem><para><link linkend="Fully_Automatically_Configuring_Browsers_for_WPAD">Web Proxy Automatic Detection</link> (<emphasis role="strong">WPAD</emphasis>) (aka <emphasis role="strong">transparent configuration</emphasis>) </para><itemizedlist><listitem><para>Browsers set to auto-detect the proxy for whatever network they are plugged into. This is particularly useful for mobile users. </para></listitem><listitem><para>The big problem with this layer is that there is no formal RFC standard to follow, so browsers implement and two separate DNS and DHCP systems to setup. </para></listitem><listitem><para>requires the PAC to be implemented. </para></listitem></itemizedlist></listitem><listitem><para><link linkend="Partially_Automatic_Configuration">Proxy auto-configuration</link> (<emphasis role="strong">PAC</emphasis>) (aka <emphasis>transparent proxy</emphasis>) </para><itemizedlist><listitem><para>As a backup to per-machine configuration. </para></listitem><listitem><para>Some systems support PAC file to be explicitly set in the machine-wide environment. </para></listitem></itemizedlist></listitem><listitem><para>Machine-wide Configuration </para><itemizedlist><listitem override="none"><para>Using a system-wide environment variable <emphasis role="strong">http_proxy</emphasis> (or GUI configuration which sets it). Most operating systems support this. Windows is the exception, however the IE settings are used in an equivalent way. </para></listitem><listitem><para>A lot of software supports it. Only set once per machine. </para></listitem><listitem><para>Some systems allow this to be pushed out across the network (Windows uses a Domain Policy) </para></listitem></itemizedlist></listitem><listitem><para><ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/ConfigExamples/Intercept#">NAT or TPROXY interception</ulink>. (aka <emphasis>transparent proxy</emphasis>) </para><itemizedlist><listitem><para>Client software does not need to be touched. </para></listitem><listitem><para>security takes several major reductions (several whole families of vulnerability are created, proxy authentication disappears, peering abilities disappear) </para></listitem><listitem><para>System resources and connection reliability take several major reductions </para></listitem></itemizedlist></listitem><listitem><para><link linkend="Manual_Browser_Configuration">Manual Configuration</link>. </para><itemizedlist><listitem override="none"><para>Nothing beats an explicit manual configuration for <emphasis>it works</emphasis> excitement. However doing it for each and every piece of software on a machine is quite a hassle. Doing it for a whole network is unrealistic outside of highly paranoid systems. It is mentioned here simply as an option. </para></listitem></itemizedlist></listitem><listitem><para>For completeness sake: the best underlying secure systems back several of these layers up with a complete firewall ban on web traffic. This prevents users and machines bypassing the proxy control points. </para></listitem></orderedlist></section><section><title>Manual Browser Configuration</title><para>This involves manually specifying the proxy server and port name in each browser. </para><section><title>Firefox and Thunderbird manual configuration</title><para>Both Firefox and Thunderbird are configured in the same way.  Look in the Tools menu, Options, General and then Connection Settings.  The options in there are fairly self explanatory.  Firefox and Thunderbird support manually specifying the proxy server, automatically downloading a wpad.dat file from a specified source, and additionally wpad auto-detection. </para><para>Thunderbird uses these settings for downloading HTTP images in emails. </para><para>In both cases if you are manually configuring proxies, make sure you should add relevant statements for your network in the &quot;No Proxy For&quot; boxes. </para></section><section><title>Microsoft Internet Explorer manual configuration</title><para>Select <emphasis role="strong">Options</emphasis> from the <emphasis role="strong">View</emphasis> menu.  Click on the <emphasis role="strong">Connection</emphasis> tab.  Tick the <emphasis role="strong">Connect through Proxy Server</emphasis> option and hit the <emphasis role="strong">Proxy Settings</emphasis> button.  For each protocol that your Squid server supports (by default, HTTP, FTP, and gopher) enter the Squid server's hostname or IP address and put the HTTP port number for the Squid server (by default, 3128) in the <emphasis role="strong">Port</emphasis> column.  For any protocols that your Squid does not support, leave the fields blank. </para></section><section><title>Netscape manual configuration</title><para>Select <emphasis role="strong">Network Preferences</emphasis> from the <emphasis role="strong">Options</emphasis> menu.  On the <emphasis role="strong">Proxies</emphasis> page, click the radio button next to <emphasis role="strong">Manual Proxy Configuration</emphasis> and then click on the <emphasis role="strong">View</emphasis> button.  For each protocol that your Squid server supports (by default, HTTP, FTP, and gopher) enter the Squid server's hostname or IP address and put the HTTP port number for the Squid server (by default, 3128) in the <emphasis role="strong">Port</emphasis> column.  For any protocols that your Squid does not support, leave the fields blank. </para></section><section><title>Lynx and Mosaic manual configuration</title><para>For Mosaic and Lynx, you can set environment variables before starting the application.  For example (assuming csh or tcsh): </para><screen><![CDATA[% setenv http_proxy http://mycache.example.com:3128/
% setenv gopher_proxy http://mycache.example.com:3128/
% setenv ftp_proxy http://mycache.example.com:3128/]]></screen><para>For Lynx you can also edit the <emphasis>lynx.cfg</emphasis> file to configure proxy usage.  This has the added benefit of causing all Lynx users on a system to access the proxy without making environment variable changes for each user.  For example: </para><screen><![CDATA[http_proxy:http://mycache.example.com:3128/
ftp_proxy:http://mycache.example.com:3128/
gopher_proxy:http://mycache.example.com:3128/]]></screen></section><section><title>Opera 2.12 manual configuration</title><para>by Hume Smith </para><para>Select <emphasis>Proxy Servers...</emphasis> from the <emphasis>Preferences</emphasis> menu.  Check each protocol that your Squid server supports (by default, HTTP, FTP, and Gopher) and enter the Squid server's address as hostname:port (e.g. mycache.example.com:3128 or 192.0.2.2:3128).  Click on <emphasis>Okay</emphasis> to accept the setup. </para><para>Notes: </para><itemizedlist><listitem><para>Opera 2.12 doesn't support gopher on its own, but requires a proxy; therefore Squid's gopher proxying can extend the utility of your Opera immensely. </para></listitem><listitem><para>Unfortunately, Opera 2.12 chokes on some HTTP requests, for example <ulink url="http://spam.abuse.net/spam/">abuse.net</ulink>. </para></listitem></itemizedlist><para>At the moment I think it has something to do with cookies.  If you have trouble with a site, try disabling the HTTP proxying by unchecking that protocol in the <emphasis>Preferences</emphasis>|<emphasis>Proxy Servers...</emphasis> dialogue.  Opera will remember the address, so reenabling is easy. </para></section><section><title>Netmanage Internet Chameleon WebSurfer manual configuration</title><para>Netmanage WebSurfer supports manual proxy configuration and exclusion lists for hosts or domains that should not be fetched via proxy (this information is current as of WebSurfer 5.0).  Select <emphasis role="strong">Preferences</emphasis> from the <emphasis role="strong">Settings</emphasis> menu.  Click on the <emphasis role="strong">Proxies</emphasis> tab.  Select the <emphasis role="strong">Use Proxy</emphasis> options for HTTP, FTP, and gopher.  For each protocol that enter the Squid server's hostname or IP address and put the HTTP port number for the Squid server (by default, 3128) in the <emphasis role="strong">Port</emphasis> boxes.  For any protocols that your Squid does not support, leave the fields blank. </para><para>On the same configuration window, you'll find a button to bring up the exclusion list dialog box, which will let you enter some hosts or domains that you don't want fetched via proxy. </para></section></section><section><title>Partially Automatic Configuration</title><para>This involves the browser being preconfigured with the location of an autoconfiguration script. </para><section><title>Netscape automatic configuration</title><para>Netscape Navigator's proxy configuration can be automated with JavaScript (for Navigator versions 2.0 or higher).  Select <emphasis role="strong">Network Preferences</emphasis> from the <emphasis role="strong">Options</emphasis> menu.  On the <emphasis role="strong">Proxies</emphasis> page, click the radio button next to <emphasis role="strong">Automatic Proxy Configuration</emphasis> and then fill in the URL for your JavaScript proxy configuration file in the text box.  The box is too small, but the text will scroll to the r8ight as you go. </para><para>You may also wish to consult Netscape's documentation for the Navigator <ulink url="http://wp.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html">JavaScript proxy configuration</ulink> </para><para>Here is a sample auto configuration file from Oskar Pearson (link to save at the bottom): </para><para><programlisting format="linespecific" language="highlight" linenumbering="numbered" startinglinenumber="1"><lineannotation><![CDATA[//We (www.is.co.za) run a central cache for our customers that they]]></lineannotation>
<lineannotation><![CDATA[//access through a firewall - thus if they want to connect to their intranet]]></lineannotation>
<lineannotation><![CDATA[//system (or anything in their domain at all) they have to connect]]></lineannotation>
<lineannotation><![CDATA[//directly - hence all the "fiddling" to see if they are trying to connect]]></lineannotation>
<lineannotation><![CDATA[//to their local domain.]]></lineannotation>
<lineannotation><![CDATA[//]]></lineannotation>
<lineannotation><![CDATA[//Replace each occurrence of company.com with your domain name]]></lineannotation>
<lineannotation><![CDATA[//and if you have some kind of intranet system, make sure]]></lineannotation>
<lineannotation><![CDATA[//that you put it's name in place of "internal" below.]]></lineannotation>
<lineannotation><![CDATA[//]]></lineannotation>
<lineannotation><![CDATA[//We also assume that your cache is called "cache.company.com", and]]></lineannotation>
<lineannotation><![CDATA[//that it runs on port 8080. Change it down at the bottom.]]></lineannotation>
<lineannotation><![CDATA[//]]></lineannotation>
<lineannotation><![CDATA[//(C) Oskar Pearson and the Internet Solution (http://www.is.co.za)]]></lineannotation>

<![CDATA[function FindProxyForURL(url, host)]]>
<![CDATA[{]]>
<![CDATA[    ]]><lineannotation><![CDATA[//If they have only specified a hostname, go directly.]]></lineannotation>
<![CDATA[    if (isPlainHostName(host))]]>
<![CDATA[            return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    ]]><lineannotation><![CDATA[//These connect directly if the machine they are trying to]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//connect to starts with "intranet" - ie http://intranet]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//Connect  directly if it is intranet.*]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//If you have another machine that you want them to]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//access directly, replace "internal*" with that]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//machine's name]]></lineannotation>
<![CDATA[    if (shExpMatch( host, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[intranet*]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)||]]>
<![CDATA[                    shExpMatch(host, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[internal*]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[))]]>
<![CDATA[        return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    ]]><lineannotation><![CDATA[//Connect directly to our domains (NB for Important News)]]></lineannotation>
<![CDATA[    if (dnsDomainIs( host,]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[company.com]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)||]]>
<![CDATA[    ]]><lineannotation><![CDATA[//If you have another domain that you wish to connect to]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//directly, put it in here]]></lineannotation>
<![CDATA[                    dnsDomainIs(host,]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[sistercompany.com]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[))]]>
<![CDATA[        return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    ]]><lineannotation><![CDATA[//So the error message "no such host" will appear through the]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//normal Netscape box - less support queries :)]]></lineannotation>
<![CDATA[    if (!isResolvable(host))]]>
<![CDATA[            return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    ]]><lineannotation><![CDATA[//We only cache http, ftp and gopher]]></lineannotation>
<![CDATA[    if (url.substring(0, 5) == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[http:]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ||]]>
<![CDATA[                    url.substring(0, 4) == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ftp:]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[||]]>
<![CDATA[                    url.substring(0, 7) == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[gopher:]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>

<![CDATA[    ]]><lineannotation><![CDATA[//Change the ":8080" to the port that your cache]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//runs on, and "cache.company.com" to the machine that]]></lineannotation>
<![CDATA[    ]]><lineannotation><![CDATA[//you run the cache on]]></lineannotation>
<![CDATA[            return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[PROXY cache.company.com:8080; DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    ]]><lineannotation><![CDATA[//We don't cache WAIS]]></lineannotation>
<![CDATA[    if (url.substring(0, 5) == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[wais:]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[            return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<![CDATA[    else]]>
<![CDATA[            return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>
<![CDATA[}]]>
</programlisting><ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/SquidFaq/ConfiguringBrowsers?action=AttachFile&amp;do=get&amp;target=sample1.pac.txt">sample1.pac.txt</ulink> </para></section><section><title>Microsoft Internet Explorer</title><para>Microsoft Internet Explorer, versions 4.0 and above, supports JavaScript automatic proxy configuration in a Netscape-compatible way. Just select <emphasis role="strong">Options</emphasis> from the <emphasis role="strong">View</emphasis> menu. Click on the <emphasis role="strong">Advanced</emphasis> tab.  In the lower left-hand corner, click on the <emphasis role="strong">Automatic Configuration</emphasis> button.  Fill in the URL for your JavaScript file in the dialog box it presents you.  Then exit MSIE and restart it for the changes to take effect.  MSIE will reload the JavaScript file every time it starts. </para></section></section><section><title>Fully Automatic Configuration</title><para>by Mark Reynolds </para><para>You may like to start by reading the <ulink url="http://www.web-cache.com/Writings/Internet-Drafts/draft-ietf-wrec-wpad-01.txt">Expired Internet-Draft</ulink> that describes WPAD. </para><para>After reading the 8 steps below, if you don't understand any of the terms or methods mentioned, you probably shouldn't be doing this. Implementing wpad requires you to <emphasis role="strong">fully</emphasis> understand: </para><itemizedlist><listitem><para>web server installations and modifications. </para></listitem><listitem><para>squid proxy server (or others) installation etc. </para></listitem><listitem><para>Domain Name System maintenance etc. </para></listitem></itemizedlist><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/attention.png" width="15"/></imageobject><textobject><phrase>&lt;!&gt;</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para>Please don't bombard the squid list with web server or DNS questions. See your system administrator, or do some more research on those topics.</para></entry></row></tbody></tgroup></informaltable><para>This is not a recommendation for any product or version. All major browsers out now implementing WPAD. I think WPAD is an excellent feature that will return several hours of life per month. </para><para>There are probably many more tricks and tips which hopefully will be detailed here in the future. Things like <emphasis>wpad.dat</emphasis> files being served from the proxy server themselves, maybe with a round robin dns setup for the WPAD host. </para><para>I have only focused on the domain name method, to the exclusion of the DHCP method. I think the dns method might be easier for most people. I don't currently, and may never, fully understand wpad and IE5, but this method worked for me. It <emphasis role="strong">may</emphasis> work for you. </para><para>But if you'd rather just have a go ... </para><section><title>The PAC file</title><para>Create a standard Netscape <emphasis>auto proxy</emphasis> config file.  The sample provided above is more than adequate to get you going.  No doubt all the other load balancing and backup scripts will be fine also. </para><para>Store the resultant file in the document root directory of a handy web server as <emphasis>wpad.dat</emphasis> (Not <emphasis>proxy.pac</emphasis> as you may have previously done.) Andrei Ivanov notes that you should be able to use an HTTP redirect if you want to store the wpad.dat file somewhere else.  You can probably even redirect <emphasis>wpad.dat</emphasis> to <emphasis>proxy.pac</emphasis>: </para><screen><![CDATA[Redirect /wpad.dat http://example.com/proxy.pac]]></screen><para>If you do nothing more, a URL like <ulink url="http://www.example.com/wpad.dat"/> should bring up the script text in your browser window. </para><para>Insert the following entry into your web server <emphasis>mime.types</emphasis> file. Maybe in addition to your pac file type, if you've done this before. </para><screen><![CDATA[application/x-ns-proxy-autoconfig       dat]]></screen><para>And then restart your web server, for new mime type to work. </para></section><section><title>Browser Configurations</title><section><title>Internet explorer 5</title><para>Under <emphasis>Tools</emphasis>, <emphasis>Internet Options</emphasis>, <emphasis>Connections</emphasis>, <emphasis>Settings</emphasis> <emphasis role="strong">or</emphasis> <emphasis>Lan Settings</emphasis>, set <emphasis role="strong">ONLY</emphasis> <emphasis>Use Automatic Configuration Script</emphasis> to be the URL for where your new <emphasis>wpad.dat</emphasis> file can be found. </para><para>i.e.  <ulink url="http://www.example.com/wpad.dat"/>. </para><para>Test that that all works as per your script and network. There's no point continuing until this works ... </para></section></section><section><title>Automatic WPAD with DNS</title><para>Create/install/implement a DNS record so that wpad.example.com resolves to the host above where you have a functioning auto config script running. You should now be able to use <ulink url="http://wpad.example.com/wpad.dat"/> as the Auto Config Script location in step 5 above. </para><para>And finally, go back to the setup screen detailed in 5 above, and choose nothing but the <emphasis>Automatically Detect Settings</emphasis> option, turning everything else off. Best to restart IE5, as you normally do with any Microsoft product... And it should all work. Did for me anyway. </para><para>One final question might be &quot;Which domain name does the client (IE5) use for the wpad... lookup?&quot; It uses the hostname from the control panel setting.  It starts the search by adding the hostname <emphasis>wpad</emphasis> to current fully-qualified domain name.  For instance, a client in <emphasis>a.b.example.com</emphasis> would search for a WPAD server at <emphasis>wpad.a.b.example.com</emphasis>. If it could not locate one, it would remove the bottom-most domain and try again; for instance, it would try <emphasis>wpad.b.example.com</emphasis> next. IE 5 would stop searching when it found a WPAD server or reached the bottom-level domain, <emphasis role="strong">wpad</emphasis>. </para></section><section><title>Automatic WPAD with DHCP</title><para>You can also use DHCP to configure browsers for WPAD. This technique allows you to set any URL as the PAC URL.  For ISC DHCPD, enter a line like this in your <emphasis>dhcpd.conf</emphasis> file: </para><screen><![CDATA[option wpad code 252 = text;
option wpad "http://www.example.com/proxy.pac";]]></screen><para>Replace the hostname with the name or address of your own server. </para><para>Ilja Pavkovic notes that the DHCP mode does not work reliably with every version of Internet Explorer. The DNS name method to find wpad.dat is more reliable. </para><para>Another user adds that IE 6.01 seems to strip the last character from the URL.  By adding a trailing newline, he is able to make it work with both IE 5.0 and 6.0: </para><screen><![CDATA[option wpad "http://www.example.com/proxy.pac\n";]]></screen></section></section><section><title>Redundant Proxy Auto-Configuration</title><para>by Rodney van den Oever </para><para>There's one nasty side-effect to using auto-proxy scripts: if you start the web browser it will try and load the auto-proxy-script. </para><para>If your script isn't available either because the web server hosting the script is down or your workstation can't reach the web server (e.g. because you're working off-line with your notebook and just want to read a previously saved HTML-file) you'll get different errors depending on the browser you use. </para><para>The Netscape browser will just return an error after a timeout (after that it tries to find the site 'www.proxy.com' if the script you use is called 'proxy.pac'). </para><para>The Microsoft Internet Explorer on the other hand won't even start, no window displays, only after about 1 minute it'll display a window asking you to go on with/without proxy configuration. </para><para>The point is that your workstations always need to locate the proxy-script. I created some extra redundancy by hosting the script on two web servers (actually Apache web servers on the proxy servers themselves) and adding the following records to my primary nameserver: </para><screen><![CDATA[proxy   IN      A       192.0.2.1 ; IP address of proxy1
        IN      A       192.0.2.2 ; IP address of proxy2]]></screen><para>The clients just refer to '<ulink url="http://proxy/proxy.pac"/>'.  This script looks like this: </para><para><programlisting format="linespecific" language="highlight" linenumbering="numbered" startinglinenumber="1"><![CDATA[function FindProxyForURL(url,host)]]>
<![CDATA[{]]>
<lineannotation><![CDATA[// Hostname without domainname or host within our own domain?]]></lineannotation>
<lineannotation><![CDATA[// Try them directly:]]></lineannotation>
<lineannotation><![CDATA[// http://www.domain.com actually lives before the firewall, so]]></lineannotation>
<lineannotation><![CDATA[// make an exception:]]></lineannotation>
<![CDATA[if ((isPlainHostName(host)||dnsDomainIs( host,]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[.domain.com]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)) &&]]>
<![CDATA[        !localHostOrDomainIs(host, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[www.domain.com]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[))]]>
<![CDATA[        return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>

<lineannotation><![CDATA[// First try proxy1 then proxy2. One server mostly caches '.com']]></lineannotation>
<lineannotation><![CDATA[// to make sure both servers are not]]></lineannotation>
<lineannotation><![CDATA[// caching the same data in the normal situation. The other]]></lineannotation>
<lineannotation><![CDATA[// server caches the other domains normally.]]></lineannotation>
<lineannotation><![CDATA[// If one of 'm is down the client will try the other server.]]></lineannotation>
<![CDATA[else if (shExpMatch(host, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[*.com]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[))]]>
<![CDATA[        return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[PROXY proxy1.domain.com:8080; PROXY proxy2.domain.com:8081; DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>
<![CDATA[return ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[PROXY proxy2.domain.com:8081; PROXY proxy1.domain.com:8080; DIRECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[;]]>
<![CDATA[}]]>
</programlisting><ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/SquidFaq/ConfiguringBrowsers?action=AttachFile&amp;do=get&amp;target=sample2.pac.txt">sample2.pac.txt</ulink> </para><para>I made sure every client domain has the appropriate 'proxy' entry. The clients are automatically configured with two nameservers using DHCP. </para></section><section><title>Proxy Auto-Configuration with URL Hashing</title><para>The <ulink url="http://naragw.sharp.co.jp/sps/">Sharp Super Proxy Script page</ulink> contains a lot of good information about hash-based proxy auto-configuration scripts.  With these you can distribute the load between a number of caching proxies. </para></section><section><title>Where can I find more information about PAC?</title><para>There is a community website explaining PAC features and functions at <ulink url="http://findproxyforurl.com/"/>. </para></section><section><title>How do I tell Squid to use a specific username for FTP urls?</title><para>There are several ways the login can be done with FTP through Squid. </para><para><ulink url="http://www.squid-cache.org/Doc/config/ftp_user#">ftp_user</ulink> directive will accept the username or username:password values to be used by default on <emphasis role="strong">all</emphasis> FTP login requests. It will be overridden by any other available login credentials. </para><para>The strongest credentials that override all others are credentials added to the URL itself. </para><para>Insert your username in the host part of the URL, for example: </para><screen><![CDATA[ftp://joecool@ftp.example.com/]]></screen><para>Squid (from 2.6 through to 3.0) will then use a default password. </para><para>Alternatively, you can specify both your username and password in the URL itself: </para><screen><![CDATA[ftp://joecool:secret@ftp.example.com/]]></screen><para>However, we certainly do not recommend this, as it could be very easy for someone to see or grab your password. </para><para>Starting with <ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/Squid-3.1#">Squid-3.1</ulink>, the above will be tried then regular HTTP Basic authentication will be used to recover new credentials. If login is required and none given a regular website login popup box will appear asking for the credentials to be entered. </para></section><section><title>IE 5.0x crops trailing slashes from FTP URL's</title><para>by <ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/ReubenFarrelly#">ReubenFarrelly</ulink> </para><para>There was a bug in the 5.0x releases of Internet Explorer in which IE cropped any trailing slash off an FTP URL.  The URL showed up correctly in the browser's &quot;Address:&quot; field, however squid logs show that the trailing slash was being taken off. </para><para>An example of where this impacted squid if you had a setup where squid would go direct for FTP directory listings but forward a request to a parent for FTP file transfers.  This was useful if your upstream proxy was an older version of Squid or another vendors software which displayed directory listings with broken icons and you wanted your own local version of squid to generate proper FTP directory listings instead. The workaround for this is to add a double slash to any directory listing in which the slash was important, or else upgrade IE to at least 5.5.  (Or use Firefox if you cannot upgrade your IE) </para></section><section><title>IE 6.0 SP1 fails when using authentication</title><para>When using authentication with Internet Explorer 6 SP1, you may encounter issues when you first launch Internet Explorer. The problem will show itself when you first authenticate, you will receive a &quot;Page Cannot Be Displayed&quot; error. However, if you click refresh, the page will be correctly displayed. </para><para>This only happens immediately after you authenticate. </para><para>This is not a Squid error or bug.   Microsoft broke the Basic Authentication when they put out IE6 SP1. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> this appears to be fixed again in later service packs and IE 7+ </para></listitem></itemizedlist><para>There is a knowledgebase article ( <ulink url="http://support.microsoft.com/default.aspx?id=kb;en-us;331906">KB 331906</ulink>) regarding this issue, which contains a link to a downloadable &quot;hot fix.&quot; They do warn that this code is not &quot;regression tested&quot; but so far there have not been any reports of this breaking anything else. The problematic file is wininet.dll. Please note that this hotfix is included in the latest security update. </para><para>Lloyd Parkes notes that the article references another article, <ulink url="http://support.microsoft.com/default.aspx?scid=kb;EN-US;312176">KB 312176</ulink>. He says that you must <emphasis role="strong">not</emphasis> have the registry entry that KB 312176 encourages users to add to their registry. </para><para>According to Joao Coutinho, this simple solution also corrects the problem: </para><itemizedlist><listitem><para>Go to Tools/Internet </para></listitem><listitem><para>Go to Options/Advanced </para></listitem><listitem><para>UNSELECT &quot;Show friendly HTTP error messages&quot; under Browsing. </para></listitem></itemizedlist><para>Another possible workaround to these problems is to make the ERR_CACHE_ACCESS_DENIED larger than 1460 bytes. This should trigger IE to handle the authentication in a slightly different manner. </para><!--rule (<hr>) is not applicable to DocBook--><para> Back to the <ulink url="https://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers/SquidFaq#">SquidFaq</ulink> </para></section></article>