<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/RAID</title><revhistory><revision><revnumber>12</revnumber><date>2013-01-19 13:07:34</date><authorinitials>Marcus Kool</authorinitials></revision><revision><revnumber>11</revnumber><date>2012-04-25 23:11:42</date><authorinitials>AmosJeffries</authorinitials><revremark>include RAID10 since its so popular.</revremark></revision><revision><revnumber>10</revnumber><date>2010-05-21 07:38:25</date><authorinitials>AmosJeffries</authorinitials><revremark>found references again.</revremark></revision><revision><revnumber>9</revnumber><date>2008-10-10 01:38:13</date><authorinitials>AmosJeffries</authorinitials><revremark>summary for RAID0 to make it like the rest.</revremark></revision><revision><revnumber>8</revnumber><date>2008-10-06 15:48:18</date><authorinitials>Henrik Nordström</authorinitials><revremark>Added some more balanced views on what to do.</revremark></revision><revision><revnumber>7</revnumber><date>2008-10-06 11:20:26</date><authorinitials>Henrik Nordström</authorinitials><revremark>spellcheck</revremark></revision><revision><revnumber>6</revnumber><date>2008-10-06 11:18:03</date><authorinitials>Henrik Nordström</authorinitials><revremark>Added RAID0</revremark></revision><revision><revnumber>5</revnumber><date>2008-05-18 19:38:59</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>4</revnumber><date>2008-03-26 23:23:09</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Detailed more some parts of the article</revremark></revision><revision><revnumber>3</revnumber><date>2008-03-26 17:43:24</date><authorinitials>Marcus Kool</authorinitials><revremark>This article changed significantly and a better title is &quot;RAID disks and Cache availability&quot;</revremark></revision><revision><revnumber>2</revnumber><date>2008-02-14 11:54:11</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>1</revnumber><date>2008-02-14 01:16:33</date><authorinitials>AmosJeffries</authorinitials></revision></revhistory></articleinfo><section><title>Using RAID with Squid cache directories</title><para>The choice of disk storage architecture is an important factor in determining the performance of a Squid cache. </para><para>RAID comes is many flavors and with different properties. For a technical description of RAID you check the relevant entry in <ulink url="http://en.wikipedia.org/wiki/RAID">Wikipedia</ulink> or [[<ulink url="http://www.midwestdatarecovery.com/raid-array-types.html"/> ]]. In a nutshell, RAID is used to increase the reliability of a disk subsystem by redundancy. </para><para>Various options exist for the implementation of a disk system for a Squid cache. The most important parameters for making a choice for any disk system, are <emphasis>price</emphasis>, <emphasis>performance</emphasis> and <emphasis>reliability</emphasis>. </para><para>Reliability is an important parameter for environments where a large number of people depend on the use of technology; the most common mean of increasing a service's reliability is by redundancy of its critical components. RAID disks improve the reliability of a Squid cache while sophisticated disk arrays also add significant performance. Alternatively, you may want to use more than one Squid cache and use load-balancing mechanisms such as <ulink url="http://en.wikipedia.org/wiki/Virtual_Router_Redundancy_Protocol">VRRP</ulink>, external load-balancers or ad-hoc Proxy Auto-Configuration Scripts (see <ulink url="https://wiki.squid-cache.org/SquidFaq/RAID/SquidFaq/ConfiguringBrowsers#">../ConfiguringBrowsers</ulink> and <ulink url="https://wiki.squid-cache.org/SquidFaq/RAID/Technology/ProxyPac#">Technology/ProxyPac</ulink>) to achieve higher availability. </para><para>Performance is also important for modern networking environments which can push MB or GB of data through the Squid cache on a persistent basis even for small numbers of users. </para><para>In the following paragraphs the various options are described in more detail which are meant as a guideline for choosing the option for your Squid cache.  There are other RAID options which are not discussed here.  They are omitted since the author believes that they do not represent better options than the ones already given. </para><para>Price and performance have been rated relative to the JBOD equivalent. </para><section><title>JBOD</title><para>JBOD stands for &quot;Just a Bunch Of Disks&quot; and is the cheapest implementation in a server for a disk system. JBOD has no data protection and a Squid cache fails if a disk that holds one of the cache directories fails. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> There are <ulink url="https://wiki.squid-cache.org/SquidFaq/RAID/Features/CacheDirFailover#">Plans</ulink> to make squid more robust against disk failures. </para></listitem></itemizedlist><para>Since JBOD does not guarantee high availability for the disk subsystem, the easiest way to obtain high reliability is to duplicate the whole cache. </para><para>Use only one cache directory per disk; using more will increase disk head trashing and thus decrease performance. Since drive head seek times are the most limiting performance factor, using many small disks is recommended over few big disks. </para><para>Recommendation: </para><itemizedlist><listitem><para>For most setups the cache content can be easily and fast recovered from live traffic. JBOD with multiple proxies for failover is suitable for most networks. </para></listitem></itemizedlist><para>Summary: </para><itemizedlist><listitem><para>price: lowest. </para></listitem><listitem><para>performance: best. </para></listitem><listitem><para>reliability: modest, the Squid proxy is unavailable in case of a single disk failure </para></listitem></itemizedlist></section><section><title>RAID0 (Striping)</title><para>RAID0 is not really a proper RAID level, more a technique to optimize a system for very large read/write operations on a few very big files, and a administrative tool to merge many smaller disks as if they were one large. </para><para>As squid mostly deals with small I/O operations in the KB range randomly spread out over a large number of files RAID0 do not provide any benefits for Squid and only the drawbacks of loosing the whole cache should a single drive fail. </para><para>The choice of <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> type strongly influences the performance of RAID0. <emphasis role="strong">ufs</emphasis> and <emphasis role="strong">diskd</emphasis> types use one thread IO process per <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> entry. Under RAID0 using N disks you get 1/N the IO speed of the equivalent JBOD configuration. <emphasis role="strong">aufs</emphasis> can be tuned with multiple IO threads per <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> and reduce the performance difference to some degree. </para><para>Recommendation: </para><itemizedlist><listitem><para>Instead use JBOD as it gives you the same price, potentially better performance and better reliability than RAID0/striping. </para></listitem></itemizedlist><para>Summary: </para><itemizedlist><listitem><para>price: lowest. </para></listitem><listitem><para>performance: good. </para></listitem><listitem><para>reliability: poor. risk of losing entire cache. The Squid proxy is also unavailable in case of a single disk failure. </para></listitem></itemizedlist></section><section><title>Software RAID1</title><para>RAID 1, or mirroring, will make one logical disk out of two physical volumes; data is written to both disks simultaneously, and if one disk fails, the system can rely on the one that's still working. One high-level write operation requires two low-level writes, while read operations can be optimized by issuing a single read operation to either disk. </para><para>Since a Squid proxy uses more writes than reads, RAID1 is considered slower than JBOD. The best hardware-level mirroring can attain at most equal speed as JBOD. Software controllers can expect to see 50% increase in CPU overheads on disk IO. </para><para>As with JBOD, it's recommended to use one <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> per logical volume to maximize throughput. </para><para>Recommendation: </para><itemizedlist><listitem><para>Use only if single-proxy uptime is more important than price of the hardware. You will be paying extra for disk storage and high-quality hardware disk controllers. </para></listitem></itemizedlist><para>Summary: </para><itemizedlist><listitem><para>price: high. </para></listitem><listitem><para>performance: quite good. </para></listitem><listitem><para>reliability: good, the system can afford to fail one physical disk per logical volume </para></listitem></itemizedlist></section><section><title>RAID10</title><para>Any chain is only as good as its weakest link. In this case the weak point is the inclusion or RAID-0 operations. See above. </para></section><section><title>Software RAID5</title><para>RAID 5 uses one disk for parity data per logical volume; parity blocks are dispersed among the physical disks for better reliability. One logical volume can generally be made of 2+1 to 7+1 physical disks. </para><para>It is extremely slow, as each high-level write operation on a volume built of N+1 disks will require N+1 reads and 2 writes. </para><itemizedlist><listitem override="none"><para>If you have 4 disks, Software RAID1 is considered better than Software RAID5 since you can make 2 logical disks with RAID1 and only 1 logical disk with RAID5 and using more logical disks improves Squid performance. </para></listitem></itemizedlist><para>Use only one cache directory per logical disk. Do not put multiple logical disks on the same set of physical disks. </para><para>Summary: </para><itemizedlist><listitem><para>price: low </para></listitem><listitem><para>performance: low </para></listitem><listitem><para>reliability: good </para></listitem></itemizedlist></section><section><title>Hardware RAID1 or RAID5</title><para>Hardware RAID1 or RAID5 is implemented by specialized co-processors or add-on cards, which offload the processing tasks from the main system CPU, and perform additional optimizations such a battery-backed cache. It is a relatively cheap solution to have good reliability and performance. </para><para>The same recommendations as with the respective software counterparts apply. </para><para>Summary: </para><itemizedlist><listitem><para>price: modest (An extra server with VRRP is comparably expensive) </para></listitem><listitem><para>performance: modest to good, depending on the RAID controller and disk architecture </para></listitem><listitem><para>reliability: good </para></listitem></itemizedlist></section><section><title>Sophisticated Disk Arrays</title><para>Sophisticated disk arrays from all hardware vendors and specialized firms are well known for their extremely high performance, reliability and price tag. </para><para>They generally consist of big to enormous storage pools, which then are sliced and virtualized over <ulink url="http://en.wikipedia.org/wiki/Fiber_channel">fiber-channel</ulink> or <ulink url="http://en.wikipedia.org/wiki/ISCSI">iSCSI</ulink> transport layers. Sophisticated management and caching mechanisms are used to maximize disk throughput.  Thanks to those writes can be considered nearly instantaneous, and reads are very fast. </para><para>Use only one cache directory per logical disk. Configure the logical disk to use many spindles. Using more logical disks improves performance. </para><para>Summary: </para><itemizedlist><listitem><para>price: highest </para></listitem><listitem><para>performance: highest </para></listitem><listitem><para>reliability: highest </para></listitem></itemizedlist></section><section><title>So what should I do?</title><para>It depends, there is no one-size-fits-all approach, it depends on your organization's needs. In general, the cheapest way to obtain an higher reliability is by duplicating the caches and using cheap storage, at the expense of some extra complexity at the network level. </para><para>For nearly most setups the JBOD approach is the most beneficial, maybe with a software RAID1 for the OS. Also one may prefer to build two cache servers than spending a lot of money on the disk subsystem. You will need at least 4 drives for optimal performance. Above 4 cache drives it's hard to see any additional performance gains. </para><para>If you do not need absolutely top performance and your organisation has standardized on hardware with built-in RAID5 controller then that's a suitable choice as it gives you high reliability and easy service, but it's not the best performer if you really need to push the limits. </para></section></section></article>