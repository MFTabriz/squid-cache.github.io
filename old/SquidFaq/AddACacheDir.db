<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/AddACacheDir</title><revhistory><revision><revnumber>3</revnumber><date>2009-11-03 05:18:36</date><authorinitials>AmosJeffries</authorinitials><revremark>add Henriks polish to the downtime reduction voodoo.</revremark></revision><revision><revnumber>2</revnumber><date>2008-08-20 07:56:40</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Altered wiki layout to match FAQ standards - for index etc.</revremark></revision><revision><revnumber>1</revnumber><date>2008-08-20 05:33:25</date><authorinitials>AmosJeffries</authorinitials><revremark>create from squid-users</revremark></revision></revhistory></articleinfo><section><title>Adding a Cache Dir</title><para><emphasis>by Chris Robertson</emphasis> </para><para>Adding a new drive to Squids cache directory set is a useful thing to know. And simple as well. </para><para>Squid will handle the changes semi-automatically, but there are still a few operations that need to be kicked off manually. </para><para>Assuming your disk is attached, your OS recognizes it and the disk is formatted: </para><orderedlist numeration="arabic"><listitem><para>Ensure the <ulink url="http://www.squid-cache.org/Doc/config/cache_effective_user#">cache_effective_user</ulink> has write capability on the mount point </para></listitem><listitem><para>Add a <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> directive to squid.conf referencing the new mount point </para></listitem><listitem><para>Stop squid </para></listitem><listitem><para>Run <code>squid -z</code> (as root or as the <ulink url="http://www.squid-cache.org/Doc/config/cache_effective_user#">cache_effective_user</ulink>) </para></listitem><listitem><para>Start squid </para></listitem></orderedlist></section><section><title>Downtime reduction hack</title><para><emphasis>by <ulink url="https://wiki.squid-cache.org/SquidFaq/AddACacheDir/AmosJeffries#">AmosJeffries</ulink> and <ulink url="https://wiki.squid-cache.org/SquidFaq/AddACacheDir/HenrikNordstrom#">HenrikNordstrom</ulink></emphasis> </para><para>NP: this does not apply to large caches as there is no touching of the existing cache_dir anyway. </para><orderedlist numeration="arabic"><listitem><para>Ensure the <ulink url="http://www.squid-cache.org/Doc/config/cache_effective_user#">cache_effective_user</ulink> has write capability on the mount point </para></listitem><listitem><para>Temporarily change squid.conf to use another <ulink url="http://www.squid-cache.org/Doc/config/pid_filename#">pid_filename</ulink>. <code>squid -z</code> will abort early if it discovers another running squid instance </para></listitem><listitem><para>Add a <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> directive to squid.conf referencing the new mount point </para></listitem><listitem><para>Temporarily: comment out the existing <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> entries </para></listitem><listitem><para>Run <code>squid -z -f ./squid.conf</code> (as root or as the <ulink url="http://www.squid-cache.org/Doc/config/cache_effective_user#">cache_effective_user</ulink>) </para></listitem><listitem><para>Undo the temporary changes to <ulink url="http://www.squid-cache.org/Doc/config/pid_filename#">pid_filename</ulink> and pre-existing <ulink url="http://www.squid-cache.org/Doc/config/cache_dir#">cache_dir</ulink> </para></listitem><listitem><para>Reconfigure the running squid with <code>squid -k reconfigure</code> </para><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> While the -z with existing ufs/aufs/diskd is harmless it's a destructive operation with for example coss <ulink url="http://www.squid-cache.org/Doc/config/cache_dirs#">cache_dirs</ulink> so commenting them out is important. </para></listitem></orderedlist><!--rule (<hr>) is not applicable to DocBook--><para> Back to the <ulink url="https://wiki.squid-cache.org/SquidFaq/AddACacheDir/SquidFaq#">SquidFaq</ulink> </para></section></article>