<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>SquidFaq/InstallingSquid</title><revhistory><revision><revnumber>30</revnumber><date>2016-09-29 13:48:32</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>29</revnumber><date>2016-09-29 13:46:59</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>28</revnumber><date>2015-12-23 14:34:52</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>27</revnumber><date>2015-12-23 14:31:33</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>26</revnumber><date>2015-07-20 18:58:33</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>25</revnumber><date>2015-07-20 18:52:40</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>24</revnumber><date>2015-07-20 18:48:33</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>23</revnumber><date>2015-02-26 21:36:02</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>22</revnumber><date>2015-01-10 15:32:03</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>21</revnumber><date>2015-01-10 15:29:46</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>20</revnumber><date>2015-01-10 15:18:02</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>19</revnumber><date>2015-01-10 15:17:08</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>18</revnumber><date>2015-01-10 15:15:08</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>17</revnumber><date>2015-01-10 15:14:42</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>16</revnumber><date>2012-10-27 10:00:04</date><authorinitials>FrancescoChemolli</authorinitials><revremark>fixed mistake in init script</revremark></revision><revision><revnumber>15</revnumber><date>2010-02-22 11:12:34</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fixed dangling wiki-links</revremark></revision><revision><revnumber>14</revnumber><date>2009-11-12 11:05:12</date><authorinitials>AmosJeffries</authorinitials><revremark>link binary package install info from binary packages page. Shuffle FreeBSD info over there.</revremark></revision><revision><revnumber>13</revnumber><date>2009-03-31 05:54:26</date><authorinitials>AmosJeffries</authorinitials><revremark>less scary description of the cache.log</revremark></revision><revision><revnumber>12</revnumber><date>2009-03-31 05:28:19</date><authorinitials>AmosJeffries</authorinitials><revremark>add sub-sections for per-OS install instructions</revremark></revision><revision><revnumber>11</revnumber><date>2009-01-07 06:36:10</date><authorinitials>AmosJeffries</authorinitials><revremark>remove pre-2.5 details.</revremark></revision><revision><revnumber>10</revnumber><date>2008-05-18 19:38:56</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>9</revnumber><date>2008-02-19 01:57:01</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>8</revnumber><date>2008-02-19 01:56:01</date><authorinitials>AmosJeffries</authorinitials><revremark>move details on configuration to ConfiguringSquid page. link to it from here.</revremark></revision><revision><revnumber>7</revnumber><date>2006-09-28 20:58:42</date><authorinitials>chello212186153102.chello.pl</authorinitials></revision><revision><revnumber>6</revnumber><date>2006-08-25 09:12:56</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>5</revnumber><date>2006-06-04 06:00:37</date><authorinitials>ReubenFarrelly</authorinitials><revremark>Update comments about RAID and memory</revremark></revision><revision><revnumber>4</revnumber><date>2006-03-03 09:19:44</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>3</revnumber><date>2006-01-27 21:59:44</date><authorinitials>kinkie</authorinitials><revremark>Added link to index</revremark></revision><revision><revnumber>2</revnumber><date>2006-01-27 21:58:40</date><authorinitials>kinkie</authorinitials><revremark>Fixed spelling and formatting</revremark></revision><revision><revnumber>1</revnumber><date>2006-01-24 13:51:33</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>How big of a system do I need to run Squid?</title><para>There are no hard-and-fast rules.  The most important resource for Squid is physical memory, so put as much in your Squid box as you can.  Your processor does not need to be ultra-fast. We recommend buying whatever is economical at the time. </para><para>Your disk system will be the major bottleneck, so fast disks are important for high-volume caches. SCSI disks generally perform better than ATA, if you can afford them. Serial ATA (SATA) performs somewhere between the two. Your system disk, and logfile disk can probably be IDE without losing any cache performance. </para><para>The ratio of memory-to-disk can be important.  We recommend that you have at least 32 MB of RAM for each GB of disk space that you plan to use for caching. </para></section><section><title>How do I install Squid?</title><para>From <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/BinaryPackages#">Binary Packages</ulink> if available for your operating system. </para><para>Or from Source Code. </para><para>After <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/CompilingSquid#">SquidFaq/CompilingSquid</ulink>, you can install it with this simple command: </para><screen><![CDATA[% make install]]></screen><para>If you have enabled ICMP or the <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/OperatingSquid#">pinger</ulink> then you will also want to type </para><screen><![CDATA[% su
# make install-pinger]]></screen><para>After installing, you will want to read <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/ConfiguringSquid#">SquidFaq/ConfiguringSquid</ulink> to edit and customize Squid to run the way you want it to.  </para></section><section><title>How do I start Squid?</title><para>First you need to check your Squid configuration. The Squid configuration can be found in <emphasis>/usr/local/squid/etc/squid.conf</emphasis> and includes documentation on all directives. </para><para>In the Squid distribution there is a small QUICKSTART guide indicating which directives you need to look closer at and why. At a absolute minimum you need to change the http_access configuration to allow access from your clients. </para><para>To verify your configuration file you can use the -k parse option </para><screen><![CDATA[% /usr/local/squid/sbin/squid -k parse]]></screen><para>If this outputs any errors then these are syntax errors or other fatal misconfigurations and needs to be corrected before you continue. If it is silent and immediately gives back the command prompt then your squid.conf is syntactically correct and could be understood by Squid. </para><para>After you've finished editing the configuration file, you can start Squid for the first time.  The procedure depends a little bit on which version you are using. </para><para>First, you must create the swap directories.  Do this by running Squid with the -z option: </para><screen><![CDATA[% /usr/local/squid/sbin/squid -z]]></screen><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/attention.png" width="15"/></imageobject><textobject><phrase>&lt;!&gt;</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para>If you run Squid as root then you may need to first create <emphasis>/usr/local/squid/var/logs</emphasis> and your <emphasis>cache_dir</emphasis> directories and assign ownership of these to the cache_effective_user configured in your squid.conf</para></entry></row></tbody></tgroup></informaltable><para>Once the creation of the cache directories completes, you can start Squid and try it out. Probably the best thing to do is run it from your terminal and watch the debugging output.  Use this command: </para><screen><![CDATA[% /usr/local/squid/sbin/squid -NCd1]]></screen><para>If everything is working okay, you will see the line: </para><screen><![CDATA[Ready to serve requests.]]></screen><para>If you want to run squid in the background, as a daemon process, just leave off all options: </para><screen><![CDATA[% /usr/local/squid/sbin/squid]]></screen><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/attention.png" width="15"/></imageobject><textobject><phrase>&lt;!&gt;</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para>Depending on which http_port you select you may need to start squid as root (http_port &lt;1024)</para></entry></row></tbody></tgroup></informaltable></section><section><title>How do I start Squid automatically when the system boots?</title><section><title>by hand</title><para>Squid has a restart feature built in.  This greatly simplifies starting Squid and means that you don't need to use <emphasis>RunCache</emphasis> or <emphasis>inittab</emphasis>.  At the minimum, you only need to enter the pathname to the Squid executable.  For example: </para><screen><![CDATA[/usr/local/squid/sbin/squid]]></screen><para>Squid will automatically background itself and then spawn a child process.  In your <emphasis>syslog</emphasis> messages file, you should see something like this: </para><screen><![CDATA[Sep 23 23:55:58 kitty squid[14616]: Squid Parent: child process 14617 started]]></screen><para>That means that process ID 14563 is the parent process which monitors the child process (pid 14617).  The child process is the one that does all of the work. The parent process just waits for the child process to exit. If the child process exits unexpectedly, the parent will automatically start another child process.  In that case, <emphasis>syslog</emphasis> shows: </para><screen><![CDATA[Sep 23 23:56:02 kitty squid[14616]: Squid Parent: child process 14617 exited with status 1
Sep 23 23:56:05 kitty squid[14616]: Squid Parent: child process 14619 started]]></screen><para>If there is some problem, and Squid can not start, the parent process will give up after a while.  Your <emphasis>syslog</emphasis> will show: </para><screen><![CDATA[Sep 23 23:56:12 kitty squid[14616]: Exiting due to repeated, frequent failures]]></screen><para>When this happens you should check your <emphasis>syslog</emphasis> messages and <emphasis>cache.log</emphasis> file for error messages. </para><para>When  you look at a process (<emphasis>ps</emphasis> command) listing, you'll see two squid processes: </para><screen><![CDATA[24353  ??  Ss     0:00.00 /usr/local/squid/bin/squid
24354  ??  R      0:03.39 (squid) (squid)]]></screen><para>The first is the parent process, and the child process is the one called &quot;(squid)&quot;. Note that if you accidentally kill the parent process, the child process will not notice. </para><para>If you want to run Squid from your termainal and prevent it from backgrounding and spawning a child process, use the <emphasis>-N</emphasis> command line option. </para><screen><![CDATA[/usr/local/squid/bin/squid -N]]></screen></section><section><title>from inittab</title><para>On systems which have an <emphasis>/etc/inittab</emphasis> file (Digital Unix, old Solaris, IRIX, HP-UX, Linux), you can add a line like this: </para><screen><![CDATA[sq:3:respawn:/usr/local/squid/sbin/squid.sh < /dev/null >> /tmp/squid.log 2>&1]]></screen><para>We recommend using a <emphasis>squid.sh</emphasis> shell script, but you could instead call Squid directly with the -N option and other options you may require.  A sample <emphasis>squid.sh</emphasis> script is shown below: </para><screen><![CDATA[C=/usr/local/squid
PATH=/usr/bin:$C/bin
TZ=PST8PDT
export PATH TZ
]]><![CDATA[
# User to notify on restarts
notify="root"
]]><![CDATA[
# Squid command line options
opts=""
]]><![CDATA[
cd $C
umask 022
sleep 10
while [ -f /var/run/nosquid ]; do
        sleep 1
done
/usr/bin/tail -20 $C/logs/cache.log \
        | Mail -s "Squid restart on `hostname` at `date`" $notify
exec bin/squid -N $opts]]></screen></section><section><title>from rc.local</title><para>On BSD-ish systems, you will need to start Squid from the &quot;rc&quot; files, usually <emphasis>/etc/rc.local</emphasis>.  For example: </para><screen><![CDATA[if [ -f /usr/local/squid/sbin/squid ]; then
        echo -n ' Squid'
        /usr/local/squid/sbin/squid
fi]]></screen></section><section><title>from init.d</title><para>Squid ships with a init.d type startup script in contrib/squid.rc which works on most init.d type systems. Or you can write your own using any normal init.d script found in your system as template and add the start/stop fragments shown below. </para><para>Start: </para><screen><![CDATA[/usr/local/squid/sbin/squid]]></screen><para>Stop: </para><screen><![CDATA[/usr/local/squid/sbin/squid -k shutdown
n=120
while /usr/local/squid/sbin/squid -k check && [ $n -gt 0 ]; do
    sleep 1
    echo -n .
    n=`expr $n - 1`
done]]></screen></section><section><title>with daemontools</title><para>Create squid service directory, and the log directory (if it does not exist yet). </para><screen><![CDATA[mkdir -p /usr/local/squid/supervise/log /var/log/squid
chown squid /var/log/squid]]></screen><para>Then, change to the service directory, </para><screen><![CDATA[cd /usr/local/squid/supervise]]></screen><para>and create 2 executable scripts: <emphasis role="strong">run</emphasis> </para><screen><![CDATA[rm -f /var/run/squid/squid.pid
exec /usr/local/squid/sbin/squid -N 2>&1]]></screen><para>and <emphasis role="strong">log/run</emphasis>. </para><screen><![CDATA[exec /usr/local/bin/multilog t /var/log/squid]]></screen><para>Finally, start the squid service by linking it into svscan monitored area. </para><screen><![CDATA[cd /service
ln -s /usr/local/squid/supervise squid]]></screen><para>Squid should start within 5 seconds. </para></section><section><title>from SMF</title><para>On new Solaris (10 and above) inittab/sysvinit is deprecated and is recommended to use new SMF (Service Management Facility). </para><para>To do that you need to create service manifest in XML format like this: </para><screen><![CDATA[<?xml version="1.0"?>
<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
<!--   Manifest-file for Squid
-->
<service_bundle type='manifest' name='Squid'>
]]><![CDATA[
<service
        name='network/squid'
        type='service'
        version='1'>
]]><![CDATA[
        <create_default_instance enabled='false' />
]]><![CDATA[
        <single_instance />
]]><![CDATA[
        <dependency name='fs-local'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri
                        value='svc:/system/filesystem/local' />
        </dependency>
]]><![CDATA[
        <dependency name='net-loopback'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri value='svc:/network/loopback' />
        </dependency>
]]><![CDATA[
        <dependency name='net-physical'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri value='svc:/network/physical' />
        </dependency>
]]><![CDATA[
        <dependency name='utmp'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri value='svc:/system/utmp' />
        </dependency>
]]><![CDATA[
        <dependency name='squid_config_data'
                grouping='require_all'
                restart_on='refresh'
                type='path'>
                <service_fmri value='file://localhost/usr/local/squid/etc/squid.conf' />
        </dependency>
]]><![CDATA[
        <exec_method
                type='method'
                name='start'
                exec='/lib/svc/method/init.squid %m'
                timeout_seconds='60'/>
]]><![CDATA[
        <exec_method
                type='method'
                name='stop'
                exec='/lib/svc/method/init.squid %m'
                timeout_seconds='60' />
]]><![CDATA[
        <exec_method
                type='method'
                name='refresh'
                exec='/lib/svc/method/init.squid %m'
                timeout_seconds='60' />
]]><![CDATA[
        <exec_method
                type='method'
                name='restart'
                exec='/lib/svc/method/init.squid %m'
                timeout_seconds='60' />
]]><![CDATA[
        <property_group name='general' type='framework'>
                <!-- to start stop squid -->
                <propval name='action_authorization' type='astring'
                        value='solaris.smf.manage' />
        </property_group>
]]><![CDATA[
        <stability value='Unstable' />
]]><![CDATA[
        <template>
                <common_name>
                        <loctext xml:lang='C'>
                        Squid proxy server
                        </loctext>
                </common_name>
                <documentation>
                        <manpage title='squid' section='8' manpath='/usr/local/squid/share/man/man8' />
                </documentation>
        </template>
]]><![CDATA[
</service>
]]><![CDATA[
</service_bundle>]]></screen><para>then put this file in  /var/svc/manifest/network directory and execute command </para><screen><![CDATA[svccfg import /var/svc/manifest/network/squid.xml]]></screen><para>as root. Then create init-like script (named service method) with command-line arguments start|stop|refresh|restart, put it into /lib/svc/method, and execute command  </para><screen><![CDATA[svcadm enable squid]]></screen><para>You can get complete Squid SMF scripts with all needful to run it on Solaris here: <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/InstallingSquid?action=AttachFile&amp;do=get&amp;target=squid_autostart25.tar.gz">squid_autostart25.tar.gz</ulink> </para></section></section><section><title>How do I tell if Squid is running?</title><para>You can use the <emphasis>squidclient</emphasis> program: </para><screen><![CDATA[% squidclient http://www.netscape.com/ > test]]></screen><para>There are other command-line HTTP client programs available as well.  Two that you may find useful are <ulink url="ftp://gnjilux.cc.fer.hr/pub/unix/util/wget/">wget</ulink> and <ulink url="ftp://ftp.internatif.org/pub/unix/echoping/">echoping</ulink>. </para><para>Another way is to use Squid itself to see if it can signal a running Squid process: </para><screen><![CDATA[% squid -k check]]></screen><para>And then check the shell's exit status variable. </para><para>Also, check the log files, most importantly the <emphasis>access.log</emphasis> and <emphasis>cache.log</emphasis> files. </para></section><section><title>squid command line options</title><para>These are the command line options for <emphasis role="strong">Squid-2</emphasis>: </para><para><emphasis role="strong">-a</emphasis> Specify an alternate port number for incoming HTTP requests. Useful for testing a configuration file on a non-standard port. </para><para><emphasis role="strong">-d</emphasis> Debugging level for &quot;stderr&quot; messages.  If you use this option, then debugging messages up to the specified level will also be written to stderr. </para><para><emphasis role="strong">-f</emphasis> Specify an alternate <emphasis>squid.conf</emphasis> file instead of the pathname compiled into the executable. </para><para><emphasis role="strong">-h</emphasis> Prints the usage and help message. </para><para><emphasis role="strong">-k reconfigure</emphasis> Sends a <emphasis>HUP</emphasis> signal, which causes Squid to re-read its configuration files. </para><para><emphasis role="strong">-k rotate</emphasis> Sends an <emphasis>USR1</emphasis> signal, which causes Squid to rotate its log files.  Note, if <emphasis>logfile_rotate</emphasis> is set to zero, Squid still closes and re-opens all log files. </para><para><emphasis role="strong">-k shutdown</emphasis> Sends a <emphasis>TERM</emphasis> signal, which causes Squid to wait briefly for current connections to finish and then exit.  The amount of time to wait is specified with <emphasis>shutdown_lifetime</emphasis>. </para><para><emphasis role="strong">-k interrupt</emphasis> Sends an <emphasis>INT</emphasis> signal, which causes Squid to shutdown immediately, without waiting for current connections. </para><para><emphasis role="strong">-k kill</emphasis> Sends a <emphasis>KILL</emphasis> signal, which causes the Squid process to exit immediately, without closing any connections or log files.  Use this only as a last resort. </para><para><emphasis role="strong">-k debug</emphasis> Sends an <emphasis>USR2</emphasis> signal, which causes Squid to generate full debugging messages until the next <emphasis>USR2</emphasis> signal is recieved.  Obviously very useful for debugging problems. </para><para><emphasis role="strong">-k check</emphasis> Sends a &quot;<emphasis>ZERO</emphasis>&quot; signal to the Squid process. This simply checks whether or not the process is actually running. </para><para><emphasis role="strong">-s</emphasis> Send debugging (level 0 only) message to syslog. </para><para><emphasis role="strong">-u</emphasis> Specify an alternate port number for ICP messages. Useful for testing a configuration file on a non-standard port. </para><para><emphasis role="strong">-v</emphasis> Prints the Squid version. </para><para><emphasis role="strong">-z</emphasis> Creates disk swap directories.  You must use this option when installing Squid for the first time, or when you add or modify the <emphasis>cache_dir</emphasis> configuration. </para><para><emphasis role="strong">-D</emphasis> Do not make initial DNS tests.  Normally, Squid looks up some well-known DNS hostnames to ensure that your DNS name resolution service is working properly. <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/idea.png" width="15"/></imageobject><textobject><phrase>(!)</phrase></textobject></inlinemediaobject> obsolete in 3.1 and later. </para><para><emphasis role="strong">-F</emphasis> If the <emphasis>swap.state</emphasis> logs are clean, then the cache is rebuilt in the &quot;foreground&quot; before any requests are served.  This will decrease the time required to rebuild the cache, but HTTP requests will not be satisfied during this time. </para><para><emphasis role="strong">-N</emphasis> Do not automatically become a background daemon process. </para><para><emphasis role="strong">-R</emphasis> Do not set the SO_REUSEADDR option on sockets. </para><para><emphasis role="strong">-X</emphasis> Enable full debugging while parsing the config file. </para><para><emphasis role="strong">-Y</emphasis> Return ICP_OP_MISS_NOFETCH instead of ICP_OP_MISS while the <emphasis>swap.state</emphasis> file is being read.  If your cache has mostly child caches which use ICP, this will allow your cache to rebuild faster. </para></section><section><title>How do I see how Squid works?</title><itemizedlist><listitem><para>Check the <emphasis>cache.log</emphasis> file in your logs directory.  It logs interesting things as a part of its normal operation and can be boosted to show all the boring details. </para></listitem><listitem><para>Install and use the <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/CacheManager#">../CacheManager</ulink>. </para></listitem></itemizedlist></section><section><title>Can Squid benefit from SMP systems?</title><para>Squid is a single process application and can not make use of SMP. If you want to make Squid benefit from a SMP system you will need to run multiple instances of Squid and find a way to distribute your users on the different Squid instances just as if you had multiple Squid boxes. </para><para>Having two CPUs is indeed nice for running other CPU intensive tasks on the same server as the proxy, such as if you have a lot of logs and need to run various statistics collections during peak hours. </para><para>The authentication and group helpers barely use any CPU and does not benefit much from dual-CPU configuration. </para></section><section><title>Is it okay to use separate drives for Squid?</title><para>Yes.  Running Squid on separate drives to that which your OS is running is often a very good idea. </para><para>Generally seek time is what you want to optimize for Squid, or more precisely the total amount of seeks/s your system can sustain.  This is why it is better to have your cache_dir spread over multiple smaller disks than one huge drive (especially with SCSI). </para><para>If your system is very I/O bound, you will want to have both your OS and log directories running on separate drives. </para></section><section><title>Is it okay to use RAID on Squid?</title><para>see Section on <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq/RAID#">RAID</ulink> </para></section><section><title>Is it okay to use ZFS on Squid?</title><para>Yes. Running Squid on native ZFS-supporting systems, like Solaris or <ulink url="http://openindiana.org">OpenIndiana</ulink> is well-known practice. </para><para>In general, just set up ZFS mirror (usually the best with separate controllers for each spindle) and set recordsize 4-64k (depending your cache prefferable cache_replacement_policy). Also it can better for disk IO performance to change primarycache=metadata and secondarycache=none, and  atime=off on cache_dir filesystems. Consider to correctly set <emphasis role="strong">logbias</emphasis> property for zfs fs which Squid's cache stores. Default value for this property is <emphasis>latency</emphasis>, which is appropriate for software ZFS raid/mirror. When ZFS created over hardware RAID5/10, set this property to <emphasis>throughput</emphasis> to avoid much TCP_SWAPFAIL_MISS. On system level the good idea is limiting ZFS ARC size to 1/8-1/4 of RAM by setting zfs:zfs_arc_max. </para><para>ZFS works perfectly both diskd and aufs Squid storeIO modules (best choise depending your box/storage architecture). </para><!--rule (<hr>) is not applicable to DocBook--><para> Back to the <ulink url="https://wiki.squid-cache.org/SquidFaq/InstallingSquid/SquidFaq#">SquidFaq</ulink> </para></section></article>