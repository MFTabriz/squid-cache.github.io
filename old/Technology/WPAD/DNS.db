<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Technology/WPAD/DNS</title><revhistory><revision><revnumber>5</revnumber><date>2008-11-01 03:56:47</date><authorinitials>AmosJeffries</authorinitials><revremark>additions.</revremark></revision><revision><revnumber>4</revnumber><date>2008-05-18 19:38:56</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>3</revnumber><date>2007-05-17 01:39:06</date><authorinitials>eye4.tribune.com</authorinitials></revision><revision><revnumber>2</revnumber><date>2007-05-12 09:02:50</date><authorinitials>AdrianChadd</authorinitials></revision><revision><revnumber>1</revnumber><date>2007-05-11 08:28:09</date><authorinitials>AdrianChadd</authorinitials></revision></revhistory></articleinfo><section><title>Web Proxy Auto Detection using DNS</title><section><title>Overview</title><para>WPAD can use DNS to probe for the existance of a WPAD web server to fetch the proxy configuration file from. The WPAD specification enumerates a number of possibilities; the only required DNS method is the &quot;Well known alias&quot; method. </para><para>The &quot;Well known alias&quot; method simply requires a &quot;wpad.&quot; host to have an IN A DNS resource entry. The User Agent constructs a series of DNS lookups to discover this hostname and if it finds the host it will query a web server at that host for a proxy autoconfiguration file. </para><para>A handful of other DNS-related methods are documented in the WPAD specification; they are not covered in this article. </para></section><section><title>Explanation</title><para>A WPAD-enabled User Agent will construct a DNS lookup for a &quot;wpad&quot; host in a list of domain names. It may assemble this domain name list from a variety of sources, including: </para><itemizedlist><listitem><para>The reverse DNS resolution of the hosts' IP; </para></listitem><listitem><para>Configured DNS domain search list </para></listitem></itemizedlist><para>The User Agent then tries an address (A) lookup for each of the domain entries, prepended with &quot;wpad&quot;. If it doesn't find an A response it tries the next domain in the domain search list.  Some clients may also remove the leftmost part of the domain name and try again. </para><para>If an A record is found, the User Agent then attempts to connect to the webserver at that address on the HTTP port (normally port 80) and requests the &quot;/wpad.dat&quot; file, with the Host set to the domain name. </para></section><section><title>Example</title><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Note: This example is browser and IPv4 specific. </para></listitem></itemizedlist><para>A client has an IP 1.2.3.4 which resolves to host-1-2-3-4.pop1.isp.net. The client has their DNS search set to &quot;isp.net&quot;. The ISP runs a WPAD server at wpad.isp.net. </para><itemizedlist><listitem><para>The client does a PTR lookup on 1.2.3.4 and finds it resolves to host-1.2.3.4.pop1.isp.net; </para></listitem><listitem><para>The client does an A lookup on wpad.pop1.isp.net and finds it doesn't exist; </para></listitem><listitem><para>The client does an A lookup on wpad.isp.net and finds it exists; </para></listitem><listitem><para>The client issues a HTTP request to wpad.isp.net requesting <ulink url="http://wpad.isp.net/wpad.dat;"/> </para></listitem><listitem><para>The client retrieves wpad.dat and uses it as its proxy autoconfiguration script. </para></listitem></itemizedlist></section><section><title>Implementation Issues</title><itemizedlist><listitem><para>Some have reported that various WPAD implementations require the WPAD host name to match one or more of the listed domains in the DNS domain search list. This is unverified but please consider ensuring the wpad domain exists in the DNS search list. </para><itemizedlist><listitem><para>If the IP resolves to host-x-x-x-x.pop1.isp.net, and the WPAD DNS name is wpad.isp.net, make sure &quot;isp.net&quot; is configured in the DNS search list. </para></listitem><listitem><para>If the IP resolves to host-x.x.x.x.pop1.isp.net, and the WPAD DNS name is wpad.pop1.isp.net, having &quot;isp.net&quot; in the DNS search list may not be enough. </para></listitem></itemizedlist></listitem></itemizedlist></section><section><title>Security Concerns</title><section><title>WPAD DNS server searching</title><para>WPAD searches the DNS looking for wpad. at each domain.  Additionally, many clients implement a &quot;Fallback&quot; mechanism which checks the parent domains as well. This means the following kind of example can occur: </para><itemizedlist><listitem><para>WPAD looks for wpad.corp.example.com.; </para></listitem><listitem><para>WPAD looks for wpad.example.com.; </para></listitem><listitem><para>WPAD looks for wpad.com.; </para></listitem><listitem><para>WPAD looks for wpad.; </para></listitem></itemizedlist><para>This can mean that a server configured to answer to the 'wpad' host in a parent domain may return a proxy autoconfiguration file for an external proxy service. This could be used as part of a denial of service or to intercept client traffic.  This &quot;Fallback&quot; mechanism is deprecated by the IETF and is disabled in Mozilla Firefox, but may still be implemented in some browsers. </para><para>Duane Wessels owns wpad.net, wpad.org and wpad.com; he provides graphed statistics for his webserver at <ulink url="http://www.life-gone-hazy.com/%7esnmp/http_status.cgi"/> . (I believe the 404's include failed wpad.dat lookups; I should check -Adrian). </para><para>It would be nice if Registrars prohibited the registration of the &quot;wpad&quot; domain name; its not known if this is policy for any current DNS registry. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Technology/WPAD/DNS/CategoryTechnology#">CategoryTechnology</ulink> </para></section></section></section></article>