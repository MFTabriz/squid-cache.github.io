<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>EliezerCroitoru/Dnsbl/client_helper</title><revhistory><revision><revnumber>3</revnumber><date>2017-10-06 01:39:40</date><authorinitials>Eliezer Croitoru</authorinitials><revremark>Updated for testing bug 4778.</revremark></revision><revision><revnumber>2</revnumber><date>2014-11-16 15:45:16</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Renamed from 'EliezerCroitoru/Dnsl/client_helper'.</revremark></revision><revision><revnumber>1</revnumber><date>2014-11-16 14:55:56</date><authorinitials>Eliezer Croitoru</authorinitials></revision></revhistory></articleinfo><programlisting format="linespecific" language="highlight" linenumbering="numbered" startinglinenumber="1"><lineannotation><![CDATA[#!/usr/bin/ruby]]></lineannotation>
<lineannotation><![CDATA[# license note]]></lineannotation>
<lineannotation><![CDATA[# Copyright (c) 2017, Eliezer Croitoru]]></lineannotation>
<lineannotation><![CDATA[# All rights reserved.]]></lineannotation>
<lineannotation><![CDATA[#]]></lineannotation>
<lineannotation><![CDATA[# Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:]]></lineannotation>
<lineannotation><![CDATA[#]]></lineannotation>
<lineannotation><![CDATA[# 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.]]></lineannotation>
<lineannotation><![CDATA[#]]></lineannotation>
<lineannotation><![CDATA[# 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.]]></lineannotation>
<lineannotation><![CDATA[#]]></lineannotation>
<lineannotation><![CDATA[# 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.]]></lineannotation>
<lineannotation><![CDATA[#]]></lineannotation>
<lineannotation><![CDATA[# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE]]></lineannotation>

<token><![CDATA[require]]></token><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[open-uri]]></phrase><phrase><![CDATA["]]></phrase>
<token><![CDATA[require]]></token><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[syslog]]></phrase><phrase><![CDATA["]]></phrase>
<token><![CDATA[require]]></token><![CDATA[ ]]><phrase><![CDATA['resolv']]></phrase>
<token><![CDATA[require]]></token><![CDATA[ ]]><phrase><![CDATA['timeout']]></phrase>

<symbol><![CDATA[Signal]]></symbol><![CDATA[.]]><methodname><![CDATA[trap]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[TERM]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[do]]></token>
<![CDATA[  ]]><symbol><![CDATA[STDERR]]></symbol><![CDATA[.]]><methodname><![CDATA[puts]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[Terminating...]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[  ]]><symbol><![CDATA[Syslog]]></symbol><![CDATA[.]]><methodname><![CDATA[close]]></methodname>
<![CDATA[  ]]><token><![CDATA[exit]]></token><![CDATA[ 1]]>
<token><![CDATA[end]]></token>

<lineannotation><![CDATA[#squid external_acl format:]]></lineannotation>
<lineannotation><![CDATA[# %URI %METHOD %SRC %PORT %MYPORT]]></lineannotation>
<lineannotation><![CDATA[#0 http://askubuntu.com/ 192.168.10.131/- - GET myip=192.168.10.1 myport=3128]]></lineannotation>
<lineannotation><![CDATA[#example settings:]]></lineannotation>
<lineannotation><![CDATA[#external_acl_type filtering_helper ttl=2 children-startup=2 children-max=10 %URI %METHOD %SRC %PORT %MYPORT /opt/external_acl/run1.rb]]></lineannotation>
<lineannotation><![CDATA[#acl filtering_helper_acl external filtering_helper]]></lineannotation>
<lineannotation><![CDATA[#http_access allow localnet filtering_helper_acl]]></lineannotation>

<methodname><![CDATA[$debug]]></methodname><![CDATA[ = ]]><token><![CDATA[false]]></token>
<methodname><![CDATA[$stderrdebug]]></methodname><![CDATA[ = ]]><token><![CDATA[false]]></token>
<methodname><![CDATA[$dns_db]]></methodname><![CDATA[ = ]]><symbol><![CDATA[Resolv]]></symbol><![CDATA[::]]><symbol><![CDATA[DNS]]></symbol><![CDATA[.]]><methodname><![CDATA[new]]></methodname><![CDATA[(]]><phrase><![CDATA[:nameserver_port]]></phrase><![CDATA[ => [[]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[127.0.0.1]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[, 5300]])]]>
<symbol><![CDATA[Syslog]]></symbol><![CDATA[.]]><methodname><![CDATA[open]]></methodname><![CDATA[(]]><phrase><![CDATA['dnsbl_client.rb']]></phrase><![CDATA[, ]]><symbol><![CDATA[Syslog]]></symbol><![CDATA[::]]><symbol><![CDATA[LOG_PID]]></symbol><![CDATA[)]]>

<token><![CDATA[def]]></token><![CDATA[ ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><methodname><![CDATA[str]]></methodname><![CDATA[)]]>
<![CDATA[  ]]><symbol><![CDATA[STDERR]]></symbol><![CDATA[.]]><methodname><![CDATA[print]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ERR_filtering_debug: ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[str]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[.]]><methodname><![CDATA[inspect]]></methodname><![CDATA[ + ]]><phrase><![CDATA["]]></phrase><![CDATA[
]]><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$stderrdebug]]></methodname>
<![CDATA[  ]]><symbol><![CDATA[Syslog]]></symbol><![CDATA[.]]><methodname><![CDATA[log]]></methodname><![CDATA[(]]><symbol><![CDATA[Syslog]]></symbol><![CDATA[::]]><symbol><![CDATA[LOG_ERR]]></symbol><![CDATA[, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[%s]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[, ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ERR_filtering_debug: ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[str]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<token><![CDATA[end]]></token>

<methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[Started helper]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>

<symbol><![CDATA[STDOUT]]></symbol><![CDATA[.]]><methodname><![CDATA[sync]]></methodname><![CDATA[ = ]]><token><![CDATA[true]]></token>

<token><![CDATA[def]]></token><![CDATA[ ]]><methodname><![CDATA[process]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[)]]>
<![CDATA[  ]]><methodname><![CDATA[answer]]></methodname><![CDATA[ = ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ERR]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[  ]]><methodname><![CDATA[rewritten]]></methodname><![CDATA[ = ]]><token><![CDATA[false]]></token>
<![CDATA[  ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[line]]></methodname><![CDATA[.]]><methodname><![CDATA[size]]></methodname><![CDATA[ < 2]]>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[line empty or malformed]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[    ]]><token><![CDATA[puts]]></token><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ERR line is corrupted]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[    ]]><token><![CDATA[exit]]></token><![CDATA[ 1]]>
<![CDATA[    ]]><token><![CDATA[return]]></token>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<lineannotation><![CDATA[#0 http://askubuntu.com/ 192.168.10.131/- - GET myip=192.168.10.1 myport=3128]]></lineannotation>
<![CDATA[  ]]><token><![CDATA[id]]></token><![CDATA[, ]]><methodname><![CDATA[url]]></methodname><![CDATA[, ]]><methodname><![CDATA[src]]></methodname><![CDATA[, ]]><methodname><![CDATA[fqdn]]></methodname><![CDATA[, ]]><token><![CDATA[method]]></token><![CDATA[, ]]><methodname><![CDATA[src]]></methodname><![CDATA[, ]]><methodname><![CDATA[squidport]]></methodname><![CDATA[, ]]><methodname><![CDATA[others]]></methodname><![CDATA[ = ]]><methodname><![CDATA[line]]></methodname><![CDATA[.]]><methodname><![CDATA[split]]></methodname>
<![CDATA[  ]]><token><![CDATA[case]]></token><![CDATA[ ]]><methodname><![CDATA[url]]></methodname>
<![CDATA[    ]]><token><![CDATA[when]]></token><![CDATA[ ]]><phrase><![CDATA[/]]></phrase><phrase><![CDATA[^([]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[w]+]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[:]]></phrase><phrase><![CDATA[\/]]></phrase><phrase><![CDATA[\/]]></phrase><phrase><![CDATA[)([]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[w]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[d]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[-]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[_]+)]]></phrase><phrase><![CDATA[/]]></phrase>
<![CDATA[      ]]><token><![CDATA[begin]]></token>
<![CDATA[        ]]><methodname><![CDATA[uri]]></methodname><![CDATA[ = ]]><symbol><![CDATA[URI]]></symbol><![CDATA[(]]><methodname><![CDATA[url]]></methodname><![CDATA[)]]>
<![CDATA[      ]]><token><![CDATA[rescue]]></token><![CDATA[ ]]><symbol><![CDATA[URI]]></symbol><![CDATA[::]]><symbol><![CDATA[InvalidURIError]]></symbol><![CDATA[ => ]]><methodname><![CDATA[e]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[Rescued a wrong uri and resdcaped it!]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[uri]]></methodname><![CDATA[ = ]]><symbol><![CDATA[URI]]></symbol><![CDATA[(]]><symbol><![CDATA[URI]]></symbol><![CDATA[.]]><methodname><![CDATA[encode]]></methodname><![CDATA[ ]]><methodname><![CDATA[url]]></methodname><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[URL string is: ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[to_s]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[      ]]><token><![CDATA[rescue]]></token><![CDATA[ => ]]><methodname><![CDATA[e]]></methodname>
<![CDATA[       ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[rescued URI parsing]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[      ]]><token><![CDATA[end]]></token>
<![CDATA[    ]]><token><![CDATA[when]]></token><![CDATA[ ]]><phrase><![CDATA[/]]></phrase><phrase><![CDATA[^([]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[w]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[d]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[-]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[_]+)]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[:([]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[d]{1,5})]]></phrase><phrase><![CDATA[/]]></phrase>
<![CDATA[      ]]><methodname><![CDATA[uri]]></methodname><![CDATA[ = ]]><symbol><![CDATA[URI]]></symbol><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[CONNECT://]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[$1]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA[:]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[$2]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[else]]></token>
<![CDATA[    ]]><symbol><![CDATA[STDERR]]></symbol><![CDATA[.]]><methodname><![CDATA[puts]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ELSE]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[CONNECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><token><![CDATA[method]]></token><![CDATA[ == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[CONNECT]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[it's HTTP]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[scheme]]></methodname><![CDATA[ == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[http]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[it's HTTPS]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[scheme]]></methodname><![CDATA[ == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[https]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[it's FTP]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[scheme]]></methodname><![CDATA[ == ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[ftp]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[parsed url ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[scheme]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA[://]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[host]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA[:]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[port]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[path]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA[?]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[query]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname><![CDATA[ && ]]><token><![CDATA[method]]></token><![CDATA[ != ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[CONNECT]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[  ]]><methodname><![CDATA[res]]></methodname><![CDATA[ = []]]>
<![CDATA[  ]]><methodname><![CDATA[host]]></methodname><![CDATA[ = ]]><methodname><![CDATA[uri]]></methodname><![CDATA[.]]><methodname><![CDATA[host]]></methodname>

<![CDATA[  ]]><token><![CDATA[begin]]></token>
<![CDATA[    ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[ = 0]]>
<![CDATA[        ]]><symbol><![CDATA[Timeout]]></symbol><![CDATA[::]]><methodname><![CDATA[timeout]]></methodname><![CDATA[(3) ]]><token><![CDATA[do]]></token>
<![CDATA[          ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[ = ]]><methodname><![CDATA[$dns_db]]></methodname><![CDATA[.]]><methodname><![CDATA[getresources]]></methodname><![CDATA[(]]><methodname><![CDATA[host]]></methodname><![CDATA[, ]]><symbol><![CDATA[Resolv]]></symbol><![CDATA[::]]><symbol><![CDATA[DNS]]></symbol><![CDATA[::]]><symbol><![CDATA[Resource]]></symbol><![CDATA[::]]><symbol><![CDATA[IN]]></symbol><![CDATA[::]]><methodname><![CDATA[A]]></methodname><![CDATA[)]]>
<![CDATA[        ]]><token><![CDATA[end]]></token>
<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[ != 0 && ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[[0].]]><methodname><![CDATA[address]]></methodname><![CDATA[.]]><methodname><![CDATA[to_s]]></methodname><![CDATA[ =~ ]]><phrase><![CDATA[/]]></phrase><phrase><![CDATA[10]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.0]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.0]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.1]]></phrase><phrase><![CDATA[/]]></phrase>
<![CDATA[            ]]><lineannotation><![CDATA[#unknown]]></lineannotation>
<![CDATA[            ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[the domain is unknown]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname><![CDATA[ ]]>
<![CDATA[        ]]><token><![CDATA[elsif]]></token><![CDATA[ ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[ != 0 && ]]><methodname><![CDATA[dnsres]]></methodname><![CDATA[[0].]]><methodname><![CDATA[address]]></methodname><![CDATA[.]]><methodname><![CDATA[to_s]]></methodname><![CDATA[ =~ ]]><phrase><![CDATA[/]]></phrase><phrase><![CDATA[127]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.0]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.0]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[.100]]></phrase><phrase><![CDATA[/]]></phrase>
<![CDATA[            ]]><lineannotation><![CDATA[#blacklisted]]></lineannotation>
<![CDATA[            ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[the domain is blacklisted]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[            ]]><methodname><![CDATA[res]]></methodname><![CDATA[ << ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[Blacklisted]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[    ]]><token><![CDATA[else]]></token>
<![CDATA[            ]]><lineannotation><![CDATA[#unknown or error]]></lineannotation>
<![CDATA[            ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[unkown issue]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[        ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]><token><![CDATA[rescue]]></token><![CDATA[ ]]><symbol><![CDATA[Exception]]></symbol><![CDATA[ => ]]><methodname><![CDATA[e]]></methodname>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><methodname><![CDATA[e]]></methodname><![CDATA[)]]>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><methodname><![CDATA[e]]></methodname><![CDATA[.]]><methodname><![CDATA[inspect]]></methodname><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[case]]></token><![CDATA[ ]]><methodname><![CDATA[e]]></methodname>
<![CDATA[    ]]><token><![CDATA[when]]></token><![CDATA[ ]]><symbol><![CDATA[Resolv]]></symbol><![CDATA[::]]><symbol><![CDATA[ResolvError]]></symbol>
<![CDATA[      ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[: ]]></phrase><![CDATA[\e]]><phrase><![CDATA[[0;32mOK]]></phrase><![CDATA[\e]]><phrase><![CDATA[[0m]]></phrase><![CDATA[
]]><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[when]]></token><![CDATA[ ]]><symbol><![CDATA[Timeout]]></symbol><![CDATA[::]]><symbol><![CDATA[Error]]></symbol>
<![CDATA[      ]]><lineannotation><![CDATA[#puts ": \e[0;41mTIMEOUT\e[0m\n"]]></lineannotation>
<![CDATA[      ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[TIMEOUT DNS taking default action to allow]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[when]]></token><![CDATA[ ]]><symbol><![CDATA[Interrupt]]></symbol>
<![CDATA[      ]]><token><![CDATA[puts]]></token><![CDATA[ ]]><phrase><![CDATA["]]></phrase><![CDATA[
]]><phrase><![CDATA[Caught signal SIGINT. Exiting...]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[      ]]><token><![CDATA[exit]]></token><![CDATA[ 1]]>
<![CDATA[    ]]><token><![CDATA[else]]></token>
<![CDATA[      ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[TIMEOUT]]></phrase><phrase><![CDATA[\]]></phrase><phrase><![CDATA[ELSE]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[) ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[$debug]]></methodname>
<![CDATA[    ]]><token><![CDATA[end]]></token><![CDATA[  ]]>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]>
<![CDATA[  ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[res]]></methodname><![CDATA[ && ]]><methodname><![CDATA[res]]></methodname><![CDATA[[0]]]>
<![CDATA[    ]]><methodname><![CDATA[answer]]></methodname><![CDATA[ = ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[OK url=http://www1.ngtech.co.il/cgi-bin/URLblocked.cgi?category=blocked status=302]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[ ]]>
<![CDATA[    ]]><methodname><![CDATA[rewritten]]></methodname><![CDATA[ = ]]><token><![CDATA[true]]></token>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]><token><![CDATA[puts]]></token><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[#{]]></phrase><token><![CDATA[id]]></token><phrase><![CDATA[}]]></phrase><phrase><![CDATA[ ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[answer]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase>
<token><![CDATA[end]]></token>

<token><![CDATA[while]]></token><![CDATA[ ]]><token><![CDATA[true]]></token>
<![CDATA[  ]]><token><![CDATA[begin]]></token>
<![CDATA[    ]]><methodname><![CDATA[line]]></methodname><![CDATA[ = ]]><token><![CDATA[gets]]></token>
<![CDATA[  ]]><token><![CDATA[rescue]]></token><![CDATA[ => ]]><methodname><![CDATA[e]]></methodname>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><methodname><![CDATA[e]]></methodname><![CDATA[)]]>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><methodname><![CDATA[e]]></methodname><![CDATA[.]]><methodname><![CDATA[inspect]]></methodname><![CDATA[)]]>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]><token><![CDATA[if]]></token><![CDATA[ !]]><methodname><![CDATA[line]]></methodname>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[Empty line, Exiting.]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[break]]></token>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ ]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[{ line => ]]></phrase><![CDATA[\"]]><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[line]]></methodname><phrase><![CDATA[}]]></phrase><![CDATA[\"]]><phrase><![CDATA[} line_size => ]]></phrase><phrase><![CDATA[#{]]></phrase><methodname><![CDATA[line]]></methodname><![CDATA[.]]><methodname><![CDATA[size]]></methodname><phrase><![CDATA[}]]></phrase><phrase><![CDATA["]]></phrase>
<![CDATA[  ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[line]]></methodname><![CDATA[ =~ ]]><phrase><![CDATA[/]]></phrase><phrase><![CDATA[^[Qq]]]></phrase><phrase><![CDATA[/]]></phrase>
<![CDATA[    ]]><methodname><![CDATA[debug]]></methodname><![CDATA[(]]><phrase><![CDATA["]]></phrase><phrase><![CDATA[quitting by user request]]></phrase><phrase><![CDATA["]]></phrase><![CDATA[)]]>
<![CDATA[    ]]><token><![CDATA[break]]></token>
<![CDATA[  ]]><token><![CDATA[end]]></token>
<![CDATA[  ]]><methodname><![CDATA[process]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[)]]>
<token><![CDATA[end]]></token>
</programlisting></article>