<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>KnowledgeBase/IllegalInstructionError</title><revhistory><revision><revnumber>3</revnumber><date>2014-04-28 09:58:16</date><authorinitials>AmosJeffries</authorinitials><revremark>add details reported in bug 4018.</revremark></revision><revision><revnumber>2</revnumber><date>2014-01-10 18:14:56</date><authorinitials>FrancescoChemolli</authorinitials><revremark>--enable-arch-native is not needed after all, just useful.</revremark></revision><revision><revnumber>1</revnumber><date>2014-01-09 22:11:27</date><authorinitials>FrancescoChemolli</authorinitials><revremark>FAQ</revremark></revision></revhistory></articleinfo><section><title>Illegal Instruction errors on Squid 3.4</title><para><emphasis role="strong">Synopsis</emphasis> Squid 3.4 and later, running on certain <emphasis>paravirtualized systems</emphasis> and even some claiming full virtualization (at least KVM, Xen, and Xen derivatives are confirmed so far) crashes with an illegal instruction error soon after startup. </para><para><emphasis role="strong">Symptoms</emphasis> </para><itemizedlist><listitem><para>Squid crashes with Illegal Instruction error immediately after startup on a virtual machine on Intel-compatible processors </para></listitem></itemizedlist><para><emphasis role="strong">Explanation</emphasis> </para><para>The Squid build system uses by default the <code> -march=native </code> gcc option to optimize the resulting binary. Unfortunately certain (para-)virtualization systems don't support the whole instruction set they advertise. The compiler doesn't know, and generates instructions which trigger this error. </para><para><emphasis role="strong">Workaround</emphasis> </para><para>These optimizations are helpful but not necessary to have a fully functional squid, especially on ia64/amd64 platforms. The detected defaults can be overridden by supplying the <code>--disable-arch-native</code> option to the <code>configure</code> script. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/KnowledgeBase/IllegalInstructionError/CategoryKnowledgeBase#">CategoryKnowledgeBase</ulink> </para></section></article>