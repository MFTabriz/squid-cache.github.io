<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>KnowledgeBase/PerformanceAnalysis</title><revhistory><revision><revnumber>7</revnumber><date>2008-05-18 19:39:00</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>6</revnumber><date>2007-03-22 16:11:36</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>5</revnumber><date>2007-03-22 16:10:22</date><authorinitials>kinkie</authorinitials><revremark>Added category, fixed title</revremark></revision><revision><revnumber>4</revnumber><date>2007-03-22 15:49:02</date><authorinitials>kinkie</authorinitials><revremark>This belongs better as a KB article</revremark></revision><revision><revnumber>3</revnumber><date>2007-03-22 15:44:50</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>2</revnumber><date>2007-03-02 16:50:29</date><authorinitials>kinkie</authorinitials><revremark>Misspelled</revremark></revision><revision><revnumber>1</revnumber><date>2005-10-10 13:02:58</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>How to analyze whether squid is performing well</title><para>Users will <emphasis role="strong">always</emphasis> complain that Internet access is slow. The problem is: can they be trusted? Rarely. And the general availability of broadband at home has, if anything, made users even less reliable as a source of performance information as it raises their performance expectations beyond what is reasonable in a work environment. </para><para>The first step is to quantify and measure the problem, since users almost always have a subjective (and not quantitative) view of what's going on. </para><itemizedlist><listitem><para>Try a simple test: on a test client system with enough network access permissions, try accessing a test site or three of your choice, using a test pattern such as: clear browser cache, close all browser windows, open browser, access site without using the proxy, clear browser cache, close all browser windows, configure proxy, access site. Is there any noticeable performance difference? If not, then it's definitely not a problem with Squid. </para></listitem><listitem><para>Check your cache.log, and look if it says anything strange, such as squid restarting unexpectedly or complaining about some resource being unavailable (for instance, is it low on file descriptors?) </para></listitem><listitem><para>Check your uplink congestion rate. Is it congested? Squid can help with a congested uplink, but can't perform miracles. What about latencies? Do a traceroute to a test site and check what is the performance on the first two-three hops: the problem might not be with your uplink, but with your provider's. </para></listitem><listitem><para>Check your system performance: how much CPU time it spends running Squid, how much in the kernel, how much iowait, how much swap it is using, pagein and pageout rates, etc. The system must be in a sane state for squid to have a chance to perform. </para></listitem><listitem><para>If you found nothing so far, fire up your cachemgr and look for performance indicators such as hit ratio (memory, object and DNS), DNS response time, number of available filedescriptors. If you're using authentication check the authenticators' queues congestion - all these things add latency to a request handling, and that can generally make an user's browsing experience much worse. </para></listitem></itemizedlist><para>Repeat the analisys at different times in different days, check for variations in the vital parameters. </para><itemizedlist><listitem><para>Collect a few days' worth of logs, and run on them a statistics software such as calamaris or webalizer, and start looking for deviations from &quot;reasnonable&quot; behaviour, such as users with unreasonably high bandwidth or request activities. </para></listitem></itemizedlist><para>Only at this point you should have a clear enough picture to know what knob to turn in order to fix your problem. if there really is a problem. If everything so far points at squid being the source of the problems, try to follow the steps in <ulink url="https://wiki.squid-cache.org/KnowledgeBase/PerformanceAnalysis/SquidFaq/SquidProfiling#">SquidFaq/SquidProfiling</ulink>. </para><para><emphasis role="strong"> What settings should I change? </emphasis> </para><para>None, before having understood what is really going on. </para><para>Some of the solutions could actually end up worsening the problem: for instance increasing cache_mem on a memory-bound system can actually be detrimental to overall squid performance: if you end up using more memory than your system has, parts of squid end up being swapped to disk trashing performance. In such cases it's much better to actually <emphasis role="strong">reduce</emphasis> cache_mem. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/KnowledgeBase/PerformanceAnalysis/CategoryKnowledgeBase#">CategoryKnowledgeBase</ulink> </para></section></article>