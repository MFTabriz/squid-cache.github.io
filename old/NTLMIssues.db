<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>NTLMIssues</title><revhistory><revision><revnumber>6</revnumber><date>2012-03-16 10:42:36</date><authorinitials>AmosJeffries</authorinitials><revremark>mention lack of NTLM on cache_peer</revremark></revision><revision><revnumber>5</revnumber><date>2009-01-18 10:37:29</date><authorinitials>AmosJeffries</authorinitials><revremark>correct linkages</revremark></revision><revision><revnumber>4</revnumber><date>2008-05-18 19:39:00</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>3</revnumber><date>2005-01-04 22:08:14</date><authorinitials>62-101-126-208.fastres.net</authorinitials><revremark>Added section about 407/Denied</revremark></revision><revision><revnumber>2</revnumber><date>2005-01-03 23:11:56</date><authorinitials>kinkie</authorinitials><revremark>Corrected section title</revremark></revision><revision><revnumber>1</revnumber><date>2005-01-03 23:05:22</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>Single Sign-on with databases other than Microsoft's user databases</title><para>In &lt; <ulink url="mailto:OFFFA0E624.849C9A55-ON43256F7E.00374070-43256F7E.003972B7@zahid.com">OFFFA0E624.849C9A55-ON43256F7E.00374070-43256F7E.003972B7@zahid.com</ulink> &gt; an user asked: </para><informaltable><tgroup cols="1"><colspec colname="col_0"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para>can I use single sigon authentication thru my ldap server for squid users instead of getting the prompt to authenticate. clients are using WinXP pro</para></entry></row></tbody></tgroup></informaltable><para>The short answer is: <emphasis role="strong">no</emphasis>, at least not out of the box. But it could be done. </para><para>Long answer: in order to implement this you need to have access to a database containing the user passwords, either in cleartext or at least their NT- and LM-hashes (see <ulink url="http://forum.hackinthebox.org/viewtopic.php?p=40224"/> for some info on what those are). These password <emphasis role="underline"><emphasis role="strong">must</emphasis></emphasis> be in sync with those contained in Active Directory, or the first authentication of a session will fail and the user will get the dreaded popup. Once you have those, you &quot;only&quot; have to implement the NTLMSSP protocol (it is what the client and the helper use) and the Squid NTLM authenticator protocol. </para></section><section><title>407/DENIED and NTLM</title><para>Due to the way NTLM authentication over HTTP has been designed by Microsoft, each new TCP connection needs to be denied twice to perform the authentication handshake. Then as long as it's kept alive it won't need any further authentication. Yes, it breaks protocol layering. Yes, it breaks HTTP's statelessness. And yes, it wastes lots of bandwidth (two ~2kb denies for an average-sized 16k object means a whopping 20% overhead in a bad-but-not-unreasonable scenario). For the gory details of how auth is performed, see <ulink url="https://wiki.squid-cache.org/NTLMIssues/KnowledgeBase/NTLMAuthGoryDetails#">KnowledgeBase/NTLMAuthGoryDetails</ulink> </para></section><section><title>Multi-Hop</title><para>The Squid mechanisms for adding Proxy-Authentication: headers on client requests sent upstream does not support the NTLM handshake for login to the next-hop proxy using NTLM. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Microsoft has officially deprecated NTLM in faviour of Kerberos. <ulink url="https://wiki.squid-cache.org/NTLMIssues/Squid-3.2#">Squid-3.2</ulink> does support Kerberos (Negotiate) login to upstream proxies. </para></listitem></itemizedlist></section></article>