<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Intercept</title><revhistory><revision><revnumber>11</revnumber><date>2016-08-20 14:47:12</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>10</revnumber><date>2016-08-20 14:46:16</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>9</revnumber><date>2016-08-20 14:45:37</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>8</revnumber><date>2016-08-20 14:44:22</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>7</revnumber><date>2016-07-03 06:39:51</date><authorinitials>AmosJeffries</authorinitials><revremark>WCCP is tunneling. Any breakage of routing layer is due to misconfiguration of that routing layer. Clarify the details.</revremark></revision><revision><revnumber>6</revnumber><date>2016-07-02 20:32:54</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>5</revnumber><date>2009-04-03 07:46:03</date><authorinitials>AmosJeffries</authorinitials><revremark>call it traffic interception, lets see if we can kill the term transparent off.</revremark></revision><revision><revnumber>4</revnumber><date>2009-03-11 01:11:13</date><authorinitials>AmosJeffries</authorinitials><revremark>link tproxy4 info</revremark></revision><revision><revnumber>3</revnumber><date>2008-11-13 11:43:30</date><authorinitials>AmosJeffries</authorinitials><revremark>add TOC</revremark></revision><revision><revnumber>2</revnumber><date>2008-11-13 11:42:07</date><authorinitials>AmosJeffries</authorinitials><revremark>explain a few things better.</revremark></revision><revision><revnumber>1</revnumber><date>2008-09-01 04:35:10</date><authorinitials>AmosJeffries</authorinitials><revremark>create index for interception section</revremark></revision></revhistory></articleinfo><section><title>Traffic Interception with WCCP</title><para>WCCP is a forwarding/tunneling method. Since a tunnel could be built using any two devices the configurations have been separated into endpoint configurations. </para><para>L2 forwarding is best suited for when the proxy is directly connected to the router, i.e. presists in the same L2-segment of LAN. Since Layer-2 is a level below TCP/IP it can be treated as equivalent to <emphasis>Policy Routing</emphasis> at the IP layer (the difference is PBR is executes on CPU, against true L2 WCCP forwarding, which often executes on control plane level) and requires only routing configuration on the receiving proxy machine. Also note, L2 forwarding most often hardware accelerated and has no additional overhead (because uses L2 header re-writes without increasing packet), so it has best performance in most cases. </para><para>GRE tunneling is suitable for setups where the packets need to traverse multiple other devices (hops) before reaching the proxy. This requires a GRE interface configured on the receiving proxy to decapsulate the tunnel in addition to routing configuration on the receiving proxy machine. </para><para>Some older Cisco device types (notably ASA) place additional limitations on which method they support. Recent IOS versions may expand them to allow either method - or may not, check your Cisco device documentation carefully. </para><section><title>Router WCCP end-point</title><para><orderedlist><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/Cisco3640Wccp2"><emphasis role="strong">ConfigExamples/Intercept/Cisco3640Wccp</emphasis>2</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoAsaWccp2"><emphasis role="strong">ConfigExamples/Intercept/CiscoAsaWccp</emphasis>2</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoIOSv11Wccp1"><emphasis role="strong">ConfigExamples/Intercept/CiscoIOSv11Wccp</emphasis>1</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoIOSv12Wccp1"><emphasis role="strong">ConfigExamples/Intercept/CiscoIOSv12Wccp</emphasis>1</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoIOSv15Wccp2"><emphasis role="strong">ConfigExamples/Intercept/CiscoIOSv15Wccp</emphasis>2</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoIos1246T2Wccp2"><emphasis role="strong">ConfigExamples/Intercept/CiscoIos1246T2Wccp</emphasis>2</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CiscoPixWccp2"><emphasis role="strong">ConfigExamples/Intercept/CiscoPixWccp</emphasis>2</ulink></listitem></orderedlist><!--The macro FullSearch caused an error and should be blacklisted. It returned the data '

' which caused the docbook-formatter to choke. Please file a bug.--> </para></section><section><title>Squid WCCP end-point</title><para><orderedlist><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/FedoraCoreWccp2Receiver"><emphasis role="strong">ConfigExamples/Intercept/FedoraCoreWccp2Receiver</emphasis></ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/FreeBsdWccp2Receiver"><emphasis role="strong">ConfigExamples/Intercept/FreeBsdWccp</emphasis><emphasis role="strong">2Receiver</emphasis></ulink></listitem></orderedlist><!--The macro FullSearch caused an error and should be blacklisted. It returned the data '

' which caused the docbook-formatter to choke. Please file a bug.--> </para></section></section><section><title>Traffic Interception by Policy Routing</title><para>Alternative to tunneling. Policy Routing is a method of passing traffic directly to the interceptor unaltered. </para><para><orderedlist><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/Cisco2501PolicyRoute"><emphasis role="strong">ConfigExamples/Intercept/Cisco2501PolicyRoute</emphasis></ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/IptablesPolicyRoute"><emphasis role="strong">ConfigExamples/Intercept/IptablesPolicyRoute</emphasis></ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/PfPolicyRoute"><emphasis role="strong">ConfigExamples/Intercept/PfPolicyRoute</emphasis></ulink></listitem></orderedlist><!--The macro FullSearch caused an error and should be blacklisted. It returned the data '

' which caused the docbook-formatter to choke. Please file a bug.--> </para></section><section><title>Traffic Interception capture into Squid</title><para>Once the packets reach the Squid box they still need passing into Squid. This is done by the NAT infrastructure of the operating system firewall. </para><para><orderedlist><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/AtSource"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>AtSource</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/CentOsTproxy4"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>CentOsTproxy4</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/DebianWithRedirectorAndReporting"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>DebianWithRedirectorAndReporting</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/FreeBsdIpfw"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>FreeBsdIpfw</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/FreeBsdPf"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>FreeBsdPf</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/Ipfw"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>Ipfw</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/JuniperSRXRoutingPolicy"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>JuniperSRXRoutingPolicy</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/LinuxBridge"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>LinuxBridge</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/LinuxDnat"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>LinuxDnat</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/LinuxIpfwadm"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>LinuxIpfwadm</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/LinuxLocalhost"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>LinuxLocalhost</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/LinuxRedirect"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>LinuxRedirect</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/OpenBsdPf"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>OpenBsdPf</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/SolarisOpenIndianaIPF"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>SolarisOpenIndianaIPF</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/SslBumpExplicit"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>SslBumpExplicit</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/SslBumpWithIntermediateCA"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>SslBumpWithIntermediateCA</ulink></listitem><listitem><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/ConfigExamples/Intercept/SslBumpWithIntermediateCA/Discussion"><emphasis role="strong">ConfigExamples/Intercept/</emphasis>SslBumpWithIntermediateCA/Discussion</ulink></listitem></orderedlist><!--The macro FullSearch caused an error and should be blacklisted. It returned the data '

' which caused the docbook-formatter to choke. Please file a bug.--> </para><itemizedlist><listitem><para><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/Features/Tproxy4#">Linux TPROXY Real Transparent Interception (without NAT)</ulink> </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></article>