<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Caching/AdobeProducts</title><revhistory><revision><revnumber>12</revnumber><date>2021-07-03 09:45:42</date><authorinitials>FrancescoChemolli</authorinitials></revision><revision><revnumber>11</revnumber><date>2018-04-16 17:04:40</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>10</revnumber><date>2018-04-16 17:04:10</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>9</revnumber><date>2016-10-05 20:25:56</date><authorinitials>AlexRousskov</authorinitials><revremark>&quot;stare&quot; is not an ACL. TODO: Most likely, it is not staring at the Adobe certificate that Adobe does not like; it is substitution of the Adobe certificate with Squid's one (after staring).</revremark></revision><revision><revnumber>8</revnumber><date>2016-10-05 19:03:23</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>7</revnumber><date>2016-10-05 19:01:55</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>6</revnumber><date>2016-09-06 15:05:27</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>5</revnumber><date>2016-09-06 14:58:42</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>4</revnumber><date>2016-09-06 14:58:16</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>3</revnumber><date>2016-09-06 14:45:06</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>2</revnumber><date>2016-09-06 14:43:47</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>1</revnumber><date>2016-09-06 14:43:01</date><authorinitials>YuriVoinov</authorinitials></revision></revhistory></articleinfo><section><title>Caching Adobe Products and Updates</title><itemizedlist><listitem override="none"><para><emphasis>by <ulink url="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts/YuriVoinov#">YuriVoinov</ulink></emphasis> </para></listitem></itemizedlist><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Significant portion of users and offices uses Adobe products throughout the world. Therefore, the question of caching these downloads confronts every administrator caching proxy. Unfortunately, Adobe's own reasons, has taken a number of steps, very difficult not only caching, but simply downloading their products through Squid. We consider here a few workaround ways, showing how it is possible to provide downloading of the products of this company in principle. </para></section><section><title>Usage</title><para>These configuration examples are used to download Adobe products via a proxy server using SSL Bump. </para></section><section><title>More</title><para>Since an increasing number of Web sites, for various reasons - as a reasonable and not too intelligent, passes under HTTPS, and Adobe in this case is no exception, most of the downloads carried out in a tunnel. Moreover, modern Web downloaders from Adobe uses <ulink url="https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning">SSL pinning</ulink>. Thus, only the downloader loading itself can be cached. In addition, at the present time (September 2016) only the updates downloaded Adobe products via the web, using HTTP protocol and can be (do not know how long will this possibility) cached using Squid. The bad news, but it is something for which all that are actively fighting. </para></section><section><title>Squid Configuration File</title><para>To make it possible, in principle, download Adobe products through a proxy, paste the configuration file like this: </para><screen><![CDATA[# SSL bump rules
acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i "/usr/local/squid/etc/acl.url.nobump"
ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
ssl_bump bump all]]></screen><para>Paste to /usr/local/squid/etc/acl.url.nobump next sites: </para><screen><![CDATA[# Adobe updates (web installation)
# This requires to splice due to SSL-pinned web-downloader
(get|platformdl|fpdownload|ardownload[0-9])\.adobe\.com]]></screen><para>Please note, this sites is required to download Adobe Flash and Adobe Acrobat Reader - the most common Adobe products. </para><para>To ensure that caching updates, and Web downloader themselves, also add the following lines to the configuration: </para><screen><![CDATA[# Other setups and updates
refresh_pattern -i \.(zip|[g|b]z2?|exe|ms[i|p]|cvd|cdiff|mar)$  43200   100%    129600  reload-into-ims]]></screen></section><section><title>Conclusion</title><para>As we have informed by Adobe, download standalone product installers will be discontinued in September 2016 and will continue to take place exclusively through the web downloader. Thus, the previous Squid's configurations Squid to caching Adobe downloads will be useless. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Note: Adobe downloader does not like when for pinned connections your proxy start stare. It interrupts downloading updates immediately. So, avoid staring in any form. This means your squid.conf should <emphasis role="strong">not</emphasis> use the <ulink url="http://www.squid-cache.org/Doc/config/ssl_bump#">ssl_bump</ulink> <emphasis role="strong">stare</emphasis> action for Adobe traffic. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Caching/AdobeProducts/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>