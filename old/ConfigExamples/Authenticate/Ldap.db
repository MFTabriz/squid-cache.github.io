<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Authenticate/Ldap</title><revhistory><revision><revnumber>9</revnumber><date>2021-07-02 14:42:25</date><authorinitials>FrancescoChemolli</authorinitials></revision><revision><revnumber>8</revnumber><date>2009-02-10 21:10:22</date><authorinitials>AmosJeffries</authorinitials><revremark>add Windows 2003 AD details.</revremark></revision><revision><revnumber>7</revnumber><date>2009-01-22 12:01:08</date><authorinitials>AmosJeffries</authorinitials><revremark>wiki name it</revremark></revision><revision><revnumber>6</revnumber><date>2009-01-22 11:59:32</date><authorinitials>AmosJeffries</authorinitials><revremark>this is an auth config</revremark></revision><revision><revnumber>5</revnumber><date>2009-01-22 11:59:01</date><authorinitials>AmosJeffries</authorinitials><revremark>polish text layout a little, add smilies</revremark></revision><revision><revnumber>4</revnumber><date>2008-05-18 19:39:01</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>3</revnumber><date>2007-05-15 13:13:00</date><authorinitials>203.148.65.8</authorinitials></revision><revision><revnumber>2</revnumber><date>2007-05-14 12:32:24</date><authorinitials>kinkie</authorinitials><revremark>Removed extra subpage</revremark></revision><revision><revnumber>1</revnumber><date>2007-05-12 15:41:29</date><authorinitials>203.148.65.8</authorinitials></revision></revhistory></articleinfo><section><title>Configuring a Squid Server to authenticate off LDAP</title><para>By Askar Ali Khan </para><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>In this example a squid installation will use LDAP to authenticate users before allowing them to surf the web. For security reasons users need to enter their username and password before they are allowed to surf the internet. </para></section><section><title>Usage</title><para>In this example we assume OpenLDAP has been configured to disallow anonymous search, one must bind before doing any searches. We will use squid_ldap_auth (Squid LDAP authentication helper) which allow squid to connect to a LDAP directory to validate the user name and password of Basic HTTP authentication.  </para></section><section><title>Squid Configuration File</title><para>First edit squid.conf so that authentication against LDAP works </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> The first config line below wraps, it is meant to be one long line. </para></listitem></itemizedlist><screen><![CDATA[auth_param basic program /usr/lib/squid/squid_ldap_auth -v 3 -b "dc=yourcompany,dc=com" -D uid=some-user,ou=People,dc=yourcompany,dc=com  -w password -f uid=%s ldap.yourcompany.com
]]><![CDATA[
auth_param basic children 5
auth_param basic realm Web-Proxy
auth_param basic credentialsttl 1 minute
]]><![CDATA[
acl ldap-auth proxy_auth REQUIRED
]]><![CDATA[
http_access allow ldap-auth
http_access allow localhost
http_access deny all]]></screen><itemizedlist><listitem override="none"><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> If you want to use the anonymous LDAP binding method then just don't specify the bind DN (-D option, and it's related -w option) </para></entry></row></tbody></tgroup></informaltable></listitem></itemizedlist><section><title>SSL/TLS adjustments</title><para>In case you are looking for a solution to authenticate Squid's users on an Ldap server through a SSL/TLS secure channel then pass -ZZ argument to squid_ldap_auth program. For more information see the squid_ldap_auth manual </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Note: You should have generated your SSL certs and placed it under /etc/openldap/cacerts directory on squid server before using secure channel authentication. Remember that this only secures the traffic Squid&lt;-&gt;LDAP Server, not browsers&lt;-&gt;Squid. For SSL/TLS your squid_ldap_auth line will look like... </para><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> The config line below wraps, it is meant to be one long line. </para></listitem></itemizedlist><screen><![CDATA[auth_param basic program /usr/lib/squid/squid_ldap_auth -v 3 -ZZ -b "dc=yourcompany,dc=com" -D uid=some-user,ou=People,dc=yourcompany,dc=com  -w password -f uid=%s ldap.yourcompany.com]]></screen></section><section><title>Windows 2003 Active Directory adjustments</title><para>Windows 2003 AD also supports LDAP authentication. Some adjustment to the search filter is needed to map to the Microsoft way of naming things... </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> The config line below wraps, it is meant to be one long line. </para></listitem></itemizedlist><screen><![CDATA[auth_param basic program /usr/lib/squid/squid_ldap_auth -v 3 -b ou="something",ou=something,dc=svbmt,dc=net -D cn=LDAPUSER,ou="Generic User Accounts",ou=something",dc=svbmt,dc=net -w password -f sAMAccountName=%s -h ldap.yourcompany.com]]></screen><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Ldap/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></section></article>