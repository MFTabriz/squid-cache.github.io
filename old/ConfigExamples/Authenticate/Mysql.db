<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Authenticate/Mysql</title><revhistory><revision><revnumber>9</revnumber><date>2021-07-02 14:43:38</date><authorinitials>FrancescoChemolli</authorinitials></revision><revision><revnumber>8</revnumber><date>2015-02-10 00:32:26</date><authorinitials>AmosJeffries</authorinitials><revremark>mention --dsn parameter syntax and usage</revremark></revision><revision><revnumber>7</revnumber><date>2009-01-22 11:42:51</date><authorinitials>AmosJeffries</authorinitials><revremark>this is an auth config example</revremark></revision><revision><revnumber>6</revnumber><date>2009-01-22 11:42:21</date><authorinitials>AmosJeffries</authorinitials><revremark>polish layout, MySQL is a trademark - capitalize properly.</revremark></revision><revision><revnumber>5</revnumber><date>2008-05-18 19:38:59</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>4</revnumber><date>2008-01-05 15:44:39</date><authorinitials>203.148.64.252</authorinitials></revision><revision><revnumber>3</revnumber><date>2008-01-05 15:42:39</date><authorinitials>203.148.64.252</authorinitials></revision><revision><revnumber>2</revnumber><date>2008-01-02 20:22:23</date><authorinitials>203.148.64.22</authorinitials></revision><revision><revnumber>1</revnumber><date>2008-01-02 18:46:19</date><authorinitials>203.148.64.252</authorinitials></revision></revhistory></articleinfo><section><title>Configuring a Squid Server to authenticate from MySQL database</title><para>By Askar Ali Khan </para><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>In this example a squid installation will use MySQL to authenticate users before allowing them to surf the web. For security reasons users need to enter their username and password before they are allowed to surf the internet. </para></section><section><title>Squid Installation</title><para>Install squid using your distro package management system or using source. </para><para>Make sure squid is compiled with <emphasis role="strong">--enable-basic-auth-helpers=DB</emphasis> option. </para></section><section><title>Creating MySQL db/table to hold user credentials</title><screen><![CDATA[mysql> create database squid;
]]><![CDATA[
mysql> grant select on squid.* to someuser@localhost identified by 'xxxx';]]></screen><para>Create table 'passwd' in 'squid' db. </para><screen><![CDATA[mysql> CREATE TABLE `passwd` (
  `user` varchar(32) NOT NULL default '',
  `password` varchar(35) NOT NULL default '',
  `enabled` tinyint(1) NOT NULL default '1',
  `fullname` varchar(60) default NULL,
  `comment` varchar(60) default NULL,
  PRIMARY KEY  (`user`)
);]]></screen><para>Populate the table with some test data, eg </para><screen><![CDATA[mysql> insert into passwd values('testuser','test',1,'Test User','for testing purpose');]]></screen></section><section><title>Squid Configuration File</title><para>Edit squid.conf so that authentication against MySQL db works </para><screen><![CDATA[auth_param basic program /usr/local/squid/libexec/squid_db_auth \
    --user someuser --password xxxx --plaintext --persist
]]><![CDATA[
auth_param basic children 5
auth_param basic realm Web-Proxy
auth_param basic credentialsttl 1 minute
auth_param basic casesensitive off
]]><![CDATA[
]]><![CDATA[
acl db-auth proxy_auth REQUIRED
http_access allow db-auth
http_access allow localhost
http_access deny all]]></screen><para>By default the helper connects to a MySQL database running on the local host. It can also be made to contact a remote server using the <code>--dsn</code> argument. </para><para>The Data Source Name ( <code>--dsn</code> ) parameter is the option string passed to the Perl DBI module for locating the database to use. </para><para>It takes the syntax: </para><itemizedlist><listitem override="none"><para>&quot;DSN:&quot; driver &quot;:&quot; params </para></listitem></itemizedlist><para>The params bit depends on what database driver (type) is. The <emphasis role="strong"> &quot;mysql&quot; </emphasis> driver uses semi-colon separated key=value pairs. So you can write something like: </para><screen><![CDATA[auth_param basic program /usr/local/squid/libexec/squid_db_auth \
    --dsn "DSN:mysql:host=example.com;port=3306;database=squid" \
    --user someuser --password xxxx --plaintext --persist]]></screen></section><section><title>Testing the helper</title><para>It good idea to test the <code>squid_db_auth</code> helper from command line to make sure it authenticating with mysql before trying from browser. </para><screen><![CDATA[/usr/local/squid/libexec/squid_db_auth --user someuser --password xxxx --plaintext --persist]]></screen><para>Type the username and password on the same line separated with space, on successful authentication it will give &quot;OK&quot; otherwise &quot;ERR login failure&quot; </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Mysql/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>