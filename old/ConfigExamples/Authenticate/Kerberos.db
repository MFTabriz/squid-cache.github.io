<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Authenticate/Kerberos</title><revhistory><revision><revnumber>64</revnumber><date>2021-07-02 14:42:11</date><authorinitials>FrancescoChemolli</authorinitials></revision><revision><revnumber>63</revnumber><date>2015-12-12 04:00:26</date><authorinitials>AmosJeffries</authorinitials><revremark>update helper names</revremark></revision><revision><revnumber>62</revnumber><date>2013-04-22 14:18:54</date><authorinitials>DmitryKurochkin</authorinitials></revision><revision><revnumber>61</revnumber><date>2013-04-22 13:53:58</date><authorinitials>DmitryKurochkin</authorinitials></revision><revision><revnumber>60</revnumber><date>2012-03-07 21:20:28</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>59</revnumber><date>2011-12-03 14:11:16</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>58</revnumber><date>2011-12-03 14:05:15</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>57</revnumber><date>2011-12-03 14:03:36</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>56</revnumber><date>2011-11-23 00:39:53</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>55</revnumber><date>2011-11-23 00:13:43</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>54</revnumber><date>2011-11-20 17:56:25</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>53</revnumber><date>2011-11-20 17:51:09</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>52</revnumber><date>2011-11-20 17:49:44</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>51</revnumber><date>2011-11-20 17:46:21</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>50</revnumber><date>2011-11-20 17:37:30</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>49</revnumber><date>2011-11-20 17:36:05</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>48</revnumber><date>2011-11-20 17:23:41</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>47</revnumber><date>2011-11-20 17:22:35</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>46</revnumber><date>2011-11-20 17:16:10</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>45</revnumber><date>2011-11-20 17:14:37</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>44</revnumber><date>2011-11-20 17:12:45</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>43</revnumber><date>2011-11-20 17:06:06</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>42</revnumber><date>2011-11-20 16:42:47</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>41</revnumber><date>2011-11-20 16:34:56</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>40</revnumber><date>2011-11-20 16:19:00</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>39</revnumber><date>2011-11-20 16:00:08</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>38</revnumber><date>2011-11-20 15:53:19</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>37</revnumber><date>2011-11-20 15:51:46</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>36</revnumber><date>2011-11-20 15:47:15</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>35</revnumber><date>2011-04-29 22:37:20</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>34</revnumber><date>2011-04-29 22:36:33</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>33</revnumber><date>2011-04-29 22:35:33</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>32</revnumber><date>2011-04-29 22:32:33</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>31</revnumber><date>2011-04-29 22:28:12</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>30</revnumber><date>2011-04-29 22:25:30</date><authorinitials>MarkusMoeller</authorinitials><revremark>update msktutil link</revremark></revision><revision><revnumber>29</revnumber><date>2010-07-15 12:26:16</date><authorinitials>FrancescoChemolli</authorinitials><revremark>added link to klaubert's log</revremark></revision><revision><revnumber>28</revnumber><date>2010-05-14 10:06:15</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add comment for use of samba tools</revremark></revision><revision><revnumber>27</revnumber><date>2009-12-03 14:03:59</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Category was included multiple times.</revremark></revision><revision><revnumber>26</revnumber><date>2009-09-30 21:28:39</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>25</revnumber><date>2009-09-30 21:27:14</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add MIT/Heimdal kdc and tools as possible option</revremark></revision><revision><revnumber>24</revnumber><date>2009-09-28 21:20:59</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add msktutil with net join comment</revremark></revision><revision><revnumber>23</revnumber><date>2009-09-28 20:05:33</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add msktutil with net join comment</revremark></revision><revision><revnumber>22</revnumber><date>2009-09-27 22:36:19</date><authorinitials>MarkusMoeller</authorinitials><revremark>Minor update to troubleshooting</revremark></revision><revision><revnumber>21</revnumber><date>2009-09-27 22:32:04</date><authorinitials>MarkusMoeller</authorinitials><revremark>Minor update to troubleshooting</revremark></revision><revision><revnumber>20</revnumber><date>2009-09-27 22:30:41</date><authorinitials>MarkusMoeller</authorinitials><revremark>Minor update to troubleshooting</revremark></revision><revision><revnumber>19</revnumber><date>2009-09-27 20:26:33</date><authorinitials>MarkusMoeller</authorinitials><revremark>Change order</revremark></revision><revision><revnumber>18</revnumber><date>2009-09-27 20:15:33</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add option to use samba tools for keytab</revremark></revision><revision><revnumber>17</revnumber><date>2009-09-02 21:38:53</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add comment about msktutil bug</revremark></revision><revision><revnumber>16</revnumber><date>2009-08-31 12:05:07</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add comment about keytab file permissions</revremark></revision><revision><revnumber>15</revnumber><date>2009-08-31 11:38:57</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add Troubleshooting Tools section</revremark></revision><revision><revnumber>14</revnumber><date>2009-08-31 11:32:17</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add comment about cyrus-sasl-gssapi plugin</revremark></revision><revision><revnumber>13</revnumber><date>2009-08-29 14:19:11</date><authorinitials>MarkusMoeller</authorinitials><revremark>add 2008 related comments</revremark></revision><revision><revnumber>12</revnumber><date>2009-08-27 18:21:06</date><authorinitials>MarkusMoeller</authorinitials><revremark>Keytab readability comment</revremark></revision><revision><revnumber>11</revnumber><date>2009-08-27 18:18:58</date><authorinitials>MarkusMoeller</authorinitials><revremark>add comment regarding MIT krb5.conf file</revremark></revision><revision><revnumber>10</revnumber><date>2009-08-25 13:01:45</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add comment about computer name length used by msktutil</revremark></revision><revision><revnumber>9</revnumber><date>2009-08-25 12:48:39</date><authorinitials>MarkusMoeller</authorinitials><revremark>Minor text change for replay cache</revremark></revision><revision><revnumber>8</revnumber><date>2009-08-25 12:46:23</date><authorinitials>MarkusMoeller</authorinitials><revremark>Add second location for msktutil with Windows 2008 support</revremark></revision><revision><revnumber>7</revnumber><date>2009-08-07 10:36:49</date><authorinitials>GuidoSerassio</authorinitials></revision><revision><revnumber>6</revnumber><date>2009-08-05 11:25:03</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>5</revnumber><date>2009-08-05 11:18:10</date><authorinitials>MarkusMoeller</authorinitials></revision><revision><revnumber>4</revnumber><date>2009-08-04 13:27:07</date><authorinitials>AmosJeffries</authorinitials><revremark>notes curtesy of Markus Moeller</revremark></revision><revision><revnumber>3</revnumber><date>2009-03-22 01:12:18</date><authorinitials>AmosJeffries</authorinitials><revremark>add rc4-hmac note</revremark></revision><revision><revnumber>2</revnumber><date>2009-03-22 01:11:13</date><authorinitials>AmosJeffries</authorinitials><revremark>add krb5.conf from Markus.</revremark></revision><revision><revnumber>1</revnumber><date>2009-03-22 00:26:47</date><authorinitials>AmosJeffries</authorinitials><revremark>import from squid-users</revremark></revision></revhistory></articleinfo><section><title>Configuring a Squid Server to authenticate from Kerberos</title><para>by <emphasis>Markus Moeller</emphasis> </para><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Squid-2.6 and later are capable of performing Kerberos authentication (for example with Windows Vista). </para><para>For Squid-2.7 and later two helpers are bundled with the Squid sources: </para><itemizedlist><listitem><para><emphasis role="strong">squid_kerb_auth</emphasis> for Unix/Linux systems </para></listitem><listitem><para><emphasis role="strong">mswin_negotiate_auth.exe</emphasis> for Windows systems </para></listitem></itemizedlist><para>For Squid-3.2 and later the Unix/Linux helper is called <emphasis role="strong">negotiate_kerberos_auth</emphasis>. </para><para>Earlier Squid require squid_kerb_auth from <ulink url="https://sourceforge.net/project/showfiles.php?group_id=196348"/> </para><para>The following documentation applies to the helper Unix/Linux systems. The Windows helper doesnot need any kind of configuration, it works just out of the box. </para></section><section><title>Pre-requisites for Active Directory integration</title><para>Install msktutil package from <ulink url="http://fuhm.net/software/msktutil/"/> or <ulink url="https://code.google.com/p/msktutil/"/>. </para><itemizedlist><listitem override="none"><para>or </para></listitem></itemizedlist><para>Install Samba </para></section><section><title>krb5.conf Configuration</title><itemizedlist><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> In IE the proxy must be specified as FQDN not as an IP-address </para></listitem><listitem><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> rc4-hmac should be listed as encryption type for windows 2003. </para></listitem></itemizedlist><para>A minimal setup without DNS resolution of AD servers would be (MIT Kerberos example): </para><screen><![CDATA[[libdefaults]
      default_realm = WIN2003R2.HOME
      dns_lookup_kdc = no
      dns_lookup_realm = no
      default_keytab_name = /etc/krb5.keytab
; for Windows 2003
      default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
]]><![CDATA[
; for Windows 2008 with AES
;      default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;      default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;      permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;
; for MIT/Heimdal kdc no need to restrict encryption type
]]><![CDATA[
[realms]
      WIN2003R2.HOME = {
              kdc = w2k3r2.win2003r2.home
              admin_server = w2k3r2.win2003r2.home
      }
]]><![CDATA[
[domain_realm]
      .linux.home = WIN2003R2.HOME
      .win2003r2.home = WIN2003R2.HOME
      win2003r2.home = WIN2003R2.HOME
]]><![CDATA[
[logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log]]></screen></section><section><title>Create keytab</title><orderedlist numeration="arabic"><listitem><para>Create keytab for HTTP/fqdn with msktutil. (If used together with samba net join use another computer name than the hostname used by net join) </para></listitem></orderedlist><screen><![CDATA[kinit administrator@DOMAIN
]]><![CDATA[
msktutil -c -b "CN=COMPUTERS" -s HTTP/<fqdn> -h <fqdn> -k /etc/squid/HTTP.keytab --computer-name squid-http --upn HTTP/<fqdn> --server <domain controller> --verbose
]]><![CDATA[
or for Windows 2008 for AES support
]]><![CDATA[
msktutil -c -b "CN=COMPUTERS" -s HTTP/<fqdn> -h <fqdn> -k /etc/squid/HTTP.keytab --computer-name squid-http --upn HTTP/<fqdn> --server <domain controller> --verbose --enctypes 28]]></screen><itemizedlist><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> beware the wrap! above 'mskutil' options are meant to be on one line. </para></listitem><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> beware the &lt;computer-name&gt; has Windows Netbios limitations of 15 characters. </para></listitem><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> msktutil requires cyrus-sasl-gssapi ldap plugin to authenticate to AD ldap. </para></listitem><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> because of a bug in msktutil 0.3.16 the &lt;computer-name&gt; must be lowercase </para></listitem></itemizedlist><para>OR with Samba </para><orderedlist numeration="arabic"><listitem><para>Join host to domain with net ads join </para></listitem><listitem><para>Create keytab for HTTP/fqdn with net ads keytab </para></listitem></orderedlist><screen><![CDATA[kinit administrator@DOMAIN
]]><![CDATA[
export KRB5_KTNAME=FILE:/etc/squid/HTTP.keytab
]]><![CDATA[
net ads keytab CREATE
net ads keytab ADD HTTP
]]><![CDATA[
unset KRB5_KTNAME]]></screen><itemizedlist><listitem><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> Do not use this method if you run winbindd or other samba services as samba will reset the machine password every x days and thereby makes the keytab invalid !! </para></listitem></itemizedlist><para>OR with MIT/Heimdal kdamin tool </para></section><section><title>Squid Configuration File</title><para>Paste the configuration file like this: </para><screen><![CDATA[auth_param negotiate program /usr/sbin/squid_kerb_auth
auth_param negotiate children 10
auth_param negotiate keep_alive on]]></screen><para>The basic auth ACL controls to make use of it are: </para><screen><![CDATA[acl auth proxy_auth REQUIRED
]]><![CDATA[
http_access deny !auth
http_access allow auth
http_access deny all]]></screen><para>Add the following to the squid startup script (Make sure the keytab is readable by the squid process owner e.g. chgrp squid /etc/squid/HTTP.keytab; chmod g+r /etc/squid/HTTP.keytab ) </para><screen><![CDATA[KRB5_KTNAME=/etc/squid/HTTP.keytab
export KRB5_KTNAME]]></screen><para>Kerberos can keep a replay cache to detect the reuse of Kerberos tickets (usually only possible in a 5 minute window) . If squid is under high load with Negotiate(Kerberos) proxy authentication requests the replay cache checks can create high CPU load. If the environment does not require high security the replay cache check can be disabled for MIT based Kerberos implementations by adding the following to the startup script </para><screen><![CDATA[KRB5RCACHETYPE=none
export KRB5RCACHETYPE]]></screen></section><section><title>Troubleshooting Tools</title><para>On Windows clients (e.g. IE or Firefox on XP, 2003, etc) use <emphasis role="underline">kerbtray</emphasis> or <emphasis role="underline">klist</emphasis> from Microsoft resource kit to list and purge tickets. </para><para><emphasis role="underline">Wireshark</emphasis> traffic on port 88 (Kerberos) to identify Kerberos errors. (KRB5KDC_ERR_PREAUTH_REQUIRED is not an error, but an informational message to the client) </para></section><section><title>Further references</title><itemizedlist><listitem><para>A nice HOWTO is available at <ulink url="http://klaubert.wordpress.com/2008/01/09/squid-kerberos-authentication-and-ldap-authorization-in-active-directory/"/> </para></listitem></itemizedlist></section><section><title>Step by Step Overview</title><orderedlist numeration="arabic"><listitem><para>User login to Desktop </para><itemizedlist><listitem><para>From Windows PC to Windows Active Directory as user &lt;userid&gt; selecting Netbios domainname DOMAIN </para></listitem><listitem><para>From Unix PC using kinit or pam to Windows Active Directory as user <ulink url="mailto:userid@DOMAIN.COM">userid@DOMAIN.COM</ulink> </para></listitem><listitem><para>From Windows PC to Unix Key Distribution Centre (KDC) as &lt;userid&gt; selecting Netbios domainname DOMAIN </para></listitem><listitem><para>From Unix PC using kinit or pam to Unix Key Distribution Centre (KDC) as user <ulink url="mailto:userid@DOMAIN.COM">userid@DOMAIN.COM</ulink> </para></listitem><listitem><para>Any of the above will create an AS Request/AS Reply exchange</para><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-1.jpeg"/></imageobject><textobject><phrase>Squid-1.jpeg</phrase></textobject></inlinemediaobject> </para></listitem></itemizedlist></listitem><listitem><para>User requests URL from Squid </para><itemizedlist><listitem><para>Send GET or PUT or any other request via Squid </para></listitem><listitem><para>Squid (if setup correctly) replies with Proxy-Authenticate: Negotiate </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-3.jpeg"/></imageobject><textobject><phrase>Squid-3.jpeg</phrase></textobject></inlinemediaobject> </para></listitem></itemizedlist></listitem></itemizedlist></listitem><listitem><para>Desktop attempts to get a Service ticket HTTP/&lt;squid-fqdn&gt; from KDC as user &lt; <ulink url="mailto:userid@DOMAIN.COM">userid@DOMAIN.COM</ulink> &gt; <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-2.jpeg"/></imageobject><textobject><phrase>Squid-2.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>Desktop sends request to Squid </para><itemizedlist><listitem><para>With Proxy-Authorization: Negotiate &lt;base64 encoded Kerberos token&gt; if previous step 3. was successful </para></listitem><listitem><para>With Proxy-Authorization: Negotiate &lt;base64 encoded NTLM token&gt; if previous step 3. was not successful (not further discussed here. See NTLM documentation) </para><itemizedlist><listitem override="none"><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-9.jpeg"/></imageobject><textobject><phrase>Squid-9.jpeg</phrase></textobject></inlinemediaobject> </para></listitem></itemizedlist></listitem></itemizedlist></listitem><listitem><para>Squid verifies Kerberos ticket with help of keytab and replies after checking any additional access control settings</para><para>The ticket contains the the user detail &lt; <ulink url="mailto:userid@DOMAIN.COM">userid@DOMAIN.COM</ulink> &gt; and squid can do authorisation decision based on it <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-10.jpeg"/></imageobject><textobject><phrase>Squid-10.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>Step 2., 4. and 5. continue until the Kerberos cache with the received AS and TGS replies expires after about 8 hours (This depends on your kdc settings and/or your kinit options) and step 1. and 3 need to be done again which is usually transparent on Windows but may require a new kinit on Unix.</para></listitem></orderedlist><para>If squid_kerb_ldap is used the following steps are happening </para><orderedlist numeration="arabic"><listitem><para>Squid &quot;login&quot; to Windows Active Directory or Unix kdc as user &lt;HTTP/&lt;fqdn-squid&gt;@DOMAIN.COM&gt;. This requires Active Directory to have an attribute userPrincipalname set to &lt;HTTP/&lt;fqdn-squid&gt;@DOMAIN.COM&gt; for the associated acount. This is usaully done by using msktutil. </para><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-4.jpeg"/></imageobject><textobject><phrase>Squid-4.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>Squid determines ldap server from DNS by looking at SRV records</para><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-7.jpeg"/></imageobject><textobject><phrase>Squid-7.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>Squid connects to ldap server </para><para><inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-6.jpeg"/></imageobject><textobject><phrase>Squid-6.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>If Kerberos authentication is supported by the ldap server Squid will request a service ticket &lt;ldap/&lt;ldap-server-fqdn&gt; as user &lt;HTTP/&lt;squid-fqdn&gt;@DOMAIN.COM&gt; </para><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-5.jpeg"/></imageobject><textobject><phrase>Squid-5.jpeg</phrase></textobject></inlinemediaobject> </para></listitem><listitem><para>Squid sends LDAP search requests and receives replies using Kerberos authentication to the ldap server </para><para> <inlinemediaobject><imageobject><imagedata fileref="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos?action=AttachFile&amp;do=get&amp;target=Squid-6.jpeg"/></imageobject><textobject><phrase>Squid-6.jpeg</phrase></textobject></inlinemediaobject> </para></listitem></orderedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>