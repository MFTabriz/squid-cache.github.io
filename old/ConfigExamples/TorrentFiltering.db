<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/TorrentFiltering</title><revhistory><revision><revnumber>19</revnumber><date>2016-09-10 17:33:51</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>18</revnumber><date>2016-07-14 18:32:20</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>17</revnumber><date>2016-06-05 20:49:02</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>16</revnumber><date>2016-06-05 20:48:40</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>15</revnumber><date>2016-05-10 22:38:23</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>14</revnumber><date>2016-05-09 22:13:34</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>13</revnumber><date>2016-05-09 20:42:22</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>12</revnumber><date>2016-05-01 18:52:07</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>11</revnumber><date>2016-05-01 18:49:54</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>10</revnumber><date>2016-05-01 18:42:44</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>9</revnumber><date>2016-05-01 18:26:27</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>8</revnumber><date>2016-05-01 17:53:11</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>7</revnumber><date>2016-05-01 17:51:43</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>6</revnumber><date>2016-05-01 17:48:17</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>5</revnumber><date>2016-05-01 17:44:37</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>4</revnumber><date>2016-05-01 17:43:54</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>3</revnumber><date>2016-05-01 17:26:00</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>2</revnumber><date>2016-05-01 17:25:32</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>1</revnumber><date>2016-05-01 17:25:05</date><authorinitials>YuriVoinov</authorinitials></revision></revhistory></articleinfo><para><emphasis>by <ulink url="https://wiki.squid-cache.org/ConfigExamples/TorrentFiltering/YuriVoinov#">YuriVoinov</ulink></emphasis> </para><section><title>Introduction</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Torrent filtering is a diffucult problem. which can't be solved easily. To difficult this for users you can first deny download .torrent files. </para></section><section><title>Usage</title><para>You can also enforce this task uses <ulink url="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/qos_nbar/configuration/xe-3s/qos-nbar-xe-3s-book/nbar-protocl-discvry.html">NBAR protocol discovery</ulink> (DPI functionality) in your router (ISR G-2 and above 29xx Cisco series or similar). Only Squid can't completely block torrents your wish. </para></section><section><title>Squid Configuration File</title><para>Paste this to your squid.conf file. Then reconfigure squid. </para><screen><![CDATA[# Block torrent files
acl TorrentFiles rep_mime_type -i mime-type application/x-bittorrent
http_reply_access deny TorrentFiles
deny_info TCP_RESET TorrentFiles]]></screen><para>This preventing downloading .torrent files by users via browsers. </para></section><section><title>Cisco router configuration</title><para>You can effectively enforce blocking torrents with Cisco router like this: </para><screen><![CDATA[!
!ip nbar protocol-pack flash0:pp-adv-isrg2-155-3.M1-23-15.0.0.pack
ip nbar protocol-pack flash0:/pp-adv-isrg2-155-3.M2-23-22.0.0.pack 
!
class-map match-any torrent
 match protocol bittorrent
 match protocol bittorrent-networking
 match protocol encrypted-bittorrent
 match protocol encrypted-emule
 match protocol webthunder
 match protocol edonkey
 match protocol edonkey-static
 match protocol gnutella
 match protocol goboogy
 match protocol fasttrack-static
 match protocol winmx
 match protocol winny
 match protocol ares
 match protocol Konspire2b
 match protocol filetopia
 match protocol manolito
 match protocol networking-gnutella
 match protocol perfect-dark
 match protocol poco
 match protocol ppstream
 match protocol share
 match protocol songsari
 match protocol sopcast
 match protocol soulseek
 match protocol tomatopang
 match protocol xunlei-kankan
 match protocol dht
 match protocol torrentz
!
policy-map Net_Limit
 class torrent
  drop
 class class-default
  bandwidth remaining percent 15 
!
interface GigabitEthernet0/0
! This is external router interface
 ip nbar protocol-discovery
 service-policy output Net_Limit
!]]></screen><para>This configuration, depending which P2P protocol you are specified, completely terminates all torrent sessions on border router/firewall. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> You need to have actual NBAR2 protocol pack to do this. To do this you need to have subscription for Cisco's service and router which is support DPI, like ISR-G2 router (2901 or the similar). And you can use Squid to enforce deny download .torrent files via HTTP/HTTPS. Both of these methods permit you to block torrents almost completely. </para><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> Also note, to filter encrypted P2P protocols, on most Cisco's devices you need to activate SECURITY technology pack or has security-enabled iOS version. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/TorrentFiltering/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>