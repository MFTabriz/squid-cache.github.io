<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Intercept/Cisco2501PolicyRoute</title><revhistory><revision><revnumber>1</revnumber><date>2009-04-03 07:24:17</date><authorinitials>AmosJeffries</authorinitials><revremark>import from FAQ page</revremark></revision></revhistory></articleinfo><section><title>Policy Routing web traffic on a Cisco 2501 Router</title><itemizedlist><listitem override="none"><para><emphasis>by Brian Feeny</emphasis> </para></listitem></itemizedlist><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Here is how I have Interception proxying working for me, in an environment where my router is a Cisco 2501 running IOS 11.1. </para><para>You also need to configure the squid machine to handle the traffic it receives. See <ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/Cisco2501PolicyRoute/ConfigExamples/Intercept#">ConfigExamples/Intercept</ulink> for details on configuring the rest. </para></section><section><title>Cisco Configuration</title><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> Replace SQUIDIP in the following with the IP address of your Squid host. <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> Replace ROUTERIP in the following with the IP address of your Router. </para></listitem></itemizedlist><para>In IOS 11.1 the route-map command is &quot;process switched&quot; as opposed to the faster &quot;fast-switched&quot; route-map which is found in IOS 11.2 and later.  Even more recent versions CEF switch for much better performance. </para><screen><![CDATA[!
interface Ethernet0
 description To Office Ethernet
 ip address ROUTERIP 255.255.255.0
 no ip directed-broadcast
 no ip mroute-cache
 ip policy route-map proxy-redir
!
access-list 110 deny   tcp host SQUIDIP any eq www
access-list 110 permit tcp any any eq www
route-map proxy-redir permit 10
 match ip address 110
 set ip next-hop SQUIDIP]]></screen><para>So basically from above you can see I added the &quot;route-map&quot; declaration, and an access-list, and then turned the route-map on under int e0 &quot;ip policy route-map proxy-redir&quot; The host above: SQUIDIP, is the ip number of my squid host. </para></section><section><title>Thanks</title><para>Many thanks to the following individuals and the squid-users list for helping me get redirection and interception proxying working on my Cisco/Linux box. </para><itemizedlist><listitem><para>Lincoln Dale </para></listitem><listitem><para>Riccardo Vratogna </para></listitem><listitem><para>Mark White </para></listitem><listitem><para><ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/Cisco2501PolicyRoute/HenrikNordstr%C3%B6m#">HenrikNordstr√∂m</ulink> </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Intercept/Cisco2501PolicyRoute/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>