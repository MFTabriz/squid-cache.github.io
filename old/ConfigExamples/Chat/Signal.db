<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Chat/Signal</title><revhistory><revision><revnumber>8</revnumber><date>2021-07-03 09:49:50</date><authorinitials>FrancescoChemolli</authorinitials></revision><revision><revnumber>7</revnumber><date>2018-05-04 10:56:27</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>6</revnumber><date>2016-10-19 21:53:45</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>5</revnumber><date>2016-10-19 20:14:38</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>4</revnumber><date>2016-10-19 19:39:22</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>3</revnumber><date>2016-10-12 01:56:10</date><authorinitials>AmosJeffries</authorinitials><revremark>correct grammar and simplify the configuration to fit with the default ACLs setup</revremark></revision><revision><revnumber>2</revnumber><date>2016-10-11 16:22:23</date><authorinitials>YuriVoinov</authorinitials></revision><revision><revnumber>1</revnumber><date>2016-10-11 16:13:14</date><authorinitials>YuriVoinov</authorinitials></revision></revhistory></articleinfo><para><emphasis>by <ulink url="https://wiki.squid-cache.org/ConfigExamples/Chat/Signal/YuriVoinov#">YuriVoinov</ulink></emphasis> </para><section><title>Signal Messenger</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>The default configuration file for Squid only permits only HTTPS port 443 to be used with CONNECT tunnels. </para><para>Signal Messenger uses custom ports 4433 and 8443. </para></section><section><title>Usage</title><para>This configuration is useful to pass Signal Messenger traffic through a Squid proxy. </para></section><section><title>More</title><para>As described above, Squid (in most cases) deny Signal bootstrap connect.  </para><para>How initial Signal bootstrap works? </para><para>Signal Messenger tries to perform an HTTP CONNECT to <emphasis>textsecure-service-ca.whispersystems.org</emphasis> via port 80, 4433, 8443. When two or more attempts are successful, it initiates a WebSocket connection to the available server port. </para></section><section><title>Squid Configuration File</title><para>Paste the configuration file like this: </para><screen><![CDATA[acl SSL_ports port 4433 8443 # Signal Messenger]]></screen><para>With the above your regular access permissions for any given client are applied to Signal. Just the same as if it were performing HTTPS connections. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-error.png" width="16"/></imageobject><textobject><phrase>{X}</phrase></textobject></inlinemediaobject> Note that port 80 is still too unsafe to allow generic CONNECT to happen on it. However, Signal client often can't do initial connect without permission CONNECT to port 80 at textsecure-service-ca.whispersystems.org. You are warned. </para></listitem></itemizedlist><para>If your proxy is configured to use <ulink url="https://wiki.squid-cache.org/ConfigExamples/Chat/Signal/Features/SslPeekAndSplice#">Features/SslPeekAndSplice</ulink>, also add this to configuration: </para><screen><![CDATA[acl DiscoverSNIHost at_step SslBump1
]]><![CDATA[
acl NoSSLIntercept ssl::server_name textsecure-service-ca.whispersystems.org
]]><![CDATA[
ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
# other SSL-bump rules ...]]></screen><para>and reconfigure. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Chat/Signal/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>