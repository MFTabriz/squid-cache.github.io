<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Reverse/BasicAccelerator</title><revhistory><revision><revnumber>11</revnumber><date>2012-08-08 19:57:54</date><authorinitials>RobertCollins</authorinitials><revremark>reduce some confusion around config use of ip vs dns</revremark></revision><revision><revnumber>10</revnumber><date>2012-05-07 23:18:03</date><authorinitials>AmosJeffries</authorinitials><revremark>wiki links fix</revremark></revision><revision><revnumber>9</revnumber><date>2012-05-07 23:16:55</date><authorinitials>AmosJeffries</authorinitials><revremark>mention no-vhost option for squid-3.2+</revremark></revision><revision><revnumber>8</revnumber><date>2010-02-02 03:43:37</date><authorinitials>AmosJeffries</authorinitials><revremark>accel option has not been optional in a long time.</revremark></revision><revision><revnumber>7</revnumber><date>2009-10-19 01:36:57</date><authorinitials>AmosJeffries</authorinitials><revremark>add inter-wiki links.</revremark></revision><revision><revnumber>6</revnumber><date>2009-07-28 04:18:47</date><authorinitials>AmosJeffries</authorinitials><revremark>highlight the warnign even better</revremark></revision><revision><revnumber>5</revnumber><date>2009-04-07 06:33:13</date><authorinitials>AmosJeffries</authorinitials><revremark>detail what the http_port options mean.</revremark></revision><revision><revnumber>4</revnumber><date>2009-02-14 23:58:55</date><authorinitials>AmosJeffries</authorinitials><revremark>add tag for incuding basics into VirtualHosting page</revremark></revision><revision><revnumber>3</revnumber><date>2009-02-14 23:40:13</date><authorinitials>AmosJeffries</authorinitials><revremark>add markers for location warning inclusion.</revremark></revision><revision><revnumber>2</revnumber><date>2009-02-14 23:37:07</date><authorinitials>AmosJeffries</authorinitials><revremark>add config order warning. fix title</revremark></revision><revision><revnumber>1</revnumber><date>2009-02-01 06:51:42</date><authorinitials>AmosJeffries</authorinitials><revremark>import from FAQ</revremark></revision></revhistory></articleinfo><section><title>Configuring a Basic Reverse Proxy (Website Accelerator)</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>This configuration covers the basic Reverse Proxy (Accelerator) config. More advanced configurations all build on these basic settings. </para><para>see the <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator/SquidFaq/ReverseProxy#">FAQ Reverse Proxy</ulink> page for detailed overview of what Reverse-Proxy and HTTP Acceleration are. </para><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> The accel option to <ulink url="http://www.squid-cache.org/Doc/config/http_port#">http_port</ulink> should only be specified for 2.6.STABLE8 and later. </para></entry></row></tbody></tgroup></informaltable><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> Accelerator mode in Squid-2.5 worked quite differently, and upgrade to 2.6 or later is strongly recommended if you still use Squid-2.5. </para></entry></row></tbody></tgroup></informaltable></section><section><title>Squid Configuration File</title><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> This configuration <emphasis role="strong">MUST</emphasis> appear at the top of squid.conf above any other forward-proxy configuration (http_access etc). Otherwise the standard proxy access rules block some people viewing the accelerated site. </para></entry></row></tbody></tgroup></informaltable><para>First, you have to tell Squid to listen on port 80 (usually), so set the <emphasis role="strong"><ulink url="http://www.squid-cache.org/Doc/config/http_port#">http_port</ulink></emphasis> option with the defaultsite option telling Squid it's an accelerator for this site: </para><screen><![CDATA[http_port 80 accel defaultsite=your.main.website.name no-vhost]]></screen><itemizedlist><listitem><para><emphasis role="strong">accel</emphasis> tells Squid to handle requests coming in this port as if it was a Web Server </para></listitem><listitem><para><emphasis role="strong">defaultsite=X</emphasis> tells Squid to assume the domain <emphasis>X</emphasis> is wanted. </para></listitem><listitem><para><emphasis role="strong">no-vhost</emphasis> for <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator/Squid-3.2#">Squid-3.2</ulink> or later disables HTTP/1.1 <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator/ConfigExamples/Reverse/VirtualHosting#">domain based virtual hosting</ulink> support. Omit this option for older Squid versions. </para></listitem></itemizedlist><para>Next, you need to tell Squid where to find the real web server: </para><screen><![CDATA[cache_peer backend.webserver.ip.or.dnsname parent 80 0 no-query originserver name=myAccel]]></screen><para>And finally you need to set up access controls to allow access to your site without pushing other web requests to your web server. </para><screen><![CDATA[acl our_sites dstdomain your.main.website.name
http_access allow our_sites
cache_peer_access myAccel allow our_sites
cache_peer_access myAccel deny all]]></screen><para>You should now be able to start Squid and it will serve requests as a HTTP server. </para></section><section><title>Testing and Live</title><para>Testing of reverse-proxies should be done with Squid configured properly as it would be used in production. But the public DNS setting not pointing at it. The /etc/hosts file of a test machine can be altered to send test requests to the squid IP instead of the live webserver. </para><para>When that testing works, public DNS can be updated to send public requests to the Squid proxy instead of the master web server and Acceleration will begin immediately. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>