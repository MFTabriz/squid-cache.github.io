<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Reverse/SslWithWildcardCertifiate</title><revhistory><revision><revnumber>21</revnumber><date>2015-04-22 03:21:51</date><authorinitials>AmosJeffries</authorinitials><revremark>add missing accel to the example config lines</revremark></revision><revision><revnumber>20</revnumber><date>2015-02-08 02:45:04</date><authorinitials>AmosJeffries</authorinitials><revremark>openssl details are outdated. replace with an updated reference and just a list of prerequisites</revremark></revision><revision><revnumber>19</revnumber><date>2009-07-06 05:56:41</date><authorinitials>AmosJeffries</authorinitials><revremark>typo in config command lines.</revremark></revision><revision><revnumber>18</revnumber><date>2009-07-05 22:45:56</date><authorinitials>AmosJeffries</authorinitials><revremark>fix openssl command line parameter typo.</revremark></revision><revision><revnumber>17</revnumber><date>2009-02-14 23:55:24</date><authorinitials>AmosJeffries</authorinitials><revremark>tidy the certificate generation steps and explain whats going on.</revremark></revision><revision><revnumber>16</revnumber><date>2009-02-14 23:45:35</date><authorinitials>AmosJeffries</authorinitials><revremark>add location warning. remove FUD about hosts file.</revremark></revision><revision><revnumber>15</revnumber><date>2009-02-01 06:39:16</date><authorinitials>AmosJeffries</authorinitials><revremark>update to secure squid.conf example</revremark></revision><revision><revnumber>14</revnumber><date>2009-02-01 06:27:29</date><authorinitials>AmosJeffries</authorinitials><revremark>move into section for reverse-proxy configs</revremark></revision><revision><revnumber>13</revnumber><date>2008-11-25 20:44:59</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fixed CamelCase</revremark></revision><revision><revnumber>12</revnumber><date>2008-05-18 19:38:57</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>11</revnumber><date>2008-02-26 11:08:00</date><authorinitials>kinkie</authorinitials><revremark>Removed inappropriate CamelCase wikilink</revremark></revision><revision><revnumber>10</revnumber><date>2007-10-22 06:13:54</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>9</revnumber><date>2007-10-18 10:57:23</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>8</revnumber><date>2007-10-18 10:47:20</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>7</revnumber><date>2007-10-18 10:17:20</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>6</revnumber><date>2007-10-18 10:13:18</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>5</revnumber><date>2007-10-18 10:02:50</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>4</revnumber><date>2007-10-18 09:39:09</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>3</revnumber><date>2007-10-18 09:25:55</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>2</revnumber><date>2007-10-18 07:55:54</date><authorinitials>SudhirGupta</authorinitials></revision><revision><revnumber>1</revnumber><date>2007-10-18 07:36:38</date><authorinitials>SudhirGupta</authorinitials></revision></revhistory></articleinfo><section><title>HTTPS Reverse Proxy With Wild Card Certificate to Support Multiple Websites</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Squid can be configured as a reverse proxy terminating HTTPS from clients and relayig it to backend servers which can be either HTTP or HTTPS themselves. </para><para>This example demonstrates hosting 3 websites using wildcard certificate, with two HTTP and one HTTPS origin server. The wild card certificate will be generated on the same server on which Squid will be installed. Also the same will be acting as a CA for signing the certificates presented by Squid to clients. </para><para>For this Following information will be required </para><itemizedlist><listitem><para>IP address of the Squid server ( Squid is installed at default location .i.e /usr/local/squid/ ) </para></listitem><listitem><para>IP and the Hostname for all the 3 origin servers </para></listitem><listitem><para>OpenSSL installed on the Squid server </para></listitem></itemizedlist></section><section><title>Certificate Setup</title><para>Details on certificate management can be found at <ulink url="http://www.tldp.org/HOWTO/SSL-Certificates-HOWTO/c118.html"/> </para><para>You will need to: </para><itemizedlist><listitem><para>Create a Certification Authority certificate. </para><itemizedlist><listitem override="none"><para>The <emphasis role="strong">public key</emphasis> for this CA must be made available to your visitors so they can verify the HTTPS certificates presented by Squid. </para></listitem><listitem override="none"><para>The best way to do this for custom CA is the DANE mechanism using DNS TLSA records. </para></listitem><listitem override="none"><para>You can also attempt to get the certificate installed in the trusted CA store for all client browsers and other software - which is quite hard and does not let you change the CA quickly if it gets compromised. </para></listitem></itemizedlist></listitem><listitem><para>Create a Wildcard certificate. </para><itemizedlist><listitem override="none"><para>Both public and private keys for this certificate are configured into Squid for supplying HTTPS on the domains the wildcard matches. </para></listitem></itemizedlist></listitem></itemizedlist></section><section><title>Squid Configuration File</title><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Please note the config lines below may wrap in your browser. </para></listitem></itemizedlist><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> This configuration <emphasis role="strong">MUST</emphasis> appear at the top of squid.conf above any other forward-proxy configuration (http_access etc). Otherwise the standard proxy access rules block some people viewing the accelerated site. </para></entry></row></tbody></tgroup></informaltable><screen><![CDATA[https_port 443 accel defaultsite=mywebsite.mydomain.com \
  cert=/path/to/wildcardPublicKeyCert.pem \
  key=/path/to/wildcardPrivateKeyCert.pem
]]><![CDATA[
# First (HTTP) peer
cache_peer 10.112.62.20 parent 80 0 no-query originserver login=PASS name=websiteA
]]><![CDATA[
acl sites_server_1 dstdomain websiteA.mydomain.com
cache_peer_access websiteA allow sites_server_1
http_access allow sites_server_1
]]><![CDATA[
# Second (HTTP) peer
cache_peer 10.112.143.112 parent 80 0 no-query originserver login=PASS name=mywebsite
]]><![CDATA[
acl sites_server_2 dstdomain mywebsite.mydomain.com
cache_peer_access mywebsite allow sites_server_2
http_access allow sites_server_2
]]><![CDATA[
# Third (HTTPS) peer
cache_peer 10.112.90.20 parent 443 0 no-query originserver name=websiteB \
  ssl sslcafile=/path/to/peer/publicCAkey.pem
]]><![CDATA[
acl sites_server_3 dstdomain websiteB.mydomain.com
cache_peer_access websiteB allow sites_server_3
http_access allow sites_server_3
]]><![CDATA[
# Security block for non-hosted sites
http_access deny all]]></screen><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>