<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Reverse/ExchangeRpc</title><revhistory><revision><revnumber>10</revnumber><date>2011-10-06 11:51:48</date><authorinitials>AmosJeffries</authorinitials><revremark>add explicit accel option for recent 3.x configs which require it</revremark></revision><revision><revnumber>9</revnumber><date>2009-02-14 23:42:17</date><authorinitials>AmosJeffries</authorinitials><revremark>include config warning</revremark></revision><revision><revnumber>8</revnumber><date>2009-02-04 06:53:26</date><authorinitials>AmosJeffries</authorinitials><revremark>reverse proxy demo</revremark></revision><revision><revnumber>7</revnumber><date>2009-02-04 06:52:19</date><authorinitials>AmosJeffries</authorinitials><revremark>update after generic request methods in 3.1</revremark></revision><revision><revnumber>6</revnumber><date>2008-06-16 03:14:15</date><authorinitials>AmosJeffries</authorinitials><revremark>Clarifiy what bits are required config and which are locally variable</revremark></revision><revision><revnumber>5</revnumber><date>2008-05-27 04:25:10</date><authorinitials>AmosJeffries</authorinitials><revremark>update dexample config to prevent non-exchange requests forwarding to peer</revremark></revision><revision><revnumber>4</revnumber><date>2008-05-18 19:39:00</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>3</revnumber><date>2008-01-28 03:43:32</date><authorinitials>AmosJeffries</authorinitials><revremark>Clients should never request the IP of exchange server in peerng config.</revremark></revision></revhistory></articleinfo><section><title>Configuring Squid to Accelerate/ACL RPC over HTTP</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Outline</title><para>Squid can be used as an accelerator and ACL filter in front of an exchange server exporting mail via RPC over HTTP. The RPC_IN_DATA and RPC_OUT_DATA methods communicate with <ulink url="https://URL/rpc/rpcproxy.dll"/>, for if there's need to limit the access.. </para></section><section><title>Setup</title><para>The example situation involves a single Outlook Web Access server and a single Squid server. The following information is required: </para><itemizedlist><listitem><para>The IP of the Squid server (ip_of_squid) </para></listitem><listitem><para>The 'public' domain used for RPC Access (rpc_domain_name) </para></listitem><listitem><para>The IP of the Exchange (RPC) server (ip_of_exchange_server) </para></listitem><listitem><para>SSL Certificate to present to Exchange Server (/path/to/certificate) </para></listitem><listitem><para>SSL certificate to present to Clients (/path/to/clientcertificate) </para></listitem></itemizedlist></section><section><title>Configuration</title><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> This configuration <emphasis role="strong">MUST</emphasis> appear at the top of squid.conf above any other forward-proxy configuration (http_access etc). Otherwise the standard proxy access rules block some people viewing the accelerated site. </para></entry></row></tbody></tgroup></informaltable><screen><![CDATA[# Publish the RPCoHTTP service via SSL
https_port ip_of_squid:443 accel cert=/path/to/clientcertificate defaultsite=rpc_domain_name
]]><![CDATA[
cache_peer ip_of_exchange_server parent 443 0 no-query originserver login=PASS ssl sslcert=/path/to/certificate name=exchangeServer
]]><![CDATA[
acl EXCH dstdomain .rpc_domain_name
]]><![CDATA[
cache_peer_access exchangeServer allow EXCH
cache_peer_access exchangeServer deny all
never_direct allow EXCH
]]><![CDATA[
# Lock down access to just the Exchange Server!
http_access allow EXCH
http_access deny all
miss_access allow EXCH
miss_access deny all]]></screen><para>Squid older than 3.1 also need to define several extension methods: </para><screen><![CDATA[# Define the required extension methods
extension_methods RPC_IN_DATA RPC_OUT_DATA]]></screen></section><section><title>Thanks to</title><para>Thanks to Tuukka Laurikanien &lt;<ulink url="mailto:t.laurikainen@ibermatica.com">t.laurikainen@ibermatica.com</ulink>&gt; for providing the information used in preparing this article. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/ExchangeRpc/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></article>