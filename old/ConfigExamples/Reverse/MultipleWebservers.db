<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>ConfigExamples/Reverse/MultipleWebservers</title><revhistory><revision><revnumber>3</revnumber><date>2015-09-03 01:03:09</date><authorinitials>AmosJeffries</authorinitials><revremark>update wiki links, and mentio cache_peer_domain removal</revremark></revision><revision><revnumber>2</revnumber><date>2010-03-19 14:26:36</date><authorinitials>AmosJeffries</authorinitials><revremark>clarify the example descriptions. &quot;mapping&quot; was too difficult a concept for several people.</revremark></revision><revision><revnumber>1</revnumber><date>2009-02-01 07:22:23</date><authorinitials>AmosJeffries</authorinitials><revremark>import from FAQ</revremark></revision></revhistory></articleinfo><section><title>Reverse Proxy with Multiple Backend Web Servers</title><para><emphasis role="strong">Warning</emphasis>: Any example presented here is provided &quot;as-is&quot; with no support or guarantee of suitability. If you have any further questions about these examples please email the squid-users mailing list. </para><section><title>Sending different requests to different backend web servers</title><para>To control which web servers (<ulink url="http://www.squid-cache.org/Doc/config/cache_peer#">cache_peer</ulink>) gets which requests the <ulink url="http://www.squid-cache.org/Doc/config/cache_peer_access#">cache_peer_access</ulink> directives is used. These directives limit which requests may be sent to a given peer. </para><para>For example the websites are hosted like this on two servers: </para><itemizedlist><listitem><para>www.example.com hosted on server1 </para></listitem><listitem><para>example.com hosted on server1 </para></listitem><listitem><para>download.example.com hosted on server2 </para></listitem><listitem><para>*.example.net hosted on server2 </para></listitem><listitem><para>example.net hosted on server2 </para></listitem></itemizedlist></section><section><title>Squid Configuration</title><section><title>Switching on Domains</title><para>Using <ulink url="http://www.squid-cache.org/Doc/config/cache_peer_access#">cache_peer_access</ulink>: </para><screen><![CDATA[cache_peer ip.of.server1 parent 80 0 no-query originserver name=server_1
acl sites_server_1 dstdomain www.example.com example.com
cache_peer_access server_1 allow sites_server_1
]]><![CDATA[
cache_peer ip.of.server2 parent 80 0 no-query originserver name=server_2
acl sites_server_2 dstdomain www.example.net download.example.com .example.net
cache_peer_access server_2 allow sites_server_2]]></screen><para>The same using <ulink url="http://www.squid-cache.org/Doc/config/cache_peer_domain#">cache_peer_domain</ulink> (deprecated since <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers/Squid-3.2#">Squid-3.2</ulink>): </para><screen><![CDATA[cache_peer ip.of.server1 parent 80 0 no-query originserver name=server_1
cache_peer_domain server_1 www.example.com example.com
]]><![CDATA[
cache_peer ip.of.server2 parent 80 0 no-query originserver name=server_2
cache_peer_domain server_2 download.example.com .example.net]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> This directive has been removed in <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers/Squid-4#">Squid-4</ulink>. </para></listitem></itemizedlist><section><title>Other Criteria than Domain</title><para>It is also possible to route requests based on other criteria than the host name by using other <ulink url="http://www.squid-cache.org/Doc/config/acl#">acl</ulink> types, such as urlpath_regex. </para><para>For our example here the websites /foo directory alone is hosted on a second server: </para><itemizedlist><listitem><para>example.com is hosted on server1 </para></listitem><listitem><para>example.com/foo is hosted on server2 </para></listitem></itemizedlist><screen><![CDATA[acl foo urlpath_regex ^/foo
]]><![CDATA[
cache_peer ip.of.server1 parent 80 0 no-query originserver name=server1
cache_peer_access server1 deny foo
]]><![CDATA[
cache_peer ip.of.server2 parent 80 0 no-query originserver name=server2
cache_peer_access server2 allow foo
cache_peer_access server2 deny all]]></screen><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> Remember that the cache is on the requested URL and not which peer the request is forwarded to so don't use user dependent acls if the content is cached. </para></entry></row></tbody></tgroup></informaltable><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/ConfigExamples/Reverse/MultipleWebservers/CategoryConfigExample#">CategoryConfigExample</ulink> </para></section></section></section></section></article>