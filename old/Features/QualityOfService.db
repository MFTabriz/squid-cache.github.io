<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/QualityOfService</title><revhistory><revision><revnumber>15</revnumber><date>2014-03-25 01:59:19</date><authorinitials>AmosJeffries</authorinitials><revremark>update with 3.2 alterations</revremark></revision><revision><revnumber>14</revnumber><date>2008-12-24 07:29:23</date><authorinitials>AmosJeffries</authorinitials><revremark>missed a bit</revremark></revision><revision><revnumber>13</revnumber><date>2008-12-24 07:27:45</date><authorinitials>AmosJeffries</authorinitials><revremark>update for current ZPH polish</revremark></revision><revision><revnumber>12</revnumber><date>2008-11-01 12:25:15</date><authorinitials>AmosJeffries</authorinitials><revremark>polish underway.</revremark></revision><revision><revnumber>11</revnumber><date>2008-10-10 01:02:39</date><authorinitials>AmosJeffries</authorinitials><revremark>update for FAQ listing.</revremark></revision><revision><revnumber>10</revnumber><date>2008-09-03 03:29:12</date><authorinitials>AmosJeffries</authorinitials><revremark>fancy up for FAQ. add config descriptions.</revremark></revision><revision><revnumber>9</revnumber><date>2008-08-25 11:32:20</date><authorinitials>AmosJeffries</authorinitials><revremark>polish a little for FAQ, not complete</revremark></revision><revision><revnumber>8</revnumber><date>2008-06-28 12:58:45</date><authorinitials>AmosJeffries</authorinitials><revremark>ZPH is a brand name. And 3.0 does have an untested patch.</revremark></revision><revision><revnumber>7</revnumber><date>2008-06-04 13:01:14</date><authorinitials>AmosJeffries</authorinitials><revremark>config idea</revremark></revision><revision><revnumber>6</revnumber><date>2008-05-18 19:38:55</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>5</revnumber><date>2008-05-01 09:33:15</date><authorinitials>AmosJeffries</authorinitials><revremark>QoS is complete and comitted to HEAD</revremark></revision><revision><revnumber>4</revnumber><date>2008-04-23 15:00:46</date><authorinitials>AmosJeffries</authorinitials><revremark>patch for 3.0 is done.</revremark></revision><revision><revnumber>3</revnumber><date>2008-04-21 04:46:39</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>2</revnumber><date>2008-04-20 06:44:00</date><authorinitials>AmosJeffries</authorinitials><revremark>Marin Stavrev is workign on it. add to wishlist.</revremark></revision><revision><revnumber>1</revnumber><date>2008-04-17 04:09:11</date><authorinitials>AmosJeffries</authorinitials><revremark>ZPH patch looks like it could be worth adding. Some users have also asked about it.</revremark></revision></revhistory></articleinfo><section><title>QoS (Quality of Service) Support</title><itemizedlist><listitem><para><emphasis role="strong">Version</emphasis>: 3.1, 2.7 </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: Marin Stavrev </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: <ulink url="http://zph.bratcheda.org/"/> </para></listitem></itemizedlist><section><title>Details</title><para><emphasis role="strong">Zero Penalty Hit</emphasis> created a patch to set QoS markers on outgoing traffic to clients.  </para><itemizedlist><listitem><para>Allows you to select a TOS/Diffserv value to mark local hits. </para></listitem><listitem><para>Allows you to select a TOS/Diffserv value to mark peer hits. </para></listitem><listitem><para>Allows you to selectively set only sibling or parent requests </para></listitem><listitem><para>Allows any HTTP response to clients will have the TOS value of the response coming from the remote server masked. For this to work correctly, you will need to patch your linux kernel with the TOS preserving ZPH patch. The kernel patch can be downloaded from <ulink url="http://zph.bratcheda.org"/> </para></listitem><listitem><para>Allows you to mask certain bits in the TOS received from the remote server, before copying the value to the TOS send towards clients. </para></listitem></itemizedlist></section><section><title>Squid Configuration</title><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> Requires <emphasis role="strong">--enable-zph-qos</emphasis> configure option </para></entry></row></tbody></tgroup></informaltable><section><title>Squid 3.2 and later</title><para>The configuration options for <ulink url="https://wiki.squid-cache.org/Features/QualityOfService/Squid-3.2#">Squid-3.2</ulink> are extended to support both TOS and Linux MARK tagging. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> The 0xNN values here are set according to your system policy. They may differ from those shown. </para></listitem></itemizedlist><para>Responses found as a HIT in the local cache </para><screen><![CDATA[qos_flows tos local-hit=0x30
]]><![CDATA[
qos_flows mark local-hit=0x30]]></screen><para>Responses found as a HIT on sibling peer. </para><screen><![CDATA[qos_flows tos sibling-hit=0x31
]]><![CDATA[
qos_flows mark sibling-hit=0x31]]></screen><para>Responses found as a HIT on parent peer. </para><screen><![CDATA[qos_flows tos parent-hit=0x32
]]><![CDATA[
qos_flows mark parent-hit=0x32]]></screen><para>Responses found as a MISS may have existing values. </para><itemizedlist><listitem><para><emphasis role="strong">preserve-miss</emphasis> locates and passes the same settings received by Squid from the remote server, on the client connection. On non-Linux or unpatched Linux the miss TOS is always zero. The capability may be disabled if desired. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> TOS requires Linux with kernel patching. </para></listitem></itemizedlist></listitem></itemizedlist><screen><![CDATA[qos_flows tos disable-preserve-miss
]]><![CDATA[
qos_flows mark disable-preserve-miss]]></screen><itemizedlist><listitem><para><emphasis role="strong">miss</emphasis> sets a new value on MISS responses to the client from Squid. An optionanl mask can be applied to limit which bits are set to the new value. Unmasked bits are preserved from the value received from server. <inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> TOS requires Linux with kernel patching to reserve and mask the existing value from server. </para></listitem></itemizedlist><para>On non-Linux or unpatched Linux the miss TOS is always zero. The capability may be disabled if desired. </para><screen><![CDATA[qos_flows tos miss=0x0A/0x0F
]]><![CDATA[
qos_flows mark miss=0x0A/0x0F]]></screen></section><section><title>Squid 3.1</title><para>The configuration options for 2.7 and 3.1 are based on different ZPH patches. The 3.1 configuration provides clear TOS settings for each outbound response type. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> The 0xNN values here are set according to your system policy. They may differ from those shown. </para></listitem></itemizedlist><para>Responses found as a HIT in the local cache </para><screen><![CDATA[qos_flows local-hit=0x30]]></screen><para>Responses found as a HIT on sibling peer. </para><screen><![CDATA[qos_flows sibling-hit=0x31]]></screen><para>Responses found as a HIT on parent peer. </para><screen><![CDATA[qos_flows parent-hit=0x32]]></screen><para><emphasis role="strong">preserve-miss</emphasis> locates and passes the same TOS settings received by Squid from the remote server, on the client connection. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="15" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/alert.png" width="15"/></imageobject><textobject><phrase>/!\</phrase></textobject></inlinemediaobject> requires Linux with kernel patching. </para></listitem></itemizedlist><para>On non-Linux or unpatched Linux the miss TOS is always zero. The capability may be disabled if desired. </para><screen><![CDATA[qos_flows disable-preserve-miss]]></screen></section><section><title>Squid 2.7</title><para>The configuration options for 2.7 and 3.1 are based on different ZPH patches. The 2.7 patch does not have pass-thru capability. It does however include support for some legacy QoS protocols besides ToS. </para><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> The 0xNN values here are set according to your system policy. They may differ from those shown. </para></listitem></itemizedlist><para>Responses found as a HIT in the local cache </para><screen><![CDATA[zph_mode tos
zph_local 0x30]]></screen><para>Responses found as a HIT on peer (sibling only) caches. </para><screen><![CDATA[zph_mode tos
zph_sibling 0x31]]></screen><para>Responses found as a HIT on peer (parent only) caches. </para><screen><![CDATA[zph_mode tos
zph_parent 0x32]]></screen><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/QualityOfService/CategoryFeature#">CategoryFeature</ulink> </para></section></section></section></article>