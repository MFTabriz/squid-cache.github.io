<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/StoreID/Helper/Golang-2-api</title><revhistory><revision><revnumber>3</revnumber><date>2017-06-14 18:05:26</date><authorinitials>Eliezer Croitoru</authorinitials><revremark>Upgraded the helper to only exit if all answers were recieved.</revremark></revision><revision><revnumber>2</revnumber><date>2016-07-26 22:31:26</date><authorinitials>Eliezer Croitoru</authorinitials><revremark>Fixed a typo</revremark></revision><revision><revnumber>1</revnumber><date>2016-05-28 21:35:49</date><authorinitials>Eliezer Croitoru</authorinitials></revision></revhistory></articleinfo><programlisting format="linespecific" language="highlight" linenumbering="numbered" startinglinenumber="1"><token><![CDATA[package]]></token><![CDATA[ ]]><methodname><![CDATA[main]]></methodname>

<lineannotation><![CDATA[/*]]></lineannotation>
<lineannotation><![CDATA[license note]]></lineannotation>
<lineannotation><![CDATA[Copyright (c) 2017, Eliezer Croitoru]]></lineannotation>
<lineannotation><![CDATA[All rights reserved.]]></lineannotation>
<lineannotation></lineannotation>
<lineannotation><![CDATA[Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:]]></lineannotation>
<lineannotation><![CDATA[1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.]]></lineannotation>
<lineannotation><![CDATA[2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.]]></lineannotation>
<lineannotation><![CDATA[3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.]]></lineannotation>
<lineannotation></lineannotation>
<lineannotation><![CDATA[THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.]]></lineannotation>
<lineannotation><![CDATA[*/]]></lineannotation>

<lineannotation><![CDATA[// Resources:]]></lineannotation>
<lineannotation></lineannotation><lineannotation><![CDATA[// - http://www.jokecamp.com/blog/examples-of-creating-base64-hashes-using-hmac-sha256-in-different-languages/]]></lineannotation>
<lineannotation></lineannotation><lineannotation><![CDATA[// - https://gobyexample.com/base64-encoding]]></lineannotation>
<lineannotation></lineannotation>
<token><![CDATA[import]]></token><![CDATA[ (]]>
<![CDATA[        ]]><phrase><![CDATA["bufio"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["crypto/tls"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["crypto/x509"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["encoding/base64"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["flag"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["fmt"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["golang.org/x/net/http2"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["io/ioutil"]]></phrase>
<![CDATA[        ]]><lineannotation><![CDATA[//"net"]]></lineannotation>
<lineannotation></lineannotation><![CDATA[        ]]><lineannotation><![CDATA[// Net libs can be used to parse IP addresses]]></lineannotation>
<lineannotation></lineannotation><![CDATA[        ]]><phrase><![CDATA["net/http"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["net/url"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["os"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["strings"]]></phrase>
<![CDATA[        ]]><phrase><![CDATA["sync"]]></phrase>
<![CDATA[)]]>

<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ *]]><token><![CDATA[bool]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[storeIdApiUrl]]></methodname><![CDATA[ *]]><token><![CDATA[string]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[user]]></methodname><![CDATA[ *]]><token><![CDATA[string]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[pass]]></methodname><![CDATA[ *]]><token><![CDATA[string]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[tlsConfig]]></methodname><![CDATA[ *]]><methodname><![CDATA[tls]]></methodname><![CDATA[.]]><methodname><![CDATA[Config]]></methodname>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[tlsCert]]></methodname><![CDATA[ *]]><token><![CDATA[string]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[pemCert]]></methodname><![CDATA[ []]]><token><![CDATA[byte]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[dontVerifyTls]]></methodname><![CDATA[ *]]><token><![CDATA[bool]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[useOsTls]]></methodname><![CDATA[ *]]><token><![CDATA[bool]]></token>
<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ *]]><token><![CDATA[string]]></token>

<token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ ]]><token><![CDATA[error]]></token>

<token><![CDATA[func]]></token><![CDATA[ ]]><methodname><![CDATA[process_request]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[ ]]><token><![CDATA[string]]></token><![CDATA[, ]]><methodname><![CDATA[wg]]></methodname><![CDATA[ *]]><methodname><![CDATA[sync]]></methodname><![CDATA[.]]><methodname><![CDATA[WaitGroup]]></methodname><![CDATA[) {]]>
<![CDATA[        ]]><token><![CDATA[defer]]></token><![CDATA[ ]]><methodname><![CDATA[wg]]></methodname><![CDATA[.]]><methodname><![CDATA[Done]]></methodname><![CDATA[()]]>
<![CDATA[        ]]><methodname><![CDATA[answer]]></methodname><![CDATA[ := ]]><phrase><![CDATA["ERR"]]></phrase>
<![CDATA[        ]]><methodname><![CDATA[lparts]]></methodname><![CDATA[ := ]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[Split]]></methodname><![CDATA[(]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[TrimRight]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[, ]]><phrase><![CDATA["\n"]]></phrase><![CDATA[), ]]><phrase><![CDATA[" "]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ ]]><token><![CDATA[len]]></token><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[0]) > 0 {]]>
<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ *]]><methodname><![CDATA[debug]]></methodname><![CDATA[ {]]>
<![CDATA[                        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: Proccessing request => \""]]></phrase><![CDATA[+]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[TrimRight]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[, ]]><phrase><![CDATA["\n"]]></phrase><![CDATA[)+]]><phrase><![CDATA["\""]]></phrase><![CDATA[)]]>
<![CDATA[                }]]>
<![CDATA[        }]]>

<![CDATA[        ]]><token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[client]]></methodname><![CDATA[ *]]><methodname><![CDATA[http]]></methodname><![CDATA[.]]><methodname><![CDATA[Client]]></methodname>
<![CDATA[        ]]><token><![CDATA[switch]]></token><![CDATA[ *]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ {]]>
<![CDATA[        ]]><token><![CDATA[case]]></token><![CDATA[ ]]><phrase><![CDATA["2"]]></phrase><![CDATA[:]]>
<![CDATA[                ]]><methodname><![CDATA[client]]></methodname><![CDATA[ = &]]><methodname><![CDATA[http]]></methodname><![CDATA[.]]><methodname><![CDATA[Client]]></methodname><![CDATA[{]]>
<![CDATA[                        ]]><methodname><![CDATA[Transport]]></methodname><![CDATA[: &]]><methodname><![CDATA[http2]]></methodname><![CDATA[.]]><methodname><![CDATA[Transport]]></methodname><![CDATA[{]]><methodname><![CDATA[TLSClientConfig]]></methodname><![CDATA[: ]]><methodname><![CDATA[tlsConfig]]></methodname><![CDATA[},]]>
<![CDATA[                }]]>
<![CDATA[        ]]><token><![CDATA[default]]></token><![CDATA[:]]>
<![CDATA[                ]]><methodname><![CDATA[client]]></methodname><![CDATA[ = &]]><methodname><![CDATA[http]]></methodname><![CDATA[.]]><methodname><![CDATA[Client]]></methodname><![CDATA[{}]]>
<![CDATA[        }]]>

<![CDATA[        ]]><methodname><![CDATA[testurl]]></methodname><![CDATA[, ]]><methodname><![CDATA[_]]></methodname><![CDATA[ := ]]><methodname><![CDATA[url]]></methodname><![CDATA[.]]><methodname><![CDATA[Parse]]></methodname><![CDATA[(*]]><methodname><![CDATA[storeIdApiUrl]]></methodname><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[testurlVals]]></methodname><![CDATA[ := ]]><methodname><![CDATA[url]]></methodname><![CDATA[.]]><methodname><![CDATA[Values]]></methodname><![CDATA[{}]]>
<![CDATA[        ]]><methodname><![CDATA[testurlVals]]></methodname><![CDATA[.]]><methodname><![CDATA[Set]]></methodname><![CDATA[(]]><phrase><![CDATA["url"]]></phrase><![CDATA[, ]]><methodname><![CDATA[base64]]></methodname><![CDATA[.]]><methodname><![CDATA[StdEncoding]]></methodname><![CDATA[.]]><methodname><![CDATA[EncodeToString]]></methodname><![CDATA[([]]]><token><![CDATA[byte]]></token><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[1])))]]>
<![CDATA[        ]]><lineannotation><![CDATA[//testurlVals.Set("other", port)]]></lineannotation>
<lineannotation></lineannotation><![CDATA[        ]]><lineannotation><![CDATA[//testurlVals.Set("otherother", srcip)]]></lineannotation>
<lineannotation></lineannotation><![CDATA[        ]]><methodname><![CDATA[testurl]]></methodname><![CDATA[.]]><methodname><![CDATA[RawQuery]]></methodname><![CDATA[ = ]]><methodname><![CDATA[testurlVals]]></methodname><![CDATA[.]]><methodname><![CDATA[Encode]]></methodname><![CDATA[()]]>

<![CDATA[        ]]><methodname><![CDATA[request]]></methodname><![CDATA[, ]]><methodname><![CDATA[err]]></methodname><![CDATA[ := ]]><methodname><![CDATA[http]]></methodname><![CDATA[.]]><methodname><![CDATA[NewRequest]]></methodname><![CDATA[(]]><phrase><![CDATA["GET"]]></phrase><![CDATA[, ]]><methodname><![CDATA[testurl]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(), ]]><symbol><![CDATA[nil]]></symbol><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[request]]></methodname><![CDATA[.]]><methodname><![CDATA[Close]]></methodname><![CDATA[ = ]]><symbol><![CDATA[true]]></symbol>
<![CDATA[        ]]><methodname><![CDATA[request]]></methodname><![CDATA[.]]><methodname><![CDATA[SetBasicAuth]]></methodname><![CDATA[(*]]><methodname><![CDATA[user]]></methodname><![CDATA[, *]]><methodname><![CDATA[pass]]></methodname><![CDATA[)]]>

<![CDATA[        ]]><methodname><![CDATA[resp]]></methodname><![CDATA[, ]]><methodname><![CDATA[err]]></methodname><![CDATA[ := ]]><methodname><![CDATA[client]]></methodname><![CDATA[.]]><methodname><![CDATA[Do]]></methodname><![CDATA[(]]><methodname><![CDATA[request]]></methodname><![CDATA[)]]>
<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ != ]]><symbol><![CDATA[nil]]></symbol><![CDATA[ {]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: reporting a http connection error1 => \""]]></phrase><![CDATA[+]]><methodname><![CDATA[err]]></methodname><![CDATA[.]]><methodname><![CDATA[Error]]></methodname><![CDATA[()+]]><phrase><![CDATA["\""]]></phrase><![CDATA[)]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Println]]></methodname><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[0] + ]]><phrase><![CDATA[" "]]></phrase><![CDATA[ + ]]><methodname><![CDATA[answer]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[return]]></token>
<![CDATA[        }]]>

<![CDATA[        ]]><token><![CDATA[defer]]></token><![CDATA[ ]]><methodname><![CDATA[resp]]></methodname><![CDATA[.]]><methodname><![CDATA[Body]]></methodname><![CDATA[.]]><methodname><![CDATA[Close]]></methodname><![CDATA[()]]>

<![CDATA[        ]]><methodname><![CDATA[body]]></methodname><![CDATA[, ]]><methodname><![CDATA[err]]></methodname><![CDATA[ := ]]><methodname><![CDATA[ioutil]]></methodname><![CDATA[.]]><methodname><![CDATA[ReadAll]]></methodname><![CDATA[(]]><methodname><![CDATA[resp]]></methodname><![CDATA[.]]><methodname><![CDATA[Body]]></methodname><![CDATA[)]]>
<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ != ]]><symbol><![CDATA[nil]]></symbol><![CDATA[ {]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: reporting a http connection error2 => \""]]></phrase><![CDATA[+]]><methodname><![CDATA[err]]></methodname><![CDATA[.]]><methodname><![CDATA[Error]]></methodname><![CDATA[()+]]><phrase><![CDATA["\""]]></phrase><![CDATA[)]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Println]]></methodname><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[0] + ]]><phrase><![CDATA[" "]]></phrase><![CDATA[ + ]]><methodname><![CDATA[answer]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[return]]></token>
<![CDATA[        }]]>

<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[body]]></methodname><![CDATA[ != ]]><symbol><![CDATA[nil]]></symbol><![CDATA[ {]]>
<![CDATA[                ]]><methodname><![CDATA[response]]></methodname><![CDATA[ := ]]><token><![CDATA[string]]></token><![CDATA[(]]><methodname><![CDATA[body]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[HasPrefix]]></methodname><![CDATA[(]]><methodname><![CDATA[response]]></methodname><![CDATA[, ]]><phrase><![CDATA["OK "]]></phrase><![CDATA[) {]]>
<![CDATA[                        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Println]]></methodname><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[0] + ]]><phrase><![CDATA[" "]]></phrase><![CDATA[ + ]]><methodname><![CDATA[response]]></methodname><![CDATA[)]]>
<![CDATA[                }]]>
<![CDATA[        }]]>

<![CDATA[        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Println]]></methodname><![CDATA[(]]><methodname><![CDATA[lparts]]></methodname><![CDATA[[0] + ]]><phrase><![CDATA[" "]]></phrase><![CDATA[ + ]]><methodname><![CDATA[answer]]></methodname><![CDATA[)]]>
<![CDATA[}]]>

<token><![CDATA[func]]></token><![CDATA[ ]]><methodname><![CDATA[init]]></methodname><![CDATA[() {]]>

<![CDATA[        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: Starting Fake helper"]]></phrase><![CDATA[)]]>

<![CDATA[        ]]><methodname><![CDATA[debug]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[Bool]]></methodname><![CDATA[(]]><phrase><![CDATA["d"]]></phrase><![CDATA[, ]]><symbol><![CDATA[false]]></symbol><![CDATA[, ]]><phrase><![CDATA["Debug mode can be \"yes\" or something else for no"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[storeIdApiUrl]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(]]><phrase><![CDATA["api-url"]]></phrase><![CDATA[, ]]><phrase><![CDATA["http://ngtech.co.il/fake-storeid-url/"]]></phrase><![CDATA[, ]]><phrase><![CDATA["The url of the api"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[user]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(]]><phrase><![CDATA["api-user"]]></phrase><![CDATA[, ]]><phrase><![CDATA["admin"]]></phrase><![CDATA[, ]]><phrase><![CDATA["Basic auth username for server authentication"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[pass]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(]]><phrase><![CDATA["api-pass"]]></phrase><![CDATA[, ]]><phrase><![CDATA["admin"]]></phrase><![CDATA[, ]]><phrase><![CDATA["Basic auth password for server authentication"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(]]><phrase><![CDATA["api-httpv"]]></phrase><![CDATA[, ]]><phrase><![CDATA["1"]]></phrase><![CDATA[, ]]><phrase><![CDATA["http client version: 1\\2"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[tlsCert]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[String]]></methodname><![CDATA[(]]><phrase><![CDATA["tlscert"]]></phrase><![CDATA[, ]]><phrase><![CDATA["cert.pem"]]></phrase><![CDATA[, ]]><phrase><![CDATA["tls certificate"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[dontVerifyTls]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[Bool]]></methodname><![CDATA[(]]><phrase><![CDATA["skiptls"]]></phrase><![CDATA[, ]]><symbol><![CDATA[false]]></symbol><![CDATA[, ]]><phrase><![CDATA["Verify tls certificate, use \"1\" to enable"]]></phrase><![CDATA[)]]>
<![CDATA[        ]]><methodname><![CDATA[useOsTls]]></methodname><![CDATA[ = ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[Bool]]></methodname><![CDATA[(]]><phrase><![CDATA["ostls"]]></phrase><![CDATA[, ]]><symbol><![CDATA[false]]></symbol><![CDATA[, ]]><phrase><![CDATA["Use OS tls certificates, use \"1\" to enable"]]></phrase><![CDATA[)]]>

<![CDATA[        ]]><methodname><![CDATA[flag]]></methodname><![CDATA[.]]><methodname><![CDATA[Parse]]></methodname><![CDATA[()]]>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[ := ]]><token><![CDATA[make]]></token><![CDATA[(]]><token><![CDATA[map]]></token><![CDATA[[]]><token><![CDATA[string]]></token><![CDATA[]]]><token><![CDATA[interface]]></token><![CDATA[{})]]>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["debug"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[debug]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["api-url"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[storeIdApiUrl]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["api_user"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[user]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["api_pass"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[pass]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["api-httpv"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[http_version]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["tlscert"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[tlsCert]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["skiptls"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[dontVerifyTls]]></methodname>
<![CDATA[        ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[[]]><phrase><![CDATA["ostls"]]></phrase><![CDATA[] = *]]><methodname><![CDATA[useOsTls]]></methodname>

<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ *]]><methodname><![CDATA[debug]]></methodname><![CDATA[ {]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: Config Variables:"]]></phrase><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[for]]></token><![CDATA[ ]]><methodname><![CDATA[k]]></methodname><![CDATA[, ]]><methodname><![CDATA[v]]></methodname><![CDATA[ := ]]><token><![CDATA[range]]></token><![CDATA[ ]]><methodname><![CDATA[flagsMap]]></methodname><![CDATA[ {]]>
<![CDATA[                        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintf]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog:\t%v =>  %v\n"]]></phrase><![CDATA[, ]]><methodname><![CDATA[k]]></methodname><![CDATA[, ]]><methodname><![CDATA[v]]></methodname><![CDATA[)]]>
<![CDATA[                }]]>
<![CDATA[        }]]>
<![CDATA[}]]>

<token><![CDATA[func]]></token><![CDATA[ ]]><methodname><![CDATA[main]]></methodname><![CDATA[() {]]>
<![CDATA[        ]]><token><![CDATA[if]]></token><![CDATA[ *]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ == ]]><phrase><![CDATA["2"]]></phrase><![CDATA[ && ]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[HasPrefix]]></methodname><![CDATA[(*]]><methodname><![CDATA[storeIdApiUrl]]></methodname><![CDATA[, ]]><phrase><![CDATA["http://"]]></phrase><![CDATA[) {]]>
<![CDATA[                ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintf]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: ### The http2 library doesn't support \"https://\" scheme, you are using => %v\n"]]></phrase><![CDATA[, *]]><methodname><![CDATA[storeIdApiUrl]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[return]]></token>
<![CDATA[        }]]>

<![CDATA[        ]]><token><![CDATA[switch]]></token><![CDATA[ {]]>
<![CDATA[        ]]><token><![CDATA[case]]></token><![CDATA[ *]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ == ]]><phrase><![CDATA["2"]]></phrase><![CDATA[ && *]]><methodname><![CDATA[useOsTls]]></methodname><![CDATA[:]]>

<![CDATA[        ]]><token><![CDATA[case]]></token><![CDATA[ (*]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ == ]]><phrase><![CDATA["2"]]></phrase><![CDATA[) && !*]]><methodname><![CDATA[dontVerifyTls]]></methodname><![CDATA[:]]>
<![CDATA[                ]]><methodname><![CDATA[tlsConfig]]></methodname><![CDATA[ = &]]><methodname><![CDATA[tls]]></methodname><![CDATA[.]]><methodname><![CDATA[Config]]></methodname><![CDATA[{]]><methodname><![CDATA[RootCAs]]></methodname><![CDATA[: ]]><methodname><![CDATA[x509]]></methodname><![CDATA[.]]><methodname><![CDATA[NewCertPool]]></methodname><![CDATA[()}]]>

<![CDATA[                ]]><token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ ]]><token><![CDATA[error]]></token>
<![CDATA[                ]]><methodname><![CDATA[pemCert]]></methodname><![CDATA[, ]]><methodname><![CDATA[err]]></methodname><![CDATA[ = ]]><methodname><![CDATA[ioutil]]></methodname><![CDATA[.]]><methodname><![CDATA[ReadFile]]></methodname><![CDATA[(*]]><methodname><![CDATA[tlsCert]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ != ]]><symbol><![CDATA[nil]]></symbol><![CDATA[ {]]>
<![CDATA[                        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Println]]></methodname><![CDATA[(]]><methodname><![CDATA[err]]></methodname><![CDATA[)]]>
<![CDATA[                }]]>
<![CDATA[                ]]><methodname><![CDATA[ok]]></methodname><![CDATA[ := ]]><methodname><![CDATA[tlsConfig]]></methodname><![CDATA[.]]><methodname><![CDATA[RootCAs]]></methodname><![CDATA[.]]><methodname><![CDATA[AppendCertsFromPEM]]></methodname><![CDATA[(]]><methodname><![CDATA[pemCert]]></methodname><![CDATA[)]]>
<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ !]]><methodname><![CDATA[ok]]></methodname><![CDATA[ {]]>
<![CDATA[                        ]]><token><![CDATA[panic]]></token><![CDATA[(]]><phrase><![CDATA["Couldn't load PEM data"]]></phrase><![CDATA[)]]>
<![CDATA[                }]]>
<![CDATA[        ]]><token><![CDATA[case]]></token><![CDATA[ (*]]><methodname><![CDATA[http_version]]></methodname><![CDATA[ == ]]><phrase><![CDATA["2"]]></phrase><![CDATA[ && (*]]><methodname><![CDATA[dontVerifyTls]]></methodname><![CDATA[)):]]>
<![CDATA[                ]]><methodname><![CDATA[tlsConfig]]></methodname><![CDATA[ = &]]><methodname><![CDATA[tls]]></methodname><![CDATA[.]]><methodname><![CDATA[Config]]></methodname><![CDATA[{]]><methodname><![CDATA[InsecureSkipVerify]]></methodname><![CDATA[: ]]><symbol><![CDATA[true]]></symbol><![CDATA[}]]>
<![CDATA[        ]]><token><![CDATA[default]]></token><![CDATA[:]]>

<![CDATA[        }]]>

<![CDATA[        ]]><token><![CDATA[var]]></token><![CDATA[ ]]><methodname><![CDATA[wg]]></methodname><![CDATA[ ]]><methodname><![CDATA[sync]]></methodname><![CDATA[.]]><methodname><![CDATA[WaitGroup]]></methodname>

<![CDATA[        ]]><methodname><![CDATA[reader]]></methodname><![CDATA[ := ]]><methodname><![CDATA[bufio]]></methodname><![CDATA[.]]><methodname><![CDATA[NewReader]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stdin]]></methodname><![CDATA[)]]>

<![CDATA[        ]]><token><![CDATA[for]]></token><![CDATA[ {]]>
<![CDATA[                ]]><methodname><![CDATA[line]]></methodname><![CDATA[, ]]><methodname><![CDATA[err]]></methodname><![CDATA[ := ]]><methodname><![CDATA[reader]]></methodname><![CDATA[.]]><methodname><![CDATA[ReadString]]></methodname><![CDATA[('\n')]]>

<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[err]]></methodname><![CDATA[ != ]]><symbol><![CDATA[nil]]></symbol><![CDATA[ {]]>
<![CDATA[                        ]]><lineannotation><![CDATA[// You may check here if err == io.EOF]]></lineannotation>
<lineannotation></lineannotation><![CDATA[                        ]]><token><![CDATA[break]]></token>
<![CDATA[                }]]>
<![CDATA[                ]]><token><![CDATA[if]]></token><![CDATA[ ]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[HasPrefix]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[, ]]><phrase><![CDATA["q"]]></phrase><![CDATA[) || ]]><methodname><![CDATA[strings]]></methodname><![CDATA[.]]><methodname><![CDATA[HasPrefix]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[, ]]><phrase><![CDATA["Q"]]></phrase><![CDATA[) {]]>
<![CDATA[                        ]]><methodname><![CDATA[fmt]]></methodname><![CDATA[.]]><methodname><![CDATA[Fprintln]]></methodname><![CDATA[(]]><methodname><![CDATA[os]]></methodname><![CDATA[.]]><methodname><![CDATA[Stderr]]></methodname><![CDATA[, ]]><phrase><![CDATA["ERRlog: Exiting cleanly"]]></phrase><![CDATA[)]]>
<![CDATA[                        ]]><token><![CDATA[break]]></token>
<![CDATA[                }]]>

<![CDATA[                ]]><methodname><![CDATA[wg]]></methodname><![CDATA[.]]><methodname><![CDATA[Add]]></methodname><![CDATA[(1)]]>
<![CDATA[                ]]><token><![CDATA[go]]></token><![CDATA[ ]]><methodname><![CDATA[process_request]]></methodname><![CDATA[(]]><methodname><![CDATA[line]]></methodname><![CDATA[, &]]><methodname><![CDATA[wg]]></methodname><![CDATA[)]]>

<![CDATA[        }]]>
<![CDATA[        ]]><methodname><![CDATA[wg]]></methodname><![CDATA[.]]><methodname><![CDATA[Wait]]></methodname><![CDATA[()]]>

<![CDATA[}]]>
</programlisting></article>