<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/HTTP11</title><revhistory><revision><revnumber>38</revnumber><date>2018-08-30 15:52:49</date><authorinitials>AlexRousskov</authorinitials><revremark>Polished wording and formatting of the text linking to Co-Advisor results</revremark></revision><revision><revnumber>37</revnumber><date>2018-08-30 10:14:44</date><authorinitials>EduardBg</authorinitials><revremark>Uploaded new Co-Advisor HTTP/1.1 compliance tests.</revremark></revision><revision><revnumber>36</revnumber><date>2014-10-14 04:52:40</date><authorinitials>AmosJeffries</authorinitials><revremark>drop obscure &quot;other&quot; section.</revremark></revision><revision><revnumber>35</revnumber><date>2014-07-31 07:50:03</date><authorinitials>AmosJeffries</authorinitials><revremark>reference additional specifications to which Squid has or should have some compliance for HTTP/1.1</revremark></revision><revision><revnumber>34</revnumber><date>2014-07-31 06:29:55</date><authorinitials>AmosJeffries</authorinitials><revremark>Update for new RFC set separating issues by specification document</revremark></revision><revision><revnumber>33</revnumber><date>2014-06-26 07:06:04</date><authorinitials>AmosJeffries</authorinitials><revremark>RFC2616 is obsoleted now. reference the new RFCs</revremark></revision><revision><revnumber>32</revnumber><date>2013-08-21 15:56:18</date><authorinitials>PavelKazlenka</authorinitials><revremark>Uploaded new http 1.1 compliance checklist</revremark></revision><revision><revnumber>31</revnumber><date>2013-08-20 14:29:31</date><authorinitials>PavelKazlenka</authorinitials></revision><revision><revnumber>30</revnumber><date>2013-07-30 09:35:42</date><authorinitials>AmosJeffries</authorinitials><revremark>add HTTPbis document reference.</revremark></revision><revision><revnumber>29</revnumber><date>2013-02-09 09:08:01</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>28</revnumber><date>2013-02-09 09:07:45</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>27</revnumber><date>2012-09-04 14:28:47</date><authorinitials>DmitryKurochkin</authorinitials></revision><revision><revnumber>26</revnumber><date>2012-08-15 12:21:43</date><authorinitials>AmosJeffries</authorinitials><revremark>minor updates for 3.2 status. This needs a bigger update and more current co-advisor tests.</revremark></revision><revision><revnumber>25</revnumber><date>2011-08-18 15:40:15</date><authorinitials>AmosJeffries</authorinitials><revremark>detail the most urgent minor tasks</revremark></revision><revision><revnumber>24</revnumber><date>2010-10-01 22:15:00</date><authorinitials>AlexRousskov</authorinitials><revremark>Replaced stale Details with less stale and more to-the-point Summary. I am not 100% sure about v3.2 status, so I used trunk instead.</revremark></revision><revision><revnumber>23</revnumber><date>2010-10-01 21:54:54</date><authorinitials>AlexRousskov</authorinitials><revremark>Updated status, uploaded current checklist.</revremark></revision><revision><revnumber>22</revnumber><date>2010-09-29 01:53:37</date><authorinitials>AmosJeffries</authorinitials><revremark>3.1 advertises to servers, 3.2 to clients as well. minor text tweaks, leavign the major state description changes to Alex.</revremark></revision><revision><revnumber>21</revnumber><date>2010-08-19 01:04:24</date><authorinitials>AmosJeffries</authorinitials><revremark>3.1.1 hit 70% going by the April checklist.</revremark></revision><revision><revnumber>20</revnumber><date>2010-04-15 14:03:06</date><authorinitials>VadimKiparenko</authorinitials><revremark>Added 3.1.1-20100414 snapshot results to show the impact of HTTP/1.1 in the sent headers.</revremark></revision><revision><revnumber>19</revnumber><date>2010-04-07 01:56:50</date><authorinitials>AmosJeffries</authorinitials><revremark>update on the feature status.</revremark></revision><revision><revnumber>18</revnumber><date>2010-03-29 21:09:35</date><authorinitials>AmosJeffries</authorinitials><revremark>some minor updates</revremark></revision><revision><revnumber>17</revnumber><date>2010-02-12 19:03:38</date><authorinitials>AlexRousskov</authorinitials><revremark>Polished feature header</revremark></revision><revision><revnumber>16</revnumber><date>2010-02-12 19:00:58</date><authorinitials>AlexRousskov</authorinitials><revremark>updated checklist description</revremark></revision><revision><revnumber>15</revnumber><date>2010-02-12 18:41:04</date><authorinitials>AlexRousskov</authorinitials><revremark>Uploaded 2010-02-12 checklist with better formatting and no outdated results. The 2010-02-11 snapshot has results for both older and newer Squid versions.</revremark></revision><revision><revnumber>14</revnumber><date>2010-02-10 17:02:34</date><authorinitials>AlexRousskov</authorinitials></revision><revision><revnumber>13</revnumber><date>2009-09-12 11:13:13</date><authorinitials>AmosJeffries</authorinitials><revremark>document whats in the checklist and how to read it...</revremark></revision><revision><revnumber>12</revnumber><date>2009-09-12 10:52:31</date><authorinitials>AmosJeffries</authorinitials><revremark>attach updated current checklist document.</revremark></revision><revision><revnumber>11</revnumber><date>2009-03-27 07:13:31</date><authorinitials>AmosJeffries</authorinitials><revremark>add upgrade_http needs</revremark></revision><revision><revnumber>10</revnumber><date>2009-02-21 07:33:58</date><authorinitials>AmosJeffries</authorinitials><revremark>typos. link the checklist</revremark></revision><revision><revnumber>9</revnumber><date>2008-08-20 02:33:43</date><authorinitials>AmosJeffries</authorinitials><revremark>update whats been done.</revremark></revision><revision><revnumber>8</revnumber><date>2008-08-20 02:30:47</date><authorinitials>AmosJeffries</authorinitials><revremark>drop frpm wishlist to priority for 3.2</revremark></revision><revision><revnumber>7</revnumber><date>2008-08-18 06:19:43</date><authorinitials>AmosJeffries</authorinitials><revremark>NEEDED for Yahoo to help test</revremark></revision><revision><revnumber>6</revnumber><date>2008-05-18 19:38:55</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>5</revnumber><date>2008-03-07 23:37:31</date><authorinitials>AmosJeffries</authorinitials><revremark>Chunked Ecndogin is in 3.1 now via ChunkedEncodingParser.</revremark></revision><revision><revnumber>4</revnumber><date>2007-10-09 01:33:15</date><authorinitials>Henrik Nordström</authorinitials><revremark>Expanded.</revremark></revision><revision><revnumber>3</revnumber><date>2007-10-09 00:57:22</date><authorinitials>Henrik Nordström</authorinitials><revremark>Fixed my profile link</revremark></revision><revision><revnumber>2</revnumber><date>2007-10-09 00:53:29</date><authorinitials>Henrik Nordström</authorinitials><revremark>Cleaned up category tags.</revremark></revision><revision><revnumber>1</revnumber><date>2007-10-09 00:52:08</date><authorinitials>Henrik Nordström</authorinitials><revremark>Started HTTP/1.1 feature page.</revremark></revision></revhistory></articleinfo><section><title>Feature: HTTP/1.1 support</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: HTTP/1.1 RFC compliance </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: 90% compliant and counting. </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 3.2 </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: </para><itemizedlist><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7230#">7230</ulink> HTTP/1.1: Message Syntax and Routing </para><itemizedlist><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc2817#">2817</ulink> Upgrading to TLS Within HTTP/1.1 </para></listitem></itemizedlist></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7231#">7231</ulink> HTTP/1.1: Semantics and Content </para><itemizedlist><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7238#">7238</ulink> Status Code 308 (Permanent Redirect) </para></listitem></itemizedlist></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7232#">7232</ulink> HTTP/1.1: Conditional Requests </para></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7233#">7233</ulink> HTTP/1.1: Range Requests </para></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7234#">7234</ulink> HTTP/1.1: Caching </para></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc7235#">7235</ulink> HTTP/1.1: Authentication </para><itemizedlist><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc2617#">2617</ulink> Basic and Digest Access Authentication </para></listitem><listitem override="none"><para>RFC <ulink url="https://tools.ietf.org/rfc/rfc4559#">4559</ulink> SPNEGO-based Kerberos and NTLM HTTP Authentication </para></listitem></itemizedlist></listitem></itemizedlist></listitem></itemizedlist><section><title>Summary</title><para>Squid-3.2 claims HTTP/1.1 support. Squid v3.1 claims HTTP/1.1 support but only in sent requests (from Squid to servers). </para><para>Earlier Squid versions do not claim HTTP/1.1 support by default because they cannot fully handle Expect:100-continue, 1xx responses, and/or chunked messages.  </para><para>Co-Advisor tests no longer detect RFC MUST-level violations in Squid trunk when it comes to requirements unrelated to caching. Many caching-related requirements are still violated. The &quot;compliance percentage&quot; in the project header is essentially a marketing gimmick (i.e., meaningless or misleading but technically correct information). We are actively working on fixing all known violations detected by Co-Advisor. </para><section><title>Checklist</title><para>Squid v4+ compliance with RFC MUST-level requirements as of August 2018: <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Features/HTTP11?action=AttachFile&amp;do=get&amp;target=HTTP-1.1-Checklist_2018-08-09.ods">HTTP-1.1-Checklist_2018-08-09.ods</ulink>. </para><para>Squid v3 and v2 results collected in August 2013: <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Features/HTTP11?action=AttachFile&amp;do=get&amp;target=HTTP-1.1-Checklist_2013-08-21.ods">HTTP-1.1-Checklist_2013-08-21.ods</ulink>. </para><para>The linked document contains the results of automated Co-Advisor HTTP/1.1 compliance tests for several Squid versions. Each test consists of almost 900 individual test cases, targeting various MUSTs in RFC 2616 and 7230-7235. Each Squid v3+ column summarizes the results of several tests. These tests were identical from HTTP point of view. If a given test case showed different results during those tests, the exact test case outcome could not be determined. Such outcomes are marked with a letter 'U'. All other markings correspond to stable results. Some test cases fail due to lack of an HTTP/1.1 feature support in Squid, incompatibility with the test suite, a test suite bug, or other reasons. Such test cases are marked with question marks. The remaining test case outcomes are successes and violations. Only successful outcomes count towards the &quot;test cases passed&quot; percentage. </para><para>The tests are on vanilla Squid with no special alterations made during build.  The 2.7 test appears to have been done with the configurable HTTP/1.1 advertisement to Servers turned on. </para></section></section><section><title>Compliance</title><para>The following compliance notes apply to <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Squid-3.2#">Squid-3.2</ulink> and later. Older Squid did not even conditionally comply with HTTP/1.1. </para><section><title>Message Syntax and Routing</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7230#">7230</ulink> </para><orderedlist numeration="arabic"><listitem><para>HTTP/1.1 requires that we upgrade to our highest supported version. This has been found problematic with certain broken clients and servers. </para><itemizedlist><listitem><para>NP: ICY protocol seems to be the main breakage. So ICY support has been implemented natively to fix this. </para></listitem><listitem><para>NP: Sharepoint and several other MS products break with authentication loops when different HTTP/1.x versions are advertised on server and client side (as seen with <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Squid-3.1#">Squid-3.1</ulink>). This is resolved with <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Squid-3.2#">Squid-3.2</ulink> advertising HTTP/1.1 in both sides. </para></listitem></itemizedlist></listitem><listitem><para>HTTP/1.1 requires support for chunked encoding in both parsers and composers. This applies to both responses and requests. </para><itemizedlist><listitem><para>Both Squid-3 and Squid-2 contain at least response chunked decoding. The chunked encoding portion is available from <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Squid-3.2#">Squid-3.2</ulink> on all traffic except CONNECT requests. </para></listitem><listitem><para>Squid is missing support for chunked encoding trailers. </para></listitem><listitem><para>Squid is missing support for deflate and gzip transfer encodings. </para></listitem><listitem><para>Squid is missing support for HTTP message Trailers. </para></listitem></itemizedlist></listitem></orderedlist><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc2817#">2817</ulink> </para><orderedlist numeration="arabic"><listitem><para>Squid is conditionally compliant with this feature. Always ignores the header content and ensures <emphasis role="strong">Upgrade</emphasis> header is dropped safely. </para></listitem><listitem><para>Squid with <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Features/SslBump#">ssl-bump</ulink> feature enabled will attempt to upgrade CONNECT requests to TLS regardless of the presence of Upgrade headers. </para></listitem></orderedlist></section><section><title>Semantics and Content</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7231#">7231</ulink> </para><orderedlist numeration="arabic"><listitem><para>The forwarding path needs to be cleaned up to better separate HTTP messages and actual content, allowing for proper forwarding of 1xx responses. 1xx forwarding has been implemented in <ulink url="https://wiki.squid-cache.org/Features/HTTP11/Squid-3.2#">Squid-3.2</ulink> but the forwarding path still needs further work to make this efficient. </para><itemizedlist><listitem><para>This is likely to touch the store API as today all messages go via the store, even if just an interim 1xx response. </para></listitem></itemizedlist></listitem></orderedlist><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7238#">7238</ulink> </para><itemizedlist><listitem><para>Squid is fully compliant with this specification. </para></listitem></itemizedlist></section><section><title>Conditional Requests</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7232#">7232</ulink> </para><itemizedlist><listitem><para>Squid is missing support for <emphasis role="strong">If-Unmodified-Since</emphasis> validation. </para></listitem><listitem><para>Missing <emphasis role="strong">If-None-Match</emphasis> header creation on revalidation requests </para></listitem></itemizedlist></section><section><title>Range Requests</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7233#">7233</ulink> </para><itemizedlist><listitem><para>Squid is unable to store range requests and is currently limited to converting the request into a full request or passing it on unaltered to the backend server. </para><itemizedlist><listitem><para>We need to implement storage to allow for partial range storage. </para></listitem><listitem><para>There are also a handful of bugs in the existing range handling which need to be resolved. </para></listitem></itemizedlist></listitem></itemizedlist></section><section><title>Caching</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7234#">7234</ulink> </para><itemizedlist><listitem><para>Many caching-related requirements are still violated. see Co-Advisor checklist. </para></listitem></itemizedlist></section><section><title>Authentication</title><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc7235#">7235</ulink> </para><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc2617#">2617</ulink> </para><itemizedlist><listitem><para>Squid fully supports Basic authentication. </para></listitem><listitem><para>There are outstanding bugs in minimal Digest authentication behaviour. </para></listitem><listitem><para>Squid is missing support for Digest auth-int authentication mode. </para></listitem></itemizedlist><para>Specification Document: RFC <ulink url="https://tools.ietf.org/rfc/rfc4559#">4559</ulink> </para><itemizedlist><listitem><para>Squid fully supports Negotiate/Kerberos authentication. </para><itemizedlist><listitem override="none"><para>- Squid will additionally generate <emphasis role="strong">Connection:Proxy-Support</emphasis> header to enforce semantics when chained. - Squid additionally supports Negotiate for Proxy-Auth. </para></listitem></itemizedlist></listitem><listitem><para>There are outstanding bugs in the NTLM and Negotiate/NTLM implementation. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/HTTP11/CategoryFeature#">CategoryFeature</ulink> </para></section></section></section></article>