<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/CustomErrors</title><revhistory><revision><revnumber>13</revnumber><date>2018-04-19 13:29:30</date><authorinitials>AmosJeffries</authorinitials><revremark>update links and use &quot;macro codes&quot; instead of &quot;tags&quot; to describe the expanded %strings.</revremark></revision><revision><revnumber>12</revnumber><date>2016-08-08 13:49:30</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>11</revnumber><date>2012-08-02 09:22:53</date><authorinitials>AmosJeffries</authorinitials><revremark>3.2 got stuck with the error-page codes.</revremark></revision><revision><revnumber>10</revnumber><date>2011-09-20 17:30:36</date><authorinitials>AlexRousskov</authorinitials><revremark>Polished %D documentation.</revremark></revision><revision><revnumber>9</revnumber><date>2011-09-20 17:27:38</date><authorinitials>AlexRousskov</authorinitials><revremark>Documented %x format code</revremark></revision><revision><revnumber>8</revnumber><date>2011-08-28 05:21:38</date><authorinitials>AmosJeffries</authorinitials><revremark>document Z better. and tweak the page layout a little</revremark></revision><revision><revnumber>7</revnumber><date>2011-03-11 17:04:58</date><authorinitials>AlexRousskov</authorinitials><revremark>Documented %D error page code.</revremark></revision><revision><revnumber>6</revnumber><date>2010-11-17 04:51:06</date><authorinitials>AmosJeffries</authorinitials><revremark>we have decided to change the deny_info logformat codes. hide these docs until they can be corrected</revremark></revision><revision><revnumber>5</revnumber><date>2010-08-14 04:51:22</date><authorinitials>AmosJeffries</authorinitials><revremark>document the deny_info accepted template codes.</revremark></revision><revision><revnumber>4</revnumber><date>2010-06-15 02:42:11</date><authorinitials>AmosJeffries</authorinitials><revremark>disabiguate the %I and %l codes.</revremark></revision><revision><revnumber>3</revnumber><date>2009-04-12 01:58:03</date><authorinitials>AmosJeffries</authorinitials><revremark>reduce the confusion on where and what these % codes are for.</revremark></revision><revision><revnumber>2</revnumber><date>2009-03-24 09:27:49</date><authorinitials>AmosJeffries</authorinitials><revremark>correct formatting on error codes list</revremark></revision><revision><revnumber>1</revnumber><date>2008-11-27 22:19:55</date><authorinitials>AmosJeffries</authorinitials><revremark>import from general FAQ</revremark></revision></revhistory></articleinfo><section><title>Feature: Customizable Error Message</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: To alter the error pages layouts and content generated by Squid. </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: complete. </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 2.1 </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: Unknown. </para></listitem></itemizedlist><itemizedlist><listitem override="none"/></itemizedlist></section><section><title>Details</title><para>Squid lets you customize your error messages. The source distribution includes error messages in different languages. </para><para><emphasis role="strong">From Squid 3.1:</emphasis> </para><itemizedlist><listitem><para>CSS hooks are available for display redesign and coloring. </para></listitem><listitem><para>Language translations are done by default automatically when language pages are installed. </para></listitem></itemizedlist><para>see <ulink url="https://wiki.squid-cache.org/Features/CustomErrors/Translations#">Translations Project</ulink> for more details on those. </para><para>For older Squid you can select the language with the configure option <emphasis>--enable-err-language=lang</emphasis>. </para><para>If needed, you can make a copy and re-write the error message template files in any version. </para><section><title>deny_info URL codes for embedding</title><para><emphasis role="strong">Squid-2.1 to <ulink url="https://wiki.squid-cache.org/Features/CustomErrors/Squid-3.1#">Squid-3.1</ulink> only provide this macro code:</emphasis> </para><glosslist><glossentry><glossterm>%s</glossterm><glossdef><para>Absolute URL requested by client </para></glossdef></glossentry></glosslist><para><emphasis role="strong"><ulink url="https://wiki.squid-cache.org/Features/CustomErrors/Squid-3.2#">Squid-3.2</ulink> adds URL templating codes:</emphasis> </para><glosslist><glossentry><glossterm>%a</glossterm><glossdef><para>User identity </para></glossdef></glossentry><glossentry><glossterm>%d</glossterm><glossdef><para>seconds elapsed since request received (not yet implemented) </para></glossdef></glossentry><glossentry><glossterm>%e</glossterm><glossdef><para>errno </para></glossdef></glossentry><glossentry><glossterm>%E</glossterm><glossdef><para>strerror() </para></glossdef></glossentry><glossentry><glossterm>%h</glossterm><glossdef><para>Squid public hostname </para></glossdef></glossentry><glossentry><glossterm>%H</glossterm><glossdef><para>server host name </para></glossdef></glossentry><glossentry><glossterm>%i</glossterm><glossdef><para>client IP address </para></glossdef></glossentry><glossentry><glossterm>%I</glossterm><glossdef><para>server IP address (NP: upper case <emphasis role="strong">i</emphasis>) </para></glossdef></glossentry><glossentry><glossterm>%M</glossterm><glossdef><para>Request Method </para></glossdef></glossentry><glossentry><glossterm>%o</glossterm><glossdef><para>Message returned by external ACL helper </para></glossdef></glossentry><glossentry><glossterm>%p</glossterm><glossdef><para>URL port \# </para></glossdef></glossentry><glossentry><glossterm>%P</glossterm><glossdef><para>Protocol </para></glossdef></glossentry><glossentry><glossterm>%R</glossterm><glossdef><para>URL path requested. </para></glossdef></glossentry><glossentry><glossterm>%S</glossterm><glossdef><para>Squid version signature. </para></glossdef></glossentry><glossentry><glossterm>%s</glossterm><glossdef><para>Absolute URL requested by client </para></glossdef></glossentry><glossentry><glossterm>%t</glossterm><glossdef><para>local time </para></glossdef></glossentry><glossentry><glossterm>%T</glossterm><glossdef><para>UTC </para></glossdef></glossentry><glossentry><glossterm>%U</glossterm><glossdef><para>Absolute URL without password. Uses * instead of path for CONNECT requests. </para></glossdef></glossentry><glossentry><glossterm>%u</glossterm><glossdef><para>Absolute URL with password. May be missing path on CONNECT requests. </para></glossdef></glossentry><glossentry><glossterm>%w</glossterm><glossdef><para>cachemgr email address </para></glossdef></glossentry></glosslist></section><section><title>ERR_* template codes for embedding</title><para>This list describes the macro codes which Squid will replace in the error response messages, and what details will be inserted: </para><glosslist><glossentry><glossterm>%a</glossterm><glossdef><para>User identity </para></glossdef></glossentry><glossentry><glossterm>%B</glossterm><glossdef><para>URL with FTP %2f hack </para></glossdef></glossentry><glossentry><glossterm>%c</glossterm><glossdef><para>Squid error code </para></glossdef></glossentry><glossentry><glossterm>%d</glossterm><glossdef><para>seconds elapsed since request received (not yet implemented) </para></glossdef></glossentry><glossentry><glossterm>%D</glossterm><glossdef><para>Squid-generated error details. May contain other error page formatting codes. Currently only TLS/SSL connection failures are detailed. For example, %D in a customized <emphasis>ERR_SECURE_CONNECT_FAIL</emphasis> response may be expanded into &quot;The host name you are connecting to (foo.com) does not match any of the certificate names (foo.org, foo.net)...&quot;). Supported since <ulink url="https://wiki.squid-cache.org/Features/CustomErrors/Squid-3.2#">Squid-3.2</ulink>. See also: application-level error code (%x) and system level error code/detail (%e/%E). </para></glossdef></glossentry><glossentry><glossterm>%e</glossterm><glossdef><para>errno </para></glossdef></glossentry><glossentry><glossterm>%E</glossterm><glossdef><para>strerror() </para></glossdef></glossentry><glossentry><glossterm>%f</glossterm><glossdef><para>FTP request line </para></glossdef></glossentry><glossentry><glossterm>%F</glossterm><glossdef><para>FTP reply line </para></glossdef></glossentry><glossentry><glossterm>%g</glossterm><glossdef><para>FTP server message </para></glossdef></glossentry><glossentry><glossterm>%h</glossterm><glossdef><para>cache hostname </para></glossdef></glossentry><glossentry><glossterm>%H</glossterm><glossdef><para>server host name </para></glossdef></glossentry><glossentry><glossterm>%i</glossterm><glossdef><para>client IP address </para></glossdef></glossentry><glossentry><glossterm>%I</glossterm><glossdef><para>server IP address (NP: upper case <emphasis role="strong">i</emphasis>) </para></glossdef></glossentry><glossentry><glossterm>%l</glossterm><glossdef><para>Local site CSS stylesheet. (Squid-3.1 and later) (NP: lower case <emphasis role="strong">L</emphasis>) </para></glossdef></glossentry><glossentry><glossterm>%L</glossterm><glossdef><para>contents of <emphasis role="strong">err_html_text</emphasis> config option </para></glossdef></glossentry><glossentry><glossterm>%M</glossterm><glossdef><para>Request Method </para></glossdef></glossentry><glossentry><glossterm>%m</glossterm><glossdef><para>Error message returned by external auth helper </para></glossdef></glossentry><glossentry><glossterm>%o</glossterm><glossdef><para>Message returned by external acl helper </para></glossdef></glossentry><glossentry><glossterm>%p</glossterm><glossdef><para>URL port \# </para></glossdef></glossentry><glossentry><glossterm>%P</glossterm><glossdef><para>Protocol </para></glossdef></glossentry><glossentry><glossterm>%R</glossterm><glossdef><para>Full HTTP Request </para></glossdef></glossentry><glossentry><glossterm>%S</glossterm><glossdef><para>squid default signature. (Squid prior to 3.1 automatically add unless %s is used.) </para></glossdef></glossentry><glossentry><glossterm>%s</glossterm><glossdef><para>caching proxy software with version </para></glossdef></glossentry><glossentry><glossterm>%t</glossterm><glossdef><para>local time </para></glossdef></glossentry><glossentry><glossterm>%T</glossterm><glossdef><para>UTC </para></glossdef></glossentry><glossentry><glossterm>%U</glossterm><glossdef><para>URL without password </para></glossdef></glossentry><glossentry><glossterm>%u</glossterm><glossdef><para>URL with password. (Squid-2.5 and later only.) </para></glossdef></glossentry><glossentry><glossterm>%W</glossterm><glossdef><para>Extended error page data URL-encoded for mailto links. </para></glossdef></glossentry><glossentry><glossterm>%w</glossterm><glossdef><para>cachemgr email address </para></glossdef></glossentry><glossentry><glossterm>%x</glossterm><glossdef><para>Application-level error name or identifier (e.g., X509_V_ERR_UNABLE_TO_GET_CRL). Currently only supported for SSL certificate validation errors. See also: system-level error code/detail (%e/%E) and application-level error detail (%D). </para></glossdef></glossentry><glossentry><glossterm>%z</glossterm><glossdef><para>DNS server error message </para></glossdef></glossentry><glossentry><glossterm>%Z</glossterm><glossdef><para>Message generated during the process which failed. May be ASCII-formatted. Use within HTML PRE tags. </para></glossdef></glossentry></glosslist></section></section><section><title>Troubleshooting</title><section><title>Custom error pages not displayed for HTTPS</title><para>HTTPS uses HTTP CONNECT messages to relay through a proxy. Due to browser behaviour handling these CONNECT messages (described in <ulink url="https://bugzilla.mozilla.org/show_bug.cgi?id=479880"/>) any custom error page produced by the proxy is ignored and a generic browser page displayed instead. </para><para>Usually this browser page mentions connection faulure or other such irrelevant details. </para><para>In fact any response other than <emphasis role="strong">200 OK</emphasis> is completely dropped by the browser and the same browser template page displayed. This can lead to some very weird authentication problems when using HTTPS through an authenticated proxy as well for authentication schemes where the 407 message body has relevance. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/CustomErrors/CategoryFeature#">CategoryFeature</ulink> </para></section></section></article>