<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/LogFormat</title><revhistory><revision><revnumber>7</revnumber><date>2015-02-13 01:37:42</date><authorinitials>AmosJeffries</authorinitials><revremark>wiki links, update username field documentation</revremark></revision><revision><revnumber>6</revnumber><date>2014-03-09 05:26:43</date><authorinitials>AlexRousskov</authorinitials><revremark>Fixed Hierarchy_Codes link.</revremark></revision><revision><revnumber>5</revnumber><date>2014-02-26 15:47:11</date><authorinitials>AlexRousskov</authorinitials><revremark>Documented what time the &quot;time&quot; field contains.</revremark></revision><revision><revnumber>4</revnumber><date>2013-02-09 09:09:19</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>3</revnumber><date>2010-06-10 03:15:21</date><authorinitials>AmosJeffries</authorinitials><revremark>comment typo</revremark></revision><revision><revnumber>2</revnumber><date>2010-06-10 03:14:31</date><authorinitials>AmosJeffries</authorinitials><revremark>shuffle logformat information from FAQ.</revremark></revision><revision><revnumber>1</revnumber><date>2009-04-17 11:39:30</date><authorinitials>AmosJeffries</authorinitials><revremark>create from code.</revremark></revision></revhistory></articleinfo><section><title>Feature: Customizable Log Formats</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: To allow users to define their own log content. </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: complete. </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 2.6 and later </para></listitem></itemizedlist></section><section><title>Details</title></section><section><title>Configuration Options</title><para><ulink url="http://www.squid-cache.org/Doc/config/logformat#">logformat</ulink> option in squid.conf defines a named format for log output. </para><para><ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink> option then uses the named format to write a given log file with its output about each request in that format. </para><section><title>Default Formats</title><para>The default formats are built-in to squid and do not need to be defined manually. They can be used simply by specifying the default format name on <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink> lines. </para><section><title>squid</title><para>The native format for Squid </para><para>The format is: </para><screen><![CDATA[time elapsed remotehost code/status bytes method URL rfc931 peerstatus/peerhost type]]></screen><para>The native log file format logs more and different information than the common log file format: the request duration, some timeout information, the next upstream server address, and the content type. </para><para>There exist tools, which convert one file format into the other. Please mind that even though the log formats share most information, both formats contain information which is not part of the other format, and thus this part of the information is lost when converting. Especially converting back and forth is not possible without loss. </para><para><emphasis>squid2common.pl</emphasis> is a conversion utility, which converts any of the squid log file formats into the old CERN proxy style output. There exist tools to analyse, evaluate and graph results from that format. </para></section><section><title>common</title><para>The <ulink url="http://www.w3.org/Daemon/User/Config/Logging.html#common-logfile-format">Common Logfile Format</ulink> is used by numerous HTTP servers. This format consists of the following seven fields: </para><screen><![CDATA[remotehost rfc931 authuser [date] "method URL" status bytes]]></screen><para>It is parsable by a variety of tools. The common format contains different information than the native log file format. The HTTP version is logged, which is not logged in native log file format. </para></section></section></section><section><title>Squid native access.log format in detail</title><para>We recommend that you use Squid's native log format due to its greater amount of information made available for later analysis. The print format line for native <emphasis>access.log</emphasis> entries looks like this: </para><screen><![CDATA["%9d.%03d %6d %s %s/%03d %d %s %s %s %s%s/%s %s"]]></screen><para>Therefore, an <emphasis>access.log</emphasis> entry usually consists of (at least) 10 columns separated by one ore more spaces: </para><orderedlist numeration="arabic"><listitem><para><emphasis role="strong">time</emphasis> A Unix timestamp as UTC seconds with a millisecond resolution. This is the time when Squid started to log the transaction, which normally happens at the end of a transaction lifecycle, after the entire request was received from and the entire response was sent to the HTTP client. To get the approximate transaction start time, subtract transaction duration (the second field) from this field, minding the different time units of those two fields.</para><para>You can convert Unix timestamps into something more human readable using this short perl script: </para><itemizedlist><listitem override="none"><screen><![CDATA[s/^\d+\.\d+/localtime $&/e;]]></screen></listitem></itemizedlist></listitem><listitem><para><emphasis role="strong">duration</emphasis> The elapsed time considers how many milliseconds the transaction busied the cache. It differs in interpretation between TCP and UDP: </para><itemizedlist><listitem><para>For HTTP this is basically the time from having received the request to when Squid finishes sending the last byte of the response. </para></listitem><listitem><para>For ICP, this is the time between scheduling a reply and actually sending it. </para></listitem><listitem><para>Please note that the entries are logged <emphasis>after</emphasis> the reply finished being sent, <emphasis>not</emphasis> during the lifetime of the transaction. </para></listitem></itemizedlist></listitem><listitem><para><emphasis role="strong">client address</emphasis> The IP address of the requesting instance, the client IP address. The <ulink url="http://www.squid-cache.org/Doc/config/client_netmask#">client_netmask</ulink> configuration option can distort the clients for data protection reasons, but it makes analysis more difficult. Often it is better to use one of the log file anonymizers. </para></listitem><listitem><para><emphasis role="strong">result codes</emphasis> This column is made up of two entries separated by a slash. This column encodes the transaction result: </para><itemizedlist><listitem override="none"><para>The cache result of the request contains information on the kind of request, how it was satisfied, or in what way it failed. Please refer to <link linkend="squid_result_codes">Squid result codes</link> for valid symbolic result codes. Several codes from older versions are no longer available, were renamed, or split. Especially the <emphasis>ERR_</emphasis> codes do not seem to appear in the log file any more. Also refer to <link linkend="squid_result_codes">Squid result codes</link> for details on the codes no longer available. The status part contains the HTTP result codes with some Squid specific extensions. Squid uses a subset of the RFC defined error codes for HTTP. Refer to section <link linkend="http_status_codes">status codes</link> for details of the status codes recognized. </para></listitem></itemizedlist></listitem><listitem><para><emphasis role="strong">bytes</emphasis> The size is the amount of data delivered to the client. Mind that this does not constitute the net object size, as headers are also counted. Also, failed requests may deliver an error page, the size of which is also logged here. </para></listitem><listitem><para><emphasis role="strong">request method</emphasis> The request method to obtain an object. Please refer to section <link linkend="request-methods">request-methods</link> for available methods. If you turned off <ulink url="http://www.squid-cache.org/Doc/config/log_icp_queries#">log_icp_queries</ulink> in your configuration, you will not see (and thus unable to analyze) ICP exchanges. The <emphasis>PURGE</emphasis> method is only available, if you have an ACL for &quot;method purge&quot; enabled in your configuration file. </para></listitem><listitem><para><emphasis role="strong">URL</emphasis> This column contains the URL requested. Please note that the log file may contain whitespace for the URI. The default configuration for <ulink url="http://www.squid-cache.org/Doc/config/uri_whitespace#">uri_whitespace</ulink> denies or truncates whitespace, though. </para></listitem><listitem><para><emphasis role="strong">user</emphasis> The eighth column may contain the user identity for the requesting client. This may be sourced from one of HTTP authentication, an external ACL helper, TLS authentication, or IDENT lookup (RFC <ulink url="https://tools.ietf.org/rfc/rfc931#">931</ulink>) - checked in that order with the first to present information displayed. If no user identity is available a &quot;-&quot; will be logged. </para></listitem><listitem><para><emphasis role="strong">hierarchy code</emphasis> The hierarchy information consists of three items: </para><itemizedlist><listitem><para>Any hierarchy tag may be prefixed with <emphasis>TIMEOUT_</emphasis>, if the timeout occurs waiting for all ICP replies to return from the neighbours. The timeout is either dynamic, if the <ulink url="http://www.squid-cache.org/Doc/config/icp_query_timeout#">icp_query_timeout</ulink> was not set, or the time configured there has run up. </para></listitem><listitem><para>A code that explains how the request was handled, e.g. by forwarding it to a peer, or going straight to the source. Refer to <ulink url="https://wiki.squid-cache.org/Features/LogFormat/SquidFaq/SquidLogs#Hierarchy_Codes">Hierarchy Codes</ulink> for details on hierarchy codes and removed hierarchy codes. </para></listitem><listitem><para>The IP address or hostname where the request (if a miss) was forwarded. For requests sent to origin servers, this is the origin server's IP address. For requests sent to a neighbor cache, this is the neighbor's hostname. NOTE: older versions of Squid would put the origin server hostname here. </para></listitem></itemizedlist></listitem><listitem><para><emphasis role="strong">type</emphasis> The content type of the object as seen in the HTTP reply header. Please note that ICP exchanges usually don't have any content type, and thus are logged &quot;-&quot;. Also, some weird replies have content types &quot;:&quot; or even empty ones. </para></listitem></orderedlist><para>There may be two more columns in the <emphasis>access.log</emphasis>, if the (debug) option <ulink url="http://www.squid-cache.org/Doc/config/log_mime_headers#">log_mime_headers</ulink> is enabled In this case, the HTTP request headers are logged between a &quot;<code>[&quot; and a &quot;</code>]&quot;, and the HTTP reply headers are also logged between &quot;<code>[&quot; and &quot;</code>]&quot;. All control characters like CR and LF are URL-escaped, but spaces are <emphasis>not</emphasis> escaped! Parsers should watch out for this. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/LogFormat/CategoryFeature#">CategoryFeature</ulink> </para></section></article>