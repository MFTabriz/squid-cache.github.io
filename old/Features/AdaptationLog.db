<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/AdaptationLog</title><revhistory><revision><revnumber>11</revnumber><date>2010-10-28 11:48:04</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fixed for features-listing</revremark></revision><revision><revnumber>10</revnumber><date>2010-10-28 09:10:58</date><authorinitials>FrancescoChemolli</authorinitials><revremark>added faq-listing</revremark></revision><revision><revnumber>9</revnumber><date>2010-10-28 07:56:04</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fixed  features-listing</revremark></revision><revision><revnumber>8</revnumber><date>2010-03-29 15:19:07</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Changed text to be picked up in Features/ page</revremark></revision><revision><revnumber>7</revnumber><date>2009-07-19 04:49:24</date><authorinitials>AmosJeffries</authorinitials><revremark>merged for 3.1.0.11 - TODO correct the documentation here.</revremark></revision><revision><revnumber>6</revnumber><date>2009-04-08 21:09:55</date><authorinitials>AlexRousskov</authorinitials><revremark>Documented adaptation_xact_times code</revremark></revision><revision><revnumber>5</revnumber><date>2009-04-08 20:44:40</date><authorinitials>AlexRousskov</authorinitials><revremark>Documented new format codes</revremark></revision><revision><revnumber>4</revnumber><date>2009-04-08 18:25:31</date><authorinitials>AlexRousskov</authorinitials><revremark>Use srtandard status prefix</revremark></revision><revision><revnumber>3</revnumber><date>2009-04-08 15:55:44</date><authorinitials>AlexRousskov</authorinitials><revremark>Updated status. Pointed to the lp branch that is closer to recent v3.0 releases.</revremark></revision><revision><revnumber>2</revnumber><date>2008-10-09 21:24:40</date><authorinitials>AlexRousskov</authorinitials><revremark>added a link to lp branch for v3.0 work</revremark></revision><revision><revnumber>1</revnumber><date>2008-10-09 20:58:26</date><authorinitials>AlexRousskov</authorinitials><revremark>initial documentation</revremark></revision></revhistory></articleinfo><section><title>Feature: Adaptation logging</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: Log ICAP and eCAP transaction details </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: complete </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 3.1 </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: <ulink url="https://wiki.squid-cache.org/Features/AdaptationLog/AlexRousskov#">AlexRousskov</ulink>, Christos Tsantilas </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: <ulink url="https://code.launchpad.net/~rousskov/squid/3p0-plus">v3.0 branch</ulink> </para></listitem></itemizedlist></section><section><title>Details</title><para>HTTP transactions have access.log. ICAP and eCAP transactions need their own log. Also, HTTP transactions affected by adaptations may need to log adaptation-related details in access.log. </para><para>ICAP log uses <emphasis>logformat</emphasis> codes that make sense for an ICAP transaction. Header-related codes are applied to the HTTP header embedded in an ICAP server response, with the following caveats: For REQMOD, there is no HTTP response header unless the ICAP server performed request satisfaction. For RESPMOD, the HTTP request header is the header sent to the ICAP server. For OPTIONS, there are no HTTP headers. </para><para>In addition to old <emphasis>logformat</emphasis> codes, the following format codes are also available for ICAP logs: </para><screen><![CDATA[        <icap_A         ICAP server IP address. Similar to <A.
]]><![CDATA[
        <icap_service_name      ICAP service name from the icap_service
                        option in Squid configuration file.
]]><![CDATA[
        icap_ru         ICAP Request-URI. Similar to ru.
]]><![CDATA[
        icap_rm         ICAP request method (REQMOD, RESPMOD, or 
                        OPTIONS). Similar to existing rm.
]]><![CDATA[
        >icap_size      Bytes sent to the ICAP server (TCP payload
                        only; i.e., what Squid writes to the socket).
]]><![CDATA[
        <icap_size      Bytes received from the ICAP server (TCP
                        payload only; i.e., what Squid reads from
                        the socket).
]]><![CDATA[
        icap_tr         Transaction response time (in
                        milliseconds).  The timer starts when
                        the ICAP transaction is created and
                        stops when the transaction is completed.
                        Similar to tr.
]]><![CDATA[
        icap_tio        Transaction I/O time (in milliseconds). The
                        timer starts when the first ICAP request
                        byte is scheduled for sending. The timers
                        stops when the last byte of the ICAP response
                        is received.
]]><![CDATA[
        icap_to         Transaction outcome: ICAP_ERR* for all
                        transaction errors, ICAP_OPT for OPTION
                        transactions, ICAP_ECHO for 204
                        responses, ICAP_MOD for message
                        modification, and ICAP_SAT for request
                        satisfaction. Similar to Ss.
]]><![CDATA[
        icap_Hs         ICAP response status code. Similar to Hs.
]]><![CDATA[
        >icap_h         ICAP request header(s). Similar to >h.
]]><![CDATA[
        <icap_h         ICAP response header(s). Similar to <h.Adaptation log fields include:]]></screen><para>If ICAP is enabled, the following two codes become available for access.log: </para><screen><![CDATA[        icap_total_time Total ICAP processing time for the HTTP
                        transaction. The timer ticks when ICAP
                        ACLs are checked and when ICAP
                        transaction is in progress.
]]><![CDATA[
        <icap_last_h    The header of the last ICAP response
                        related to the HTTP transaction. Like
                        <h, accepts an optional header name
                        argument.  Will not change semantics
                        when multiple ICAP transactions per HTTP
                        transaction are supported.
]]><![CDATA[
        adaptation_xact_times  A comma-separated list of individual
                        related adaptation transactions response times,
                        in milliseconds. The order is to be defined
                        during implementation.]]></screen><para>Please see <emphasis>squid.conf.documented</emphasis> for more details. </para></section><section><title>Availability</title><para>Most of the features described here are unofficially available for Squid v3.0 as a Launchpad <ulink url="https://code.launchpad.net/~rousskov/squid/3p0-plus">branch</ulink>. Adaptation logging features are committed to Squid and scheduled for v3.1.0.11 release. </para><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/AdaptationLog/CategoryFeature#">CategoryFeature</ulink> </para></section></article>