<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/Quota</title><revhistory><revision><revnumber>9</revnumber><date>2015-08-31 09:03:37</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fix link to bugzilla.</revremark></revision><revision><revnumber>8</revnumber><date>2011-09-22 03:04:28</date><authorinitials>AmosJeffries</authorinitials><revremark>add mention of the time quota helpers added recently. a opposed to bandwidth quotas</revremark></revision><revision><revnumber>7</revnumber><date>2010-03-31 22:41:45</date><authorinitials>AmosJeffries</authorinitials><revremark>updated progress.</revremark></revision><revision><revnumber>6</revnumber><date>2009-04-29 14:26:31</date><authorinitials>AmosJeffries</authorinitials><revremark>there was a bug about this. describes the specs fairly well for one specific case of policy.</revremark></revision><revision><revnumber>5</revnumber><date>2009-03-31 22:12:36</date><authorinitials>AlexRousskov</authorinitials><revremark>Polished, added a squid-dev link, added a traffic shaping paragraph.</revremark></revision><revision><revnumber>4</revnumber><date>2008-05-18 19:38:55</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>3</revnumber><date>2008-04-22 00:37:16</date><authorinitials>AmosJeffries</authorinitials><revremark>bump to unknown version. Hopefully someone will pick this up.</revremark></revision><revision><revnumber>2</revnumber><date>2007-12-27 12:40:43</date><authorinitials>Henrik Nordström</authorinitials></revision><revision><revnumber>1</revnumber><date>2007-12-27 12:37:07</date><authorinitials>Henrik Nordström</authorinitials></revision></revhistory></articleinfo><section><title>Feature: Quota control</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: Better quota controls </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: <emphasis>Not started</emphasis> </para></listitem><listitem><para><emphasis role="strong">ETA</emphasis>: <emphasis>unknown</emphasis> </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: Squid 3.2 or 3.3 </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>:  </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: <ulink url="http://www.squid-cache.org/mail-archive/squid-dev/200902/0138.html">squid-dev thread</ulink> </para></listitem><listitem><para><emphasis role="strong">Related Bugs</emphasis>: </para><itemizedlist><listitem override="none"><para><ulink url="https://bugs.squid-cache.org/show_bug.cgi?id=1849#">1849</ulink> (policy helper feature) </para></listitem></itemizedlist></listitem></itemizedlist><section><title>Description</title><para>Squid needs better interface to control quotas. The existing approaches to quota control require the use of external ACLs or redirectors. The external helpers are only contacted at the start of the request and need to work with information given only at the end of the request. Due to these limitations, users may go significantly over their quota before Squid reacts. </para><section><title>Bandwidth Quotas</title><para>The external helpers need to process access.log to calculate the bandwidth usage. Which limits accuracy in the worst-case with large and long duration requests. </para><para>Also, external helpers cannot do traffic shaping (i.e., slowing down the transfer instead of denying the request). It is not yet clear whether a single interface should serve both purposes. </para><para><emphasis role="strong">Update:</emphasis> </para><itemizedlist><listitem override="none"><para>With TCP logging a helper can be written to account log information live and maintain any external accounting or traffic needed to maintain quota limits. An internal accounting pool is still needed per client to maintain limits on active requests. </para></listitem></itemizedlist></section><section><title>Time Quotas</title><para>The external helpers need to process permission at the start of the request based on relation to earlier requests. Duration of the requests themselves are not accounted. Long-polling in particular (such as chat sessions over HTTP) may bypass the quota controls. </para><itemizedlist><listitem><para>The <code>ext_session_acl</code> helper version 1.1 adds support for fixed-length sessions. Emulating a time quota within which new requests may be made. Long requests may continue outside this period, but no new requests may start without a new session being permitted. </para></listitem><listitem><para>ext_time_quota_acl helper added with <ulink url="https://wiki.squid-cache.org/Features/Quota/Squid-3.3#">Squid-3.3</ulink> allows an allocated period of time which is consumed as requests are made. Configurable long periods with no requests can be eliminated from the consumption. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/Quota/CategoryFeature#">CategoryFeature</ulink> <ulink url="https://wiki.squid-cache.org/Features/Quota/CategoryWish#">CategoryWish</ulink> </para></section></section></section></article>