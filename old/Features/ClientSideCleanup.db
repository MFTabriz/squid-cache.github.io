<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/ClientSideCleanup</title><revhistory><revision><revnumber>6</revnumber><date>2013-10-26 05:24:50</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Removed dangling wikilins</revremark></revision><revision><revnumber>5</revnumber><date>2013-05-05 16:13:17</date><authorinitials>AmosJeffries</authorinitials><revremark>.</revremark></revision><revision><revnumber>4</revnumber><date>2013-05-05 16:00:11</date><authorinitials>AmosJeffries</authorinitials><revremark>progress update, this has been started loosely already in 3.4.</revremark></revision><revision><revnumber>3</revnumber><date>2008-05-18 19:38:58</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>2</revnumber><date>2008-04-20 16:41:26</date><authorinitials>AlexRousskov</authorinitials><revremark>This is a wish because it lacks the developer committed to implementing the feature.</revremark></revision><revision><revnumber>1</revnumber><date>2008-04-20 16:27:08</date><authorinitials>AlexRousskov</authorinitials><revremark>Adding client-side cleanup to Squid3 roadmap</revremark></revision></revhistory></articleinfo><section><title>Feature: Client side cleanup</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: Improve code quality and maintainability.  </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: started;  </para></listitem><listitem><para><emphasis role="strong">ETA</emphasis>: Two-three months once started </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: Squid 3.4 and later </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: <ulink url="https://wiki.squid-cache.org/Features/ClientSideCleanup/AmosJeffries#">AmosJeffries</ulink> </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: <ulink url="http://www.mail-archive.com/squid-dev@squid-cache.org/msg07889.html">squid-dev thread</ulink> </para></listitem></itemizedlist><section><title>Details</title><para>We need thin and clean HTTP server code that makes sense to developers. Clear interaction with Comm, Store, and Forward APIs (which should probably be cleaned up before this project). The current code accumulated many serious design flaws that make changes difficult and risky. Most (perhaps all) developers cannot even grasp all the interactions and inner dependencies, which causes the snowball effect of degrading code quality. </para><para>Affected client_side* classes may be renamed to reflect the fact that they implement an HTTP server. This code communicates with Squid clients and, hence, has been called <emphasis>client side</emphasis>. </para><section><title>Progress</title><para>Done: </para><itemizedlist><listitem><para>Comm::TcpAcceptor separated out </para><itemizedlist><listitem override="none"><para>- class to handle the Comm level operations of accept() and following socket state lookups </para></listitem></itemizedlist></listitem><listitem><para>Defined the scope and purpose for ConnStateData </para><itemizedlist><listitem override="none"><para>- class to manage a client TCP connection. - reading HTTP/1.1 frames (request headers block, body blocks) - writing HTTP/1.1 frames (response headers block, 1xx headers block, body blocks) </para><para>- generate HttpParser, ClientSocketContext and other AsyncJobs to operate on teh above frames types as needed </para></listitem></itemizedlist></listitem></itemizedlist><para>In Progress: </para><itemizedlist><listitem><para>Create a master transaction state object for relaying data easily </para></listitem><listitem><para>Refactor ConnStateData to meet the above criteria </para></listitem></itemizedlist><para>Future steps: </para><itemizedlist><listitem><para>Define the scope and purpose for ClientSocketContext </para></listitem><listitem><para>Define the scope and purpose for ClientHttpRequest </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/ClientSideCleanup/CategoryFeature#">CategoryFeature</ulink> <ulink url="https://wiki.squid-cache.org/Features/ClientSideCleanup/CategoryWish#">CategoryWish</ulink> </para></section></section></section></article>