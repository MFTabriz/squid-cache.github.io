<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/InternalRedirectors</title><revhistory><revision><revnumber>7</revnumber><date>2015-09-21 05:31:00</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>6</revnumber><date>2015-09-21 05:15:05</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>5</revnumber><date>2015-08-31 09:05:58</date><authorinitials>FrancescoChemolli</authorinitials><revremark>Fix link to bugzilla.</revremark></revision><revision><revnumber>4</revnumber><date>2008-07-29 01:47:09</date><authorinitials>AmosJeffries</authorinitials><revremark>add 2.x details.</revremark></revision><revision><revnumber>3</revnumber><date>2008-07-29 01:20:49</date><authorinitials>AmosJeffries</authorinitials><revremark>details.</revremark></revision><revision><revnumber>2</revnumber><date>2008-07-29 00:21:14</date><authorinitials>AmosJeffries</authorinitials><revremark>timeline</revremark></revision><revision><revnumber>1</revnumber><date>2008-07-29 00:16:27</date><authorinitials>AmosJeffries</authorinitials><revremark>publish as target. details to follow.</revremark></revision></revhistory></articleinfo><section><title>Feature: Internal Redirector / URL Maps</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: To provide an internal URL-rewrite mechanism which can be used with ACL to replace simple redirectors. </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: Merged with 2-HEAD. Port to 3.1 stalled </para></listitem><listitem><para><emphasis role="strong">ETA</emphasis>: unknown </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>:  </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: Gonzalo Arana (2.x), <ulink url="https://wiki.squid-cache.org/Features/InternalRedirectors/AmosJeffries#">AmosJeffries</ulink> (3.x) </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: bug <ulink url="https://bugs.squid-cache.org/show_bug.cgi?id=1208#">1208</ulink> </para></listitem></itemizedlist><section><title>Details</title><para>Any explicit external URL-rewiter helper via <ulink url="http://www.squid-cache.org/Doc/config/url_rewrite_program#">url_rewrite_program</ulink> overrides internal redirectors and the external helper is used instead. </para><section><title>Squid 2.x</title><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> The format for 3.x differs from 2.x in the directives it provides. This description covers the 2.x version in detail. </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> The patch for 2.x has been accepted into the main code for testing and release in 2.8 </para></entry></row></tbody></tgroup></informaltable><para>Squid 2.x this feature is enabled by default. </para><para>An extra squid.conf options are made available to re-write URL without a rewriter helper. </para><screen><![CDATA[rewrite_access acl [acl [acl ...]]
]]><![CDATA[
rewrite dsturl acl [acl [acl ...]]]]></screen><para>see url_map* descriptions below for details on their operation. The names differ, but behavior remains identical. </para></section><section><title>Squid 3.x</title><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> </para></entry><entry colsep="1" rowsep="1"><para> The format for 3.x differs from 2.x in the directives it provides. This description covers the 3.x version in detail. </para></entry></row></tbody></tgroup></informaltable><para>When squid is built with configure option: </para><screen><![CDATA[--enable-url-maps]]></screen><para>An extra squid.conf options are made available to re-write URL without a rewriter helper. </para><screen><![CDATA[url_map_access acl [acl [acl ...]]
]]><![CDATA[
url_map dsturl acl [acl [acl ...]]]]></screen><para><emphasis role="strong">url_map_access</emphasis> controls whether url_maps are processed at all for a request. By default are checked against <ulink url="http://www.squid-cache.org/Doc/config/url_map#">url_map</ulink> list. If specified, only requests matching <ulink url="http://www.squid-cache.org/Doc/config/url_map_access#">url_map_access</ulink> ACL are further processed against each <ulink url="http://www.squid-cache.org/Doc/config/url_map#">url_map</ulink>. </para><para><ulink url="http://www.squid-cache.org/Doc/config/url_map#">url_map</ulink> directives are processed in the order configured. </para><para><emphasis role="strong">dsturl</emphasis> specifies the resulting URL when all acls are matched. If <emphasis role="strong">dsturl</emphasis> is &quot;-&quot; the re-write does nothing. It may start with a status code sent directly to user. And contain format codes preceeded by <emphasis role="strong">%</emphasis>. </para><section><title>Valid status codes:</title><screen><![CDATA[301:http://....    Means respond with a 301 to user.
302:http://....    Means respond with a 302 to user.
303:http://....    Means respond with a 303 to user.
307:http://....    Means respond with a 307 to user.]]></screen></section><section><title>Format codes</title><para>Format code spec: </para><screen><![CDATA[%[#][argument]formatcode]]></screen><para>Codes: </para><screen><![CDATA[%>a      Client source IP address
%la      Local IP address (http_port)
%lp      Local port number (http_port)
%ts      Seconds since epoch
%tu      subsecond time (milliseconds, %03d)
%un      User name
%ul      User login
%ui      User ident
%ue      User from external acl
%rm      Request method (GET/POST etc)
%ru      Request URL
%rp      Request path
%rh      Request host from URL
%rH      Request Host header
%rP      Request protocol
%et      Tag returned by external acl
%ea      Log string returned by external acl
%%       a literal % character]]></screen><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/InternalRedirectors/CategoryFeature#">CategoryFeature</ulink> </para></section></section></section></section></article>