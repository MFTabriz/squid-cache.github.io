<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/LogModules</title><revhistory><revision><revnumber>25</revnumber><date>2017-06-06 11:10:37</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>24</revnumber><date>2013-01-21 08:16:36</date><authorinitials>FrancescoChemolli</authorinitials><revremark>little changes on blooper, as requested by the author.</revremark></revision><revision><revnumber>23</revnumber><date>2013-01-21 06:02:42</date><authorinitials>AmosJeffries</authorinitials><revremark>blooper is a helper daemon not a Squid library module.</revremark></revision><revision><revnumber>22</revnumber><date>2013-01-20 16:14:36</date><authorinitials>FrancescoChemolli</authorinitials><revremark>referenced blooper</revremark></revision><revision><revnumber>21</revnumber><date>2012-11-08 18:27:50</date><authorinitials>FrancescoChemolli</authorinitials><revremark>mentioned syslog-ng as a tcp log module receiver.</revremark></revision><revision><revnumber>20</revnumber><date>2011-03-17 07:24:48</date><authorinitials>AmosJeffries</authorinitials><revremark>pull daemon protocol from the helpers protocol page</revremark></revision><revision><revnumber>19</revnumber><date>2011-02-09 22:58:34</date><authorinitials>AmosJeffries</authorinitials><revremark>updated DB log helper details.</revremark></revision><revision><revnumber>18</revnumber><date>2010-06-26 13:58:32</date><authorinitials>AmosJeffries</authorinitials><revremark>add daemon protocol syntax</revremark></revision><revision><revnumber>17</revnumber><date>2010-06-10 02:54:08</date><authorinitials>AmosJeffries</authorinitials><revremark>Renamed from 'Features/LogDaemon'.</revremark></revision><revision><revnumber>16</revnumber><date>2010-06-10 02:53:16</date><authorinitials>AmosJeffries</authorinitials><revremark>page no longer just covers the daemon. its about the modular interface in general.</revremark></revision><revision><revnumber>15</revnumber><date>2010-06-03 04:15:27</date><authorinitials>AmosJeffries</authorinitials><revremark>.</revremark></revision><revision><revnumber>14</revnumber><date>2010-06-01 02:03:06</date><authorinitials>AmosJeffries</authorinitials><revremark>document the log daemon configuration. Add to FAQ</revremark></revision><revision><revnumber>13</revnumber><date>2009-11-23 12:46:21</date><authorinitials>AmosJeffries</authorinitials><revremark>merged. TODO document some config examples and etc</revremark></revision><revision><revnumber>12</revnumber><date>2009-04-09 11:07:39</date><authorinitials>AmosJeffries</authorinitials><revremark>add list of available daemons people have created</revremark></revision><revision><revnumber>11</revnumber><date>2009-03-27 04:03:25</date><authorinitials>AmosJeffries</authorinitials><revremark>update</revremark></revision><revision><revnumber>10</revnumber><date>2009-01-26 10:32:43</date><authorinitials>AmosJeffries</authorinitials><revremark>this is going to need a large re-work after SourceLayout is done.</revremark></revision><revision><revnumber>9</revnumber><date>2008-08-20 02:56:02</date><authorinitials>AmosJeffries</authorinitials><revremark>timeline blocked by 3.1 release</revremark></revision><revision><revnumber>8</revnumber><date>2008-07-14 06:44:56</date><authorinitials>AmosJeffries</authorinitials><revremark>update status</revremark></revision><revision><revnumber>7</revnumber><date>2008-06-11 04:33:31</date><authorinitials>AmosJeffries</authorinitials><revremark>slipped a bit. But I'm porting it over now.</revremark></revision><revision><revnumber>6</revnumber><date>2008-05-18 19:39:00</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>5</revnumber><date>2008-04-03 11:54:56</date><authorinitials>AmosJeffries</authorinitials><revremark>Off the wishlist onto 3.1 todo list</revremark></revision><revision><revnumber>4</revnumber><date>2008-03-18 21:05:22</date><authorinitials>AmosJeffries</authorinitials><revremark>I'll port this myself if it none else will.</revremark></revision><revision><revnumber>3</revnumber><date>2008-02-14 12:11:19</date><authorinitials>AmosJeffries</authorinitials><revremark>Done? Adrian said so...I take it he knows best</revremark></revision><revision><revnumber>2</revnumber><date>2008-02-14 01:31:30</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>1</revnumber><date>2007-10-12 19:52:44</date><authorinitials>AlexRousskov</authorinitials><revremark>Moving Log Daemon from DeadProjects to Features</revremark></revision></revhistory></articleinfo><section><title>Feature: Log Modules for Squid</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: Logging plugin interface for Squid </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: seeking additional daemon helpers to bundle with Squid. </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 2.7, 3.2 </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: <ulink url="https://wiki.squid-cache.org/Features/LogModules/AdrianChadd#">AdrianChadd</ulink> (Squid-2), <ulink url="https://wiki.squid-cache.org/Features/LogModules/AmosJeffries#">AmosJeffries</ulink> (Squid-3 port) </para></listitem></itemizedlist><section><title>Plug-in Modules</title><para>Logging modules are API built into Squid which pass logging information out to helpers in several different formats. </para><para>General <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink> format: </para><screen><![CDATA[access_log module:parameters [logformat] [acls]]]></screen><itemizedlist><listitem override="none"><para><emphasis role="strong">module</emphasis>: One of the plugin modules Squid can use to record the log data. </para></listitem><listitem override="none"><para><emphasis role="strong">parameters</emphasis>: Parameters to configure the plugin module. Content and format is specific to each logging module. </para></listitem><listitem override="none"><para><emphasis role="strong">logformat</emphasis>: The access.log format to be used. See <ulink url="http://www.squid-cache.org/Doc/config/logformat#">logformat</ulink> for more details. </para></listitem><listitem override="none"><para><emphasis role="strong">acls</emphasis>: A list of ACL names, if all the named ACLs match a request it will be logged to this log. </para></listitem></itemizedlist><section><title>Module: Standard I/O</title><para>This is a module uses the traditional I/O method of Squid writing its logs directly to the file system. </para><para>Configuration <emphasis role="strong">module:parameters</emphasis> to be used by <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink>: </para><screen><![CDATA[stdio:/var/log/squid/access.log]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Used for backwards compatibility with old squid.conf. It is recommended that you upgrade to the <emphasis role="strong">daemon</emphasis> module with the basic file helper for better performance. </para></listitem></itemizedlist></section><section><title>Module: Daemon</title><para>This is a module runs a helper daemon to offload the log storage processing from Squid. </para><para>The helper daemon program is configured with the <ulink url="http://www.squid-cache.org/Doc/config/logfile_daemon#">logfile_daemon</ulink> directive. </para><screen><![CDATA[logfile_daemon /path/to/helper.binary]]></screen><para>Configuration <emphasis role="strong">module:parameters</emphasis> to be used by <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink>: </para><screen><![CDATA[daemon:/var/log/squid/access.log]]></screen><section><title>Daemon Helpers Available</title><itemizedlist><listitem><para><emphasis role="strong">log_file_daemon</emphasis> : Log directly to the local file system. </para></listitem><listitem><para><emphasis role="strong">log_db_daemon</emphasis> : Log directly to an SQL database. MySQL backend default. <ulink url="http://www.mail-archive.com/squid-users@squid-cache.org/msg53342.html"/> or <ulink url="http://sourceforge.net/projects/logmysqldaemon/"/> </para></listitem><listitem><para><emphasis role="strong">blooper</emphasis> :  </para><itemizedlist><listitem override="none"><para><emphasis>blooper</emphasis> is a ruby logfile_daemon which can log to any SQL database (Postgres being the main target for it). </para></listitem><listitem override="none"><para>Sources are available on github at <ulink url="https://github.com/paranormal/blooper"/> </para></listitem></itemizedlist></listitem></itemizedlist></section></section><section><title><ulink url="https://wiki.squid-cache.org/Features/LogModules/Features/AddonHelpers">Daemon Message Protocol</ulink></title><para>Squid sends a number of commands to the log daemon. These are sent in the first byte of each input line: </para><itemizedlist><listitem override="none"><informaltable><tgroup cols="2"><colspec colname="col_0"/><colspec colname="col_1"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> L&lt;data&gt;\n </para></entry><entry colsep="1" rowsep="1"><para> logfile data </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> R\n </para></entry><entry colsep="1" rowsep="1"><para> rotate file </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> T\n </para></entry><entry colsep="1" rowsep="1"><para> truncate file </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> O\n </para></entry><entry colsep="1" rowsep="1"><para> re-open file </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> F\n </para></entry><entry colsep="1" rowsep="1"><para> flush file </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> r&lt;n&gt;\n </para></entry><entry colsep="1" rowsep="1"><para> set rotate count to &lt;n&gt; </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> b&lt;n&gt;\n </para></entry><entry colsep="1" rowsep="1"><para> 1 = buffer output, 0 = don't buffer output </para></entry></row></tbody></tgroup></informaltable></listitem></itemizedlist><para>No response is expected. Any response that may be desired should occur on stderr to be viewed through cache.log. </para></section><section><title>Module: System Log</title><para>This is a module using the syslog() API to send log data to any system logging daemons which accept records in that binary format. </para><para>Configuration <emphasis role="strong">module:parameters</emphasis> to be used by <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink>: </para><screen><![CDATA[syslog:facility.priority]]></screen><itemizedlist><listitem override="none"><para><emphasis>facility</emphasis> and <emphasis>priority</emphasis> fields are intentionally formatted the same as syslog.conf entries. See your syslog configuration documentation for possible values. </para></listitem><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> syslog uses UDP which may drop packets when the network is under load or congested. </para></listitem></itemizedlist></section><section><title>Module: UDP Receiver</title><para>This is a module using UDP protocol to send log lines to an external daemon or central logging server. </para><para>Configuration <emphasis role="strong">module:parameters</emphasis> to be used by <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink>: </para><screen><![CDATA[udp://host:port]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> being UDP this module may drop packets when the network is under load or congested. </para></listitem></itemizedlist></section><section><title>Module: TCP Receiver</title><para>This is a module using TCP protocol to send log lines to an external daemon or central logging server. </para><para>Configuration <emphasis role="strong">module:parameters</emphasis> to be used by <ulink url="http://www.squid-cache.org/Doc/config/access_log#">access_log</ulink>: </para><screen><![CDATA[tcp://host:port]]></screen><itemizedlist><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> Available from <ulink url="https://wiki.squid-cache.org/Features/LogModules/Squid-3.2#">Squid-3.2</ulink> </para></listitem><listitem override="none"><para><inlinemediaobject><imageobject><imagedata depth="16" fileref="https://wiki.squid-cache.org/wiki/squidtheme/img/icon-info.png" width="16"/></imageobject><textobject><phrase>{i}</phrase></textobject></inlinemediaobject> <ulink url="http://www.balabit.com/network-security/syslog-ng">Syslog-ng</ulink> can receive these logs directly. </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/LogModules/CategoryFeature#">CategoryFeature</ulink> </para></section></section></section></article>