<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/eCAP</title><revhistory><revision><revnumber>34</revnumber><date>2011-04-07 03:09:39</date><authorinitials>AlexRousskov</authorinitials><revremark>updated status: good adapters can be tested and even deployed now</revremark></revision><revision><revnumber>33</revnumber><date>2011-04-07 03:06:58</date><authorinitials>AlexRousskov</authorinitials><revremark>Disclaimed support for 3rd party adapters.</revremark></revision><revision><revnumber>32</revnumber><date>2011-04-07 03:02:55</date><authorinitials>AlexRousskov</authorinitials><revremark>Use &quot;adapter&quot; as a simpler and more specific terminology than &quot;[adaptation] plugin module&quot;. The loadable modules are, at least in theory, not limited to eCAP adapters.</revremark></revision><revision><revnumber>31</revnumber><date>2011-04-07 01:06:52</date><authorinitials>AmosJeffries</authorinitials><revremark>Add ClamAV module to registry, and move the list up.</revremark></revision><revision><revnumber>30</revnumber><date>2011-04-05 22:46:32</date><authorinitials>AlexRousskov</authorinitials><revremark>Started documenting supported optional eCAP features</revremark></revision><revision><revnumber>29</revnumber><date>2011-04-05 14:31:37</date><authorinitials>AlexRousskov</authorinitials><revremark>Squid 3.2.0.6 supports libecap v0.2.0.</revremark></revision><revision><revnumber>28</revnumber><date>2011-03-29 13:52:36</date><authorinitials>AlexRousskov</authorinitials><revremark>Tried to clarify that building Squid v3.1 with the latest libecap is wrong.</revremark></revision><revision><revnumber>27</revnumber><date>2011-03-10 17:58:27</date><authorinitials>AlexRousskov</authorinitials><revremark>Added eCAP support status for Squid trunk (until v3.2 gets the corresponding changes).</revremark></revision><revision><revnumber>26</revnumber><date>2011-03-09 23:50:43</date><authorinitials>AmosJeffries</authorinitials><revremark>set config and version wiki-links</revremark></revision><revision><revnumber>25</revnumber><date>2011-03-09 05:34:51</date><authorinitials>AlexRousskov</authorinitials><revremark>documented required libecap versions</revremark></revision><revision><revnumber>24</revnumber><date>2011-01-31 16:32:22</date><authorinitials>AlexRousskov</authorinitials><revremark>emphasized that adaptation_access is required; reader complained it was not clear</revremark></revision><revision><revnumber>23</revnumber><date>2010-12-13 15:27:18</date><authorinitials>AlexRousskov</authorinitials><revremark>added &quot;ecap_enable on&quot;</revremark></revision><revision><revnumber>22</revnumber><date>2010-03-25 15:39:18</date><authorinitials>AlexRousskov</authorinitials><revremark>Added more opinions on licensing</revremark></revision><revision><revnumber>21</revnumber><date>2010-02-25 21:47:49</date><authorinitials>AmosJeffries</authorinitials><revremark>license mention.</revremark></revision><revision><revnumber>20</revnumber><date>2010-02-22 21:36:23</date><authorinitials>AmosJeffries</authorinitials><revremark>gzip adapter download source changed.</revremark></revision><revision><revnumber>19</revnumber><date>2009-01-04 11:21:15</date><authorinitials>AmosJeffries</authorinitials><revremark>eCAP module for gzip compression is now available.</revremark></revision><revision><revnumber>18</revnumber><date>2008-11-23 01:21:43</date><authorinitials>AmosJeffries</authorinitials><revremark>this is 'completed' and merged.</revremark></revision><revision><revnumber>17</revnumber><date>2008-10-10 00:58:01</date><authorinitials>AmosJeffries</authorinitials><revremark>update for FAQ listing.</revremark></revision><revision><revnumber>16</revnumber><date>2008-10-04 11:41:28</date><authorinitials>AmosJeffries</authorinitials><revremark>merged.</revremark></revision><revision><revnumber>15</revnumber><date>2008-10-01 03:45:04</date><authorinitials>AlexRousskov</authorinitials></revision><revision><revnumber>14</revnumber><date>2008-10-01 03:44:31</date><authorinitials>AlexRousskov</authorinitials><revremark>polished feature title</revremark></revision><revision><revnumber>13</revnumber><date>2008-10-01 03:43:08</date><authorinitials>AlexRousskov</authorinitials><revremark>updated or removed stale info; added configuration examples</revremark></revision><revision><revnumber>12</revnumber><date>2008-05-18 19:38:59</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>11</revnumber><date>2008-04-09 05:26:01</date><authorinitials>AlexRousskov</authorinitials><revremark>polished title</revremark></revision><revision><revnumber>10</revnumber><date>2008-04-09 05:24:45</date><authorinitials>AlexRousskov</authorinitials><revremark>updated status and outdated design sketch</revremark></revision><revision><revnumber>9</revnumber><date>2008-02-13 17:12:19</date><authorinitials>AlexRousskov</authorinitials><revremark>Fixed ETA typo</revremark></revision><revision><revnumber>8</revnumber><date>2008-02-13 17:11:55</date><authorinitials>AlexRousskov</authorinitials><revremark>Updated ETA. Fixed link to the eCAP section in the FAQ. Did section links break when wiki was moved?</revremark></revision><revision><revnumber>7</revnumber><date>2007-12-20 15:32:14</date><authorinitials>AlexRousskov</authorinitials></revision></revhistory></articleinfo><section><title>Feature: eCAP support</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>:  Improve Squid3 content adaptation performance by 20+%, remove the need for an ICAP server </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>: 3.1 </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: Ready for testing; code in Squid 3.1 and later </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: <ulink url="https://wiki.squid-cache.org/Features/eCAP/AlexRousskov#">AlexRousskov</ulink> </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: <ulink url="http://www.e-cap.org/">eCAP info</ulink>, <ulink url="http://wiki.squid-cache.org/SquidFaq/ContentAdaptation#head-b3e83ccdb647537404a70d9c17c87463524a470b">context</ulink>, <ulink url="http://devel.squid-cache.org/projects.html#eCAP">code</ulink>, <ulink url="http://www.squid-cache.org/Versions/v3/3.1">Squid 3.1 Packages</ulink> </para></listitem></itemizedlist><section><title>Adapters Available</title><itemizedlist><listitem override="none"><informaltable><tgroup cols="3"><colspec colname="col_0"/><colspec colname="col_1"/><colspec colname="col_2"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <emphasis role="strong">Adapter</emphasis>  </para></entry><entry colsep="1" rowsep="1"><para> <emphasis role="strong">Website</emphasis> </para></entry><entry colsep="1" rowsep="1"><para> <emphasis role="strong">Squid Version</emphasis> </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> gzip compression </para></entry><entry colsep="1" rowsep="1"><para> <ulink url="http://code.google.com/p/squid-ecap-gzip/"/> </para></entry><entry colsep="1" rowsep="1"><para> 3.1 </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> ClamAV scanner   </para></entry><entry colsep="1" rowsep="1"><para> <ulink url="http://www.e-cap.org/Downloads"/> </para></entry><entry colsep="1" rowsep="1"><para> 3.2.0.6 or later </para></entry></row></tbody></tgroup></informaltable></listitem></itemizedlist><para>Disclaimer: The Squid Project does not distribute, support, or endorse these eCAP adapters. Please contact adapter developers with any adapter-specific feedback. </para></section><section><title>Configuration</title><para>Install <emphasis>libecap</emphasis> and build Squid with the --enable-ecap <emphasis>configure</emphasis> option. Install an adapter module. The library and sample adapters are available from the eCAP <ulink url="http://www.e-cap.org/">site</ulink>. </para><para>Enable eCAP support, configure Squid to load an adapter module, and specify which services the module provides: </para><screen><![CDATA[ecap_enable on
loadable_modules /usr/local/lib/ecap_adapter_minimal.so
ecap_service eReqmod reqmod_precache 0 ecap://e-cap.org/ecap/services/sample/minimal
ecap_service eRespmod respmod_precache 0 ecap://e-cap.org/ecap/services/sample/minimal]]></screen><para>Among all dynamically loaded services, only the services matching <ulink url="http://www.squid-cache.org/Doc/config/ecap_service#">ecap_service</ulink> configuration are enabled by Squid. However, enabling an adaptation service is not enough. You need to direct messages to the service(s) using <ulink url="http://www.squid-cache.org/Doc/config/adaptation_access#">adaptation_access</ulink> directives: </para><screen><![CDATA[adaptation_service_set reqFilter eReqmod
adaptation_service_set respFilter eRespmod
]]><![CDATA[
adaptation_access respFilter allow all
adaptation_access reqFilter allow all]]></screen><para>ICAP and eCAP services can co-exist. ACLs control which service gets to process the HTTP message. </para><section><title>Optional eCAP features</title><para>Squid supports sending client IP address to the adapter via the <emphasis>libecap::metaClientIp</emphasis> transaction option. Please see eCAP <ulink url="https://answers.launchpad.net/ecap/+faq/1516">FAQ</ulink> for details and do not forget to enable <ulink url="http://www.squid-cache.org/Doc/config/adaptation_send_client_ip#">adaptation_send_client_ip</ulink> in squid.conf. </para></section></section><section><title>Supported eCAP versions</title><para><ulink url="https://wiki.squid-cache.org/Features/eCAP/Squid-3.1#">Squid-3.1</ulink> supports libecap v0.0.3 only, but will try to build with any libecap version installed. Builds with incompatible versions should fail, but be careful: Check that you are building with libecap v0.0.3 and not the latest library version. The same applies to <ulink url="https://wiki.squid-cache.org/Features/eCAP/Squid-3.2#">Squid-3.2</ulink> releases prior to v3.2.0.6. </para><para><ulink url="https://wiki.squid-cache.org/Features/eCAP/Squid-3.2#">Squid-3.2</ulink> releases starting with v3.2.0.6 support libecap v0.2.0 and have a configure-time libecap version check. </para><para>Eventually, Squid may also check (at runtime) that the loaded adapter was built with a compatible libecap version, but that check will not be possible until libecap API supports it. </para></section><section><title>License Issues</title><para>Note: These are not legally binding opinions. If you have any doubts regarding the licensing please contact your lawyer. </para><para>Squid is licensed under the GPLv2+, which brings up the question of licensing for distributed Squid plugins. There are several, conflicting views regarding eCAP adapter licensing requirements, including: </para><itemizedlist><listitem><para>eCAP is not a Squid-specific API. Compliant eCAP adapters should work in any eCAP-compliant host application. They are not &quot;Squid plugins&quot; just like libc is not a Squid plugin. Thus, eCAP adapter distribution is not subject to Squid licensing restrictions. </para></listitem><listitem><para>Communication with eCAP adapters is limited to invoking the &quot;main&quot; functions of the adapter and waiting for them to return. FSF considers this a borderline case: <ulink url="http://www.gnu.org/licenses/gpl-faq.html#GPLAndPlugins"/> </para></listitem><listitem><para>eCAP modules fall well inside the boundary of code loaded and run internally. As such any modules require a GPLv2+ compatible license in order to distribute: <ulink url="http://www.fsf.org/licensing/licenses/gpl-faq.html#GPLAndPlugins"/> </para></listitem></itemizedlist><!--rule (<hr>) is not applicable to DocBook--><para> <ulink url="https://wiki.squid-cache.org/Features/eCAP/CategoryFeature#">CategoryFeature</ulink> </para></section></section></article>