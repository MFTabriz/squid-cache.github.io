<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/Tproxy4/Discussion</title><revhistory><revision><revnumber>2</revnumber><date>2016-02-09 08:38:09</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>1</revnumber><date>2016-02-09 07:49:14</date><authorinitials>Eliezer Croitoru</authorinitials></revision></revhistory></articleinfo><para>See <ulink url="https://wiki.squid-cache.org/Features/Tproxy4/Discussion/Features/Tproxy4#">Discussed Page</ulink> </para><!--rule (<hr>) is not applicable to DocBook--><para> <anchor id="C1"/> There ebtables settings that was mentioned at: <ulink url="http://wiki.squid-cache.org/ConfigExamples/Intercept/DebianWithRedirectorAndReporting?highlight=%28ebtables%29"/> are in contradiction to this page regarding the action of the ebtables rules. What should it be in order to make the bridged packets from the LAN to go into the iptables plane? ACCEPT or DROP? </para><para>-- <ulink url="https://wiki.squid-cache.org/Features/Tproxy4/Discussion/Eliezer%20Croitoru#">Eliezer Croitoru</ulink> <!--The macro DateTime caused an error and should be blacklisted. It returned the data '2016-02-09 07:49:14' which caused the docbook-formatter to choke. Please file a bug.--> </para><para><anchor id="C1"/> <emphasis role="strong">DROP</emphasis> is the correct target action. The semantics of ebtables rules are that it either ACCEPTS the packet (delivering it <emphasis role="strong">over the bridge</emphasis> to the remote machine) or DROPS it out into the local machine for routing by iptables. </para><para>See the <emphasis>--redirect-target</emphasis> description in <ulink url="http://linux.die.net/man/8/ebtables"/> - &quot;Making it DROP in the BROUTING chain will let the frames be routed.&quot; </para><para>There are however some strange combo of bugs in the kernel TCP stack, combined with various misconfigured settings where the ACCEPT can have the appearance of working. But the packets are in fact bouncing around, potentially over the network off the remote machines interfaces and kind of <emphasis>echoing</emphasis> back at Squid. That is of course quite bad for performance, reliability, security, privacy, etc. </para><para>-- <ulink url="https://wiki.squid-cache.org/Features/Tproxy4/Discussion/AmosJeffries#">AmosJeffries</ulink> <!--The macro DateTime caused an error and should be blacklisted. It returned the data '2016-02-08 20:35:00' which caused the docbook-formatter to choke. Please file a bug.--> </para></article>