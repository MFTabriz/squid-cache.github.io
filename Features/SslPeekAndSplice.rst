##master-page:Features/FeatureTemplate
#format wiki
#language en
##
## Change to 'yes' for a listing under Features in the Squid FAQ.
#faqlisted no

= Feature: SSL Peek and Splice =

 * '''Goal''': Make bumping decisions after the origin server name is known, especially when intercepting SSL. Avoid bumping non-SSL traffic.
 * '''Status''': in progress
 * '''Version''': 3.5
 * '''Developer''': AlexRousskov and Christos Tsantilas
 * '''Priority''': 2
 * '''More''': 


= Motivation =

Many SslBump deployments try to minimize potential damage by ''not'' bumping sites unless the local policy demands it. Without this feature, the decision is made based on very limited information: A typical HTTP CONNECT request does not contain many details and intercepted TCP connections reveal nothing but IP addresses and port numbers. Peek and Splice gives admins a way to make bumping decision later in the SSL handshake process, when the SSL server certificate is available (or when it becomes clear that we are not dealing with an SSL connection at all!).

The feature also paves the way for SSL SNI support. Without it, Squid cannot forward client SNI info to the SSL server (Squid can send its own SNI when bumping CONNECT requests, but even that is not reliable and does not work at all for intercepted SSL connections because they lack server name information).


= Implementation overview =

Peek and Splice peeks at the SSL client Hello message (if any), sends a similar (to the extent possible) Hello message to the SSL server, peeks at the SSL server Hello message, and then decides whether to bump. If the decision is ''not'' to bump, the server Hello message is forwarded to the client and the two TCP connections are spliced at TCP level, with Squid shoveling TCP bytes back and forth without any decryption.


== Mimicked SSL client Hello properties ==

This section documents how each SSL client Hello property is generated by Squid. The "true" adjective is applied to describe a property of the Hello message received from the SSL client.

##||'''x509 certificate property'''||'''After successful bumping'''||'''After failed bumping'''||

TBD.

= Limitations =

TBD.


== SSL Client Hello properties not mimicked or set ==

TBD

----
CategoryFeature
