<?xml version="1.0" encoding="utf-8"?><!DOCTYPE article  PUBLIC '-//OASIS//DTD DocBook XML V4.4//EN'  'http://www.docbook.org/xml/4.4/docbookx.dtd'><article><articleinfo><title>Features/SrvDnsOriginServerLocation</title><revhistory><revision><revnumber>12</revnumber><date>2015-09-21 05:04:32</date><authorinitials>AmosJeffries</authorinitials></revision><revision><revnumber>11</revnumber><date>2009-03-08 10:03:45</date><authorinitials>AmosJeffries</authorinitials><revremark>remove text from developer field so this shows up on the wishlist</revremark></revision><revision><revnumber>10</revnumber><date>2008-09-18 11:44:41</date><authorinitials>AmosJeffries</authorinitials><revremark>update to get on auto-lists.</revremark></revision><revision><revnumber>9</revnumber><date>2008-05-18 19:38:58</date><authorinitials>localhost</authorinitials><revremark>converted to 1.6 markup</revremark></revision><revision><revnumber>8</revnumber><date>2008-05-10 07:10:05</date><authorinitials>AmosJeffries</authorinitials><revremark>bump to unknown future Squid-3 version</revremark></revision><revision><revnumber>7</revnumber><date>2008-04-22 00:35:06</date><authorinitials>AmosJeffries</authorinitials><revremark>push to 3.2+</revremark></revision><revision><revnumber>6</revnumber><date>2008-03-18 16:03:43</date><authorinitials>AlexRousskov</authorinitials><revremark>This is a wish</revremark></revision><revision><revnumber>5</revnumber><date>2007-12-28 02:23:34</date><authorinitials>kinkie</authorinitials></revision><revision><revnumber>4</revnumber><date>2007-12-23 00:25:47</date><authorinitials>Henrik Nordstr√∂m</authorinitials></revision><revision><revnumber>3</revnumber><date>2007-12-22 20:57:05</date><authorinitials>kinkie</authorinitials><revremark>Added configuration sample</revremark></revision><revision><revnumber>2</revnumber><date>2007-12-22 20:47:22</date><authorinitials>kinkie</authorinitials><revremark>Added code as attachment and linked it</revremark></revision><revision><revnumber>1</revnumber><date>2007-12-22 20:45:12</date><authorinitials>kinkie</authorinitials></revision></revhistory></articleinfo><section><title>Feature: SRV based origin server location</title><itemizedlist><listitem><para><emphasis role="strong">Goal</emphasis>: Make use of DNS SRV records to locate the origin server for a given website. </para></listitem><listitem><para><emphasis role="strong">Status</emphasis>: in progress; a working redirector-based proof-of-concept is available. It can be improved upon, with the aim of mimicking Squid's internal processes. </para></listitem><listitem><para><emphasis role="strong">ETA</emphasis>: unknown </para></listitem><listitem><para><emphasis role="strong">Version</emphasis>:  </para></listitem><listitem><para><emphasis role="strong">Proof of Concept</emphasis>: <ulink url="https://wiki.squid-cache.org/Features/SrvDnsOriginServerLocation/FrancescoChemolli#">FrancescoChemolli</ulink> </para></listitem><listitem><para><emphasis role="strong">Developer</emphasis>: </para></listitem><listitem><para><emphasis role="strong">More</emphasis>: </para></listitem></itemizedlist></section><section><title>Proof Of Concept Code</title><para>Configuration snippet: </para><screen><![CDATA[url_rewrite_program /path/to/srv-redir.pl
url_rewrite_children 5
url_rewrite_concurrency 0
url_rewrite_host_header off]]></screen><para>Some tuneables are in the redirector script itself. </para></section><section><title>Details</title><para><ulink url="http://en.wikipedia.org/wiki/SRV_record">DNS SRV records</ulink>, defined in <ulink url="http://www.ietf.org/rfc/rfc2782.txt">RFC 2782</ulink> can help attain some level of high availability and load balancing in a very straightforward manner. Their query structure includes a naming convention to locate a certain well-known network service, and their reply structure includes two different fields to indicate the level of priority a certain pointer of a set has. </para><para>For example a query: <code> _http._tcp.www.kinkie.it. SRV </code> Might return results similar to those: </para><informaltable><tgroup cols="3"><colspec colname="col_0"/><colspec colname="col_1"/><colspec colname="col_2"/><tbody><row rowsep="1"><entry colsep="1" rowsep="1"><para> <emphasis role="strong">priority</emphasis> </para></entry><entry colsep="1" rowsep="1"><para> <emphasis role="strong">weight</emphasis> </para></entry><entry colsep="1" rowsep="1"><para> <emphasis role="strong">target</emphasis> </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> 10 </para></entry><entry colsep="1" rowsep="1"><para> 10 </para></entry><entry colsep="1" rowsep="1"><para> srv1.kinkie.it. </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> 10 </para></entry><entry colsep="1" rowsep="1"><para> 10 </para></entry><entry colsep="1" rowsep="1"><para> srv2.kinkie.it. </para></entry></row><row rowsep="1"><entry colsep="1" rowsep="1"><para> 20 </para></entry><entry colsep="1" rowsep="1"><para> 5 </para></entry><entry colsep="1" rowsep="1"><para> backupsrv.kinkie.it. </para></entry></row></tbody></tgroup></informaltable><para>Quoting from the RFC: </para><screen><![CDATA[A client MUST attempt to
contact the target host with the lowest-numbered priority it can
reach; target hosts with the same priority SHOULD be tried in an
order defined by the weight field.  The range is 0-65535.  This
is a 16 bit unsigned integer in network byte order.
[...]
The weight field specifies a
relative weight for entries with the same priority. Larger
weights SHOULD be given a proportionately higher probability of
being selected.]]></screen><para>The (expired) Internet Draft <ulink url="http://tools.ietf.org/html/draft-andrews-http-srv">draft-andrews-http-srv</ulink> tries to address some inconsistencies of the general addressing scheme. </para><section><title>Status</title><para>The redirector is RFC-compliant at version 0.4. Andrews' draft is the next target for integration. </para><!--rule (<hr>) is not applicable to DocBook--><itemizedlist><listitem override="none"><para><ulink url="https://wiki.squid-cache.org/Features/SrvDnsOriginServerLocation/CategoryFeature#">CategoryFeature</ulink> <ulink url="https://wiki.squid-cache.org/Features/SrvDnsOriginServerLocation/CategoryWish#">CategoryWish</ulink> </para></listitem></itemizedlist></section></section></article>